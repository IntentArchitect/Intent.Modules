<?xml version="1.0" encoding="utf-8"?>
<settings version="3.1.1">
  <id>f36cb21a-faf9-46ff-85e7-41f38345253d</id>
  <name>Services CQRS Domain Interactions</name>
  <designerReferences />
  <packageSettings />
  <packageExtensions>
    <packageExtension type="Services Package" typeId="df45eaf6-9202-4c25-8dd5-677e9ba1e906">
      <requiredPackages />
      <creationOptions />
      <scriptOptions>
        <option>
          <text>Create CRUD CQRS Operations</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return application.isModuleInstalled("Intent.Modelers.Services.CQRS") &amp;&amp;
    application.getSettings("0ecca7c5-96f7-449a-96b9-f65ba0a4e3ad").getField("14bc1e98-930b-494c-97a9-5da4e1f3a5fa").value == "basic";</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../typings/elementmacro.context.api.d.ts" /&gt;
function getSurrogateKeyType() {
    var _a, _b, _c;
    const commonTypes = {
        guid: "6b649125-18ea-48fd-a6ba-0bfff0d8f488",
        long: "33013006-E404-48C2-AC46-24EF5A5774FD",
        int: "fb0a362d-e9e2-40de-b6ff-5ce8167cbe74"
    };
    const javaTypes = {
        long: "e9e575eb-f8de-4ce4-9838-2d09665a752d",
        int: "b3e5cb3b-8a26-4346-810b-9789afa25a82"
    };
    const typeNameToIdMap = new Map();
    typeNameToIdMap.set("guid", commonTypes.guid);
    typeNameToIdMap.set("int", lookup(javaTypes.int) != null ? javaTypes.int : commonTypes.int);
    typeNameToIdMap.set("long", lookup(javaTypes.long) != null ? javaTypes.long : commonTypes.long);
    let typeName = (_c = (_b = (_a = application.getSettings("ac0a788e-d8b3-4eea-b56d-538608f1ded9")) === null || _a === void 0 ? void 0 : _a.getField("Key Type")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "int";
    if (typeNameToIdMap.has(typeName)) {
        return typeNameToIdMap.get(typeName);
    }
    return typeNameToIdMap.get("guid");
}
/// &lt;reference path="getSurrogateKeyType.ts"/&gt;
class DomainHelper {
    static async openSelectEntityDialog(options) {
        let classes = lookupTypesOf("Class").filter(x =&gt; DomainHelper.isAggregateRoot(x) || ((options === null || options === void 0 ? void 0 : options.includeOwnedRelationships) != false &amp;&amp; DomainHelper.ownerIsAggregateRoot(x)) || x.hasStereotype("Repository"));
        if (classes.length == 0) {
            await dialogService.info("No Domain types could be found. Please ensure that you have a reference to the Domain package and that at least one class exists in it.");
            return null;
        }
        let classId = await dialogService.lookupFromOptions(classes.map((x) =&gt; ({
            id: x.id,
            name: this.getFriendlyDisplayNameForClassSelection(x)
        })));
        if (classId == null) {
            await dialogService.error(`No class found with id "${classId}".`);
            return null;
        }
        let foundEntity = lookup(classId);
        return foundEntity;
    }
    static getFriendlyDisplayNameForClassSelection(element) {
        let found = DomainHelper.getOwningAggregate(element);
        return !found ? element.getName() : `${element.getName()} (${found.getName()})`;
    }
    static isAggregateRoot(element) {
        let result = !element.getAssociations("Association")
            .some(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable);
        return result;
    }
    static getOwningAggregate(entity) {
        var _a;
        let result = (_a = entity.getAssociations("Association")
            .filter(x =&gt; this.isAggregateRoot(x.typeReference.getType()) &amp;&amp; isOwnedBy(x) &amp;&amp;
            // Let's only target collections for now as part of the nested compositional crud support
            // as one-to-one relationships are more expensive to address and possibly not going to
            // be needed.
            x.getOtherEnd().typeReference.isCollection)[0]) === null || _a === void 0 ? void 0 : _a.typeReference.getType();
        return result;
        function isOwnedBy(association) {
            return association.isSourceEnd() &amp;&amp;
                !association.typeReference.isNullable &amp;&amp;
                !association.typeReference.isCollection;
        }
    }
    static ownerIsAggregateRoot(entity) {
        let result = DomainHelper.getOwningAggregate(entity);
        return result ? true : false;
    }
    static getPrimaryKeys(entity) {
        if (!entity) {
            throw new Error("entity not specified");
        }
        let primaryKeys = DomainHelper.getPrimaryKeysMap(entity);
        if (Object.keys(primaryKeys).length == 0) {
            return [
                {
                    id: null,
                    name: DomainHelper.getAttributeNameFormat("Id"),
                    typeId: DomainHelper.getSurrogateKeyType(),
                    mapPath: null,
                    isNullable: false,
                    isCollection: false
                }
            ];
        }
        return Object.values(primaryKeys);
    }
    static getPrimaryKeysMap(entity) {
        let keydict = Object.create(null);
        let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        keys.forEach(key =&gt; keydict[key.id] = {
            id: key.id,
            name: key.getName(),
            typeId: key.typeReference.typeId,
            mapPath: [key.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
        return keydict;
        function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
            baseKeys.forEach(key =&gt; {
                keydict[key.id] = {
                    id: key.id,
                    name: key.getName(),
                    typeId: key.typeReference.typeId,
                    mapPath: generalizationStack.concat([key.id]),
                    isNullable: key.typeReference.isNullable,
                    isCollection: key.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
        }
    }
    static getForeignKeys(entity, owningAggregate) {
        var _a;
        if (!entity) {
            throw new Error("entity not specified");
        }
        if (!owningAggregate) {
            throw new Error("nestedCompOwner not specified");
        }
        // Use the new Associated property on the FK stereotype method for FK Attribute lookup
        let foreignKeys = [];
        for (let attr of entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Foreign Key"))) {
            let associationId = (_a = attr.getStereotype("Foreign Key").getProperty("Association")) === null || _a === void 0 ? void 0 : _a.getValue();
            if (owningAggregate.getAssociations("Association").some(x =&gt; x.id == associationId)) {
                foreignKeys.push(attr);
            }
        }
        // Backward compatible lookup method
        if (foreignKeys.length == 0) {
            let foundFk = entity.getChildren("Attribute")
                .filter(x =&gt; x.getName().toLowerCase().indexOf(owningAggregate.getName().toLowerCase()) &gt;= 0 &amp;&amp; x.hasStereotype("Foreign Key"))[0];
            if (foundFk) {
                foreignKeys.push(foundFk);
            }
        }
        if (foreignKeys.length &gt; 0) {
            return foreignKeys.map(x =&gt; ({
                name: DomainHelper.getAttributeNameFormat(x.getName()),
                typeId: x.typeReference.typeId,
                id: x.id,
                mapPath: [x.id],
                isCollection: x.typeReference.isCollection,
                isNullable: x.typeReference.isNullable
            }));
        }
        // Implicit FKs:
        return [{
                name: DomainHelper.getAttributeNameFormat(`${owningAggregate.getName()}Id`),
                typeId: DomainHelper.getPrimaryKeys(owningAggregate)[0].typeId,
                id: null,
                mapPath: null,
                isCollection: false,
                isNullable: false
            }];
    }
    static getChildrenOfType(entity, type) {
        let attrDict = Object.create(null);
        let attributes = entity.getChildren(type);
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        return Object.values(attrDict);
    }
    static getAttributesWithMapPath(entity) {
        let attrDict = Object.create(null);
        let attributes = entity
            .getChildren("Attribute")
            .filter(x =&gt; {
            var _a;
            return !x.hasStereotype("Primary Key") &amp;&amp;
                !DomainHelper.legacyPartitionKey(x) &amp;&amp;
                (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
        });
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
        return Object.values(attrDict);
        function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !DomainHelper.legacyPartitionKey(x));
            baseKeys.forEach(attr =&gt; {
                attrDict[attr.id] = {
                    id: attr.id,
                    name: attr.getName(),
                    typeId: attr.typeReference.typeId,
                    mapPath: generalizationStack.concat([attr.id]),
                    isNullable: attr.typeReference.isNullable,
                    isCollection: attr.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
        }
    }
    static getAttributeNameFormat(str) {
        let convention = DomainHelper.getDomainAttributeNamingConvention();
        switch (convention) {
            case "pascal-case":
                return toPascalCase(str);
            case "camel-case":
                return toCamelCase(str);
        }
        return str;
    }
    static getDomainAttributeNamingConvention() {
        var _a, _b, _c;
        const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
        return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
    }
    static getSurrogateKeyType() {
        return getSurrogateKeyType();
    }
    // Just in case someone still uses this convention. Used to filter out those attributes when mapping
    // to domain entities that are within a Cosmos DB paradigm.
    static legacyPartitionKey(attribute) {
        return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
    }
    static requiresForeignKey(associationEnd) {
        return DomainHelper.isManyToVariantsOfOne(associationEnd) || DomainHelper.isSelfReferencingZeroToOne(associationEnd);
    }
    static isManyToVariantsOfOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.getOtherEnd().typeReference.isCollection;
    }
    static isSelfReferencingZeroToOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.typeReference.isNullable &amp;&amp;
            associationEnd.typeReference.typeId == associationEnd.getOtherEnd().typeReference.typeId;
    }
}
;
class ServicesConstants {
}
ServicesConstants.dtoToEntityMappingId = "942eae46-49f1-450e-9274-a92d40ac35fa"; //"01d74d4f-e478-4fde-a2f0-9ea92255f3c5";
ServicesConstants.dtoFromEntityMappingId = "1f747d14-681c-4a20-8c68-34223f41b825";
class ServicesHelper {
    static addDtoFieldsFromDomain(dto, attributes) {
        var _a;
        for (let key of attributes) {
            if (dto &amp;&amp; !dto.getChildren("DTO-Field").some(x =&gt; x.getName() == ServicesHelper.getFieldFormat(key.name))) {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(key.name), dto.id);
                field.typeReference.setType(key.typeId);
                if (((_a = key.mapPath) !== null &amp;&amp; _a !== void 0 ? _a : []).length &gt; 0) {
                    field.setMapping(key.mapPath);
                }
            }
        }
    }
    static getParameterFormat(str) {
        return toCamelCase(str);
    }
    static getRoutingFormat(str) {
        return pluralize(str);
    }
    static getFieldFormat(str) {
        return toPascalCase(str);
    }
}
class ElementManager {
    constructor(command, settings) {
        var _a;
        this.command = command;
        this.settings = settings;
        this.mappedElement = (_a = command.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    }
    get id() { return this.command.id; }
    ;
    setReturnType(typeId, isCollection) {
        this.command.typeReference.setType(typeId);
        if (isCollection != null) {
            this.command.typeReference.setIsCollection(isCollection);
        }
        return this;
    }
    addChild(name, type) {
        let field = createElement(this.settings.childSpecialization, ServicesHelper.getFieldFormat(name), this.command.id);
        const typeReferenceDetails = type == null
            ? null
            : typeof (type) === "string"
                ? { id: type, isNullable: false, isCollection: false }
                : { id: type.typeId, isNullable: type.isNullable, isCollection: type.isCollection };
        if (typeReferenceDetails != null) {
            field.typeReference.setType(typeReferenceDetails.id);
            field.typeReference.setIsCollection(typeReferenceDetails.isCollection);
            field.typeReference.setIsNullable(typeReferenceDetails.isNullable);
        }
        return field;
    }
    addChildrenFrom(elements, options) {
        let order = 0;
        elements.forEach(e =&gt; {
            if (e.mapPath != null) {
                if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == e.id; })) {
                    return;
                }
            }
            else if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; x.getName().toLowerCase() === e.name.toLowerCase())) {
                return;
            }
            let field = this.addChild(ServicesHelper.getFieldFormat(e.name), e.typeId);
            field.typeReference.setIsCollection(e.isCollection);
            field.typeReference.setIsNullable(e.isNullable);
            if (options === null || options === void 0 ? void 0 : options.addToTop) {
                field.setOrder(order++);
            }
            if (this.mappedElement != null &amp;&amp; e.mapPath) {
                field.setMapping(e.mapPath);
            }
        });
        return this;
    }
    mapToElement(param1, mappingSettingsId) {
        let elementIds;
        let element;
        if (Array.isArray(param1)) {
            elementIds = param1;
            element = lookup(elementIds[elementIds.length - 1]);
        }
        else {
            elementIds = [param1.id];
            element = param1;
        }
        this.mappedElement = element;
        this.command.setMapping(elementIds, mappingSettingsId);
        return this;
    }
    getElement() {
        return this.command;
    }
    collapse() {
        this.command.collapse();
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getSurrogateKeyType.ts" /&gt;
const constants = {
    PKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
        ExplicitComposite: "explicit_composite",
        Unknown: "unknown"
    },
    FKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
    }
};
function getFieldFormat(str) {
    return toPascalCase(str);
}
function getDomainAttributeNameFormat(str) {
    let convention = getDomainAttributeNamingConvention();
    switch (convention) {
        case "pascal-case":
            return toPascalCase(str);
        case "camel-case":
            return toCamelCase(str);
        default:
            return str;
    }
}
function getOrCreateDto(elementName, parentElement) {
    const expectedDtoName = `${elementName}Dto`;
    let existingDto = parentElement.getChildren("DTO").filter(x =&gt; x.getName() === expectedDtoName)[0];
    if (existingDto) {
        return existingDto;
    }
    let dto = createElement("DTO", expectedDtoName, parentElement.id);
    return dto;
}
function ensureDtoFields(autoAddPrimaryKey, mappedElement, dto) {
    var _a, _b, _c;
    let dtoUpdated = false;
    let domainElement = mappedElement
        .typeReference
        .getType();
    let attributesWithMapPaths = getAttributesWithMapPath(domainElement);
    let isCreateMode = ((_b = (_a = dto.getMetadata("originalVerb")) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.startsWith("create")) == true;
    for (var keyName of Object.keys(attributesWithMapPaths)) {
        let entry = attributesWithMapPaths[keyName];
        if (isCreateMode &amp;&amp; ((_c = entry.name) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === "id") {
            continue;
        }
        if (isCreateMode &amp;&amp; isOwnerForeignKey(entry.name, domainElement)) {
            continue;
        }
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == entry.name)) {
            continue;
        }
        let field = createElement("DTO-Field", entry.name, dto.id);
        field.typeReference.setType(entry.typeId);
        field.typeReference.setIsNullable(entry.isNullable);
        field.typeReference.setIsCollection(entry.isCollection);
        field.setMapping(entry.mapPath);
        dtoUpdated = true;
    }
    if (autoAddPrimaryKey &amp;&amp; !isCreateMode) {
        addPrimaryKeys(dto, domainElement, true);
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
function isOwnerForeignKey(attributeName, domainElement) {
    for (let association of domainElement.getAssociations().filter(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable)) {
        if (attributeName.toLowerCase().indexOf(association.getName().toLowerCase()) &gt;= 0) {
            return true;
        }
    }
    return false;
}
function addPrimaryKeys(dto, entity, map) {
    const primaryKeys = getPrimaryKeysWithMapPath(entity);
    if (primaryKeys.length == 0) {
        // Implicit key:
        primaryKeys.push({
            id: null,
            name: "Id",
            typeId: getSurrogateKeyType(),
            mapPath: null,
            isNullable: false,
            isCollection: false
        });
    }
    for (const primaryKey of primaryKeys) {
        const name = getDomainAttributeNameFormat(primaryKey.name);
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName().toLowerCase() == name.toLowerCase())) {
            continue;
        }
        const dtoField = createElement("DTO-Field", getFieldFormat(name), dto.id);
        dtoField.typeReference.setType(primaryKey.typeId);
        if (map &amp;&amp; primaryKey.mapPath != null) {
            console.log(`Doing mapping for ${dtoField.id}`);
            dtoField.setMapping(primaryKey.mapPath);
        }
    }
}
function getPrimaryKeysWithMapPath(entity) {
    let keydict = Object.create(null);
    let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
    keys.forEach(key =&gt; keydict[key.id] = {
        id: key.id,
        name: key.getName(),
        typeId: key.typeReference.typeId,
        mapPath: [key.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
    return Object.values(keydict);
    function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        baseKeys.forEach(key =&gt; {
            keydict[key.id] = {
                id: key.id,
                name: key.getName(),
                typeId: key.typeReference.typeId,
                mapPath: generalizationStack.concat([key.id]),
                isNullable: key.typeReference.isNullable,
                isCollection: key.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
    }
}
function getAttributesWithMapPath(entity) {
    let attrDict = Object.create(null);
    let attributes = entity.getChildren("Attribute")
        .filter(x =&gt; {
        var _a;
        return !x.hasStereotype("Primary Key") &amp;&amp;
            !legacyPartitionKey(x) &amp;&amp;
            (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
    });
    attributes.forEach(attr =&gt; attrDict[attr.id] = {
        id: attr.id,
        name: attr.getName(),
        typeId: attr.typeReference.typeId,
        mapPath: [attr.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
    return attrDict;
    function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !legacyPartitionKey(x));
        baseKeys.forEach(attr =&gt; {
            attrDict[attr.id] = {
                id: attr.id,
                name: attr.getName(),
                typeId: attr.typeReference.typeId,
                mapPath: generalizationStack.concat([attr.id]),
                isNullable: attr.typeReference.isNullable,
                isCollection: attr.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
    }
}
function getDomainAttributeNamingConvention() {
    var _a, _b, _c;
    const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
    return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
}
// Just in case someone still uses this convention. Used to filter out those attributes when mapping
// to domain entities that are within a Cosmos DB paradigm.
function legacyPartitionKey(attribute) {
    return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
}
/**
 * Workaround for element's from referenced packages not having getParent()
 * @param element The element whose parent should be searched for
 * @param parentSpecializationType The specialization type of the parent
 */
function getParent(element, parentSpecializationType) {
    const elements = lookupTypesOf(parentSpecializationType);
    const parent = elements
        .find(x =&gt; x.getChildren(element.specialization)
        .some(child =&gt; child.id === element.id));
    if (parent == null) {
        throw new Error("Could not find parent");
    }
    return parent;
}
/// &lt;reference path="../common/domainHelper.ts" /&gt;
/// &lt;reference path="../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../common/getParent.ts" /&gt;
/**
 * Gets select details of a mapped Command/Query. Intended for centralized logic of working out
 * things like keys (including implicit ones) for both the entity and owning entity if applicable.
 *
 * If the Command is for entity creation (either due to being mapped to a constructor or being
 * prefixed with "Create"), then primary keys for the entity are not populated.
 * @param request The Command or Query that has been mapped
 */
function getMappedRequestDetails(request) {
    var _a;
    const mappedElement = (_a = request.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    if (mappedElement == null) {
        return null;
    }
    let entity = mappedElement;
    if (entity.specialization !== "Class") {
        entity = getParent(entity, "Class");
    }
    const result = {
        entity: entity,
        mappingTargetType: mappedElement.specialization,
        entityKeyFields: [],
        ownerKeyFields: []
    };
    result.owningEntity = DomainHelper.getOwningAggregate(entity);
    // As long as it's not for creation, populate the PKs of the entity:
    if (result.mappingTargetType !== "Class Constructor" &amp;&amp;
        !request.getName().toLowerCase().startsWith("Create")) {
        result.entityKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity)
            : getKeysForOperationMapping(request, entity);
    }
    // If the entity is owned, populate its fields:
    if (result.owningEntity != null) {
        result.ownerKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity, result.owningEntity)
            : getKeysForOperationMapping(request, entity, result.owningEntity);
    }
    return result;
    /**
     * Return field details for primary keys. As requests mapped to operations and constructors can
     * never possibly map the attributes, these fields can only ever be matched by name.
     * @param request The CQRS Command or Query entity
     * @param owningEntity The Owning Aggregate Class
     */
    function getKeysForOperationMapping(request, entity, owningEntity) {
        const pks = DomainHelper.getPrimaryKeys(owningEntity !== null &amp;&amp; owningEntity !== void 0 ? owningEntity : entity);
        return pks.map(pk =&gt; {
            let fieldName = toPascalCase(pk.name);
            if (owningEntity != null) {
                fieldName = removePrefix(fieldName, toPascalCase(owningEntity.getName()));
                fieldName = `${owningEntity.getName()}${toCamelCase(fieldName)}`;
            }
            fieldName = ServicesHelper.getFieldFormat(fieldName);
            const existingField = request.getChildren("DTO-Field").find(field =&gt; field.getName().toLowerCase() == fieldName.toLowerCase());
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: [],
                name: fieldName,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
    function getKeysForClassMapping(request, entity, owningEntity) {
        const keys = owningEntity != null
            ? DomainHelper.getForeignKeys(entity, owningEntity)
            : DomainHelper.getPrimaryKeys(entity);
        return keys.map(pk =&gt; {
            const existingField = request.getChildren("DTO-Field").find(field =&gt; {
                if (field.getMapping() != null) {
                    return field.getMapping().getPath().some(x =&gt; x.id == pk.id);
                }
                return (pk.name.toLowerCase() === field.getName().toLowerCase());
            });
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: pk.mapPath,
                name: pk.name,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/**
 * Ensures that for the provided contract, it has the provided field creating it if necessary and
 * then ensure the field has the correct typeReference details and order.
 * The field's element is returned.
 */
function ensureHasField(options) {
    const { contract, fieldDetail, mappingSettingsId, order } = options;
    let field = fieldDetail.existingId != null
        ? contract.getChildren("DTO-Field").find(x =&gt; x.id === fieldDetail.existingId)
        : createElement("DTO-Field", fieldDetail.name, contract.id);
    field.typeReference.setType(fieldDetail.typeId);
    field.typeReference.setIsCollection(fieldDetail.isCollection);
    field.typeReference.setIsNullable(fieldDetail.isNullable);
    if (order != null) {
        field.setOrder(order);
    }
    if (mappingSettingsId != null) {
        field.setMapping(fieldDetail.mappingPath, mappingSettingsId);
    }
    return field;
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/// &lt;reference path="ensureHasField.ts" /&gt;
function onMapCommand(element, isForCrudScript, isForCreate = false) {
    var _a, _b, _c;
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const mapFromDomainMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    // const mapToDomainDataSettingsId = "735c87d0-06fc-4491-8b5f-5adc6f953c54";
    const mappingDetails = getMappedRequestDetails(element);
    if (mappingDetails == null) {
        return;
    }
    if (isForCrudScript ||
        mappingDetails.mappingTargetType !== "Class") {
        let order = 0;
        let keyFields = mappingDetails.ownerKeyFields;
        if (!isForCreate) {
            keyFields = keyFields.concat(mappingDetails.entityKeyFields);
        }
        for (const keyField of keyFields) {
            ensureHasField({
                contract: element,
                fieldDetail: keyField,
                order: order++
            });
        }
    }
    if (mappingDetails.mappingTargetType === "Operation" &amp;&amp;
        isComplexType((_c = (_b = (_a = element.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.typeReference) === null || _c === void 0 ? void 0 : _c.getType())) {
        getOrCreateCommandCrudDto(element, element, false, mapFromDomainMappingSettingId);
    }
    const fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; ((_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement().specialization.startsWith("Association")); });
    fields.forEach(field =&gt; {
        getOrCreateCommandCrudDto(element, field, true, projectMappingSettingId);
    });
    const complexFields = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp;
            isComplexType((_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType());
    });
    complexFields.forEach(cf =&gt; {
        getOrCreateCommandCrudDto(element, cf, false, projectMappingSettingId);
    });
    function isComplexType(element) {
        if (element == null) {
            console.warn("isComplexType element parameter received null");
        }
        return (element === null || element === void 0 ? void 0 : element.specialization) === "Data Contract" ||
            (element === null || element === void 0 ? void 0 : element.specialization) === "Value Object";
    }
    function getOrCreateCommandCrudDto(command, dtoField, autoAddPrimaryKey, mappingTypeSettingId) {
        let mappedElement = dtoField.getMapping().getElement();
        if (mappedElement.typeReference == null)
            throw new Error("TypeReference is undefined");
        let originalVerb = (command.getName().split(/(?=[A-Z])/))[0];
        let domainName = mappedElement.typeReference.getType().getName();
        let baseName = command.getMetadata("baseName")
            ? `${command.getMetadata("baseName")}${domainName}`
            : domainName;
        let dtoName = `${originalVerb}${baseName}`;
        let dto = getOrCreateDto(dtoName, command.getParent());
        dto.setMetadata("originalVerb", originalVerb);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(mappedElement.typeReference.getTypeId(), mappingTypeSettingId);
        ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
        dtoField.typeReference.setType(dto.id);
    }
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
const stringTypeId = "d384db9c-a279-45e1-801e-e4e8099625f2";
function onMapDto(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b, _c; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; ((_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.specialization.startsWith("Association")); });
    fields.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, true);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, false);
    });
}
function getOrCreateDtoCrudDto(element, dtoField, autoAddPrimaryKey) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const originalDtoMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    let mappedElement = dtoField.getMapping().getElement();
    let originalVerb = "";
    if (element.hasMetadata("originalVerb")) {
        originalVerb = element.getMetadata("originalVerb");
        // In the event that the prefix is no longer the same as the
        // originally called verb, then don't propagate this any further
        // as end users might get confused.
        if (element.getName().indexOf(originalVerb) &lt; 0) {
            originalVerb = "";
        }
    }
    let targetMappingSettingId = dtoField.getParent().getMapping().mappingSettingsId;
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : domainName;
    let dtoName = `${originalVerb}${baseName}`;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), targetMappingSettingId);
    if (originalVerb !== "") {
        dto.setMetadata("originalVerb", originalVerb);
    }
    dto.setMetadata("baseName", baseName);
    ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
function onMapQuery(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; x.getMapping().getElement().specialization.startsWith("Association"); });
    fields.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
}
function getOrCreateQueryCrudDto(element, dtoField) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    let mappedElement = dtoField.getMapping().getElement();
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : `${domainName}`;
    let dtoName = baseName;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), projectMappingSettingId);
    dto.setMetadata("baseName", baseName);
    ensureDtoFieldsQuery(mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
function ensureDtoFieldsQuery(mappedElement, dto) {
    let dtoUpdated = false;
    let mappedElementAttributes = mappedElement
        .typeReference
        .getType()
        .getChildren("Attribute");
    let dtoFields = dto.getChildren("DTO-Field");
    for (let attribute of mappedElementAttributes.filter(x =&gt; !dtoFields.some(y =&gt; x.getName() === y.getName()))) {
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == attribute.getName())) {
            continue;
        }
        let field = createElement("DTO-Field", attribute.getName(), dto.id);
        field.typeReference.setType(attribute.typeReference.typeId);
        field.typeReference.setIsNullable(attribute.typeReference.isNullable);
        field.typeReference.setIsCollection(attribute.typeReference.isCollection);
        field.setMapping(attribute.id);
        dtoUpdated = true;
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
var _a, _b;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../_common/onMapCommand.ts" /&gt;
/// &lt;reference path="../_common/onMapDto.ts" /&gt;
/// &lt;reference path="../_common/onMapQuery.ts" /&gt;
const privateSettersOnly = ((_b = (_a = application.getSettings("c4d1e35c-7c0d-4926-afe0-18f17563ce17")) === null || _a === void 0 ? void 0 : _a.getField("0cf704e1-9a61-499a-bb91-b20717e334f5")) === null || _b === void 0 ? void 0 : _b.value) == "true";
const mapToDomainOperationSettingId = "7c31c459-6229-4f10-bf13-507348cd8828";
var cqrsCrud;
(function (cqrsCrud) {
    async function execute(element) {
        var _a;
        let entity = await DomainHelper.openSelectEntityDialog();
        if (entity == null) {
            return;
        }
        const owningEntity = DomainHelper.getOwningAggregate(entity);
        const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
        const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
        const resultDto = createCqrsResultTypeDto(entity, folder);
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsCreateCommand(entity, folder);
        }
        createCqrsFindByIdQuery(entity, folder, resultDto);
        createCqrsFindAllQuery(entity, folder, resultDto);
        if (!privateSettersOnly) {
            createCqrsUpdateCommand(entity, folder);
        }
        const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
        for (const operation of operations) {
            createCqrsCallOperationCommand(entity, operation, folder);
        }
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsDeleteCommand(entity, folder);
        }
    }
    cqrsCrud.execute = execute;
    function createCqrsCreateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Create${baseName}Command`;
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            let command = folder.getChildren().filter(x =&gt; x.getName() == expectedCommandName)[0];
            let returnType = primaryKeys[0].typeId;
            if (primaryKeys.length &gt; 1) {
                returnType = null;
            }
            command.typeReference.setType(returnType);
            return command;
        }
        let commandManager = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        let entityCtor = entity
            .getChildren("Class Constructor")
            .filter(x =&gt; x.getChildren("Parameter").length &gt; 0)
            .sort((a, b) =&gt; {
            // In descending order:
            return b.getChildren("Parameter").length - a.getChildren("Parameter").length;
        })[0];
        if (entityCtor != null) {
            commandManager.mapToElement(entityCtor, mapToDomainOperationSettingId);
            commandManager.getElement().setMapping([entity.id, entityCtor.id], mapToDomainOperationSettingId);
        }
        else if (!privateSettersOnly) {
            commandManager.mapToElement(entity);
        }
        commandManager.getElement().setMetadata("baseName", baseName);
        let surrogateKey = primaryKeys.length === 1;
        if (surrogateKey) {
            commandManager.setReturnType(primaryKeys[0].typeId);
        }
        if (entityCtor) {
            commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(entityCtor, "Parameter")
                .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        }
        else {
            if (!surrogateKey) {
                ServicesHelper.addDtoFieldsFromDomain(commandManager.getElement(), primaryKeys);
            }
            commandManager.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
            commandManager.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        }
        onMapCommand(commandManager.getElement(), true, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCreateCommand = createCqrsCreateCommand;
    function createCqrsFindByIdQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedQueryName = `Get${baseName}ByIdQuery`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(query, primaryKeys);
        onMapQuery(query);
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindByIdQuery = createCqrsFindByIdQuery;
    function createCqrsFindAllQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, true);
        let expectedQueryName = `Get${baseName}Query`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.typeReference.setIsCollection(true);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindAllQuery = createCqrsFindAllQuery;
    function createCqrsUpdateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Update${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        command.mapToElement(entity);
        command.getElement().setMetadata("baseName", baseName);
        command.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
        command.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command.getElement(), primaryKeys);
        onMapCommand(command.getElement(), true);
        command.collapse();
        return command.getElement();
    }
    cqrsCrud.createCqrsUpdateCommand = createCqrsUpdateCommand;
    function createCqrsCallOperationCommand(entity, operation, folder) {
        var _a;
        const owningAggregate = DomainHelper.getOwningAggregate(entity);
        const baseName = (_a = owningAggregate === null || owningAggregate === void 0 ? void 0 : owningAggregate.getName()) !== null &amp;&amp; _a !== void 0 ? _a : "";
        let operationName = operation.getName();
        operationName = removeSuffix(operationName, "Async");
        operationName = toPascalCase(operationName);
        const commandName = `${operationName}${entity.getName()}Command`;
        const existing = folder.getChildren().find(x =&gt; {
            var _a, _b;
            return x.getName() == commandName ||
                ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) === operation.id;
        });
        if (existing) {
            return existing;
        }
        const commandElement = createElement("Command", commandName, folder.id);
        commandElement.setMetadata("baseName", baseName);
        const commandManager = new ElementManager(commandElement, { childSpecialization: "DTO-Field" });
        commandManager.mapToElement([entity.id, operation.id], mapToDomainOperationSettingId);
        const primaryKeys = DomainHelper.getPrimaryKeys(entity);
        for (const key of primaryKeys) {
            commandManager.addChild(key.name, lookup(key.id).typeReference);
        }
        commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(operation, "Parameter")
            .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        onMapCommand(commandElement, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCallOperationCommand = createCqrsCallOperationCommand;
    function createCqrsDeleteCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Delete${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = createElement("Command", expectedCommandName, folder.id);
        command.setMapping(entity.id);
        command.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), command.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command, primaryKeys);
        onMapCommand(command, true);
        command.collapse();
        return command;
    }
    cqrsCrud.createCqrsDeleteCommand = createCqrsDeleteCommand;
    function createCqrsResultTypeDto(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedDtoName = `${baseName}Dto`;
        let existing = folder.getChildren().find(x =&gt; x.getName() == expectedDtoName);
        if (existing) {
            return existing;
        }
        let dto = createElement("DTO", expectedDtoName, folder.id);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(entity.id);
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), dto.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        ServicesHelper.addDtoFieldsFromDomain(dto, primaryKeys);
        let attributesWithMapPaths = DomainHelper.getAttributesWithMapPath(entity);
        for (var attr of attributesWithMapPaths) {
            if (dto.getChildren("DTO-Field").some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == attr.id; })) {
                continue;
            }
            let field = createElement("DTO-Field", attr.name, dto.id);
            field.typeReference.setType(attr.typeId);
            field.setMapping(attr.mapPath);
        }
        onMapDto(dto);
        dto.collapse();
        return dto;
    }
    cqrsCrud.createCqrsResultTypeDto = createCqrsResultTypeDto;
    function getMandatoryAssociationsWithMapPath(entity) {
        return traverseInheritanceHierarchy(entity, [], []);
        function traverseInheritanceHierarchy(entity, results, generalizationStack) {
            entity
                .getAssociations("Association")
                .filter(x =&gt; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable &amp;&amp; x.typeReference.isNavigable &amp;&amp;
                !x.getOtherEnd().typeReference.isCollection &amp;&amp; !x.getOtherEnd().typeReference.isNullable)
                .forEach(association =&gt; {
                return results.push({
                    id: association.id,
                    name: association.getName(),
                    typeId: null,
                    mapPath: generalizationStack.concat([association.id]),
                    isNullable: false,
                    isCollection: false
                });
            });
            let generalizations = entity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return results;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            return traverseInheritanceHierarchy(generalization.typeReference.getType(), results, generalizationStack);
        }
    }
    function getBaseNameForElement(owningAggregate, entity, entityIsMany) {
        let entityName = entityIsMany ? toPascalCase(pluralize(entity.getName())) : toPascalCase(entity.getName());
        return owningAggregate ? `${toPascalCase(owningAggregate.getName())}${entityName}` : entityName;
    }
})(cqrsCrud || (cqrsCrud = {}));
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro/create-crud-macro.ts
 */
await cqrsCrud.execute(element);
</script>
        </option>
        <option>
          <text>Create CRUD CQRS Operations</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return application.isModuleInstalled("Intent.Modelers.Services.CQRS") &amp;&amp;
    application.getSettings("0ecca7c5-96f7-449a-96b9-f65ba0a4e3ad").getField("14bc1e98-930b-494c-97a9-5da4e1f3a5fa").value == "advanced";</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../typings/elementmacro.context.api.d.ts" /&gt;
function getSurrogateKeyType() {
    var _a, _b, _c;
    const commonTypes = {
        guid: "6b649125-18ea-48fd-a6ba-0bfff0d8f488",
        long: "33013006-E404-48C2-AC46-24EF5A5774FD",
        int: "fb0a362d-e9e2-40de-b6ff-5ce8167cbe74"
    };
    const javaTypes = {
        long: "e9e575eb-f8de-4ce4-9838-2d09665a752d",
        int: "b3e5cb3b-8a26-4346-810b-9789afa25a82"
    };
    const typeNameToIdMap = new Map();
    typeNameToIdMap.set("guid", commonTypes.guid);
    typeNameToIdMap.set("int", lookup(javaTypes.int) != null ? javaTypes.int : commonTypes.int);
    typeNameToIdMap.set("long", lookup(javaTypes.long) != null ? javaTypes.long : commonTypes.long);
    let typeName = (_c = (_b = (_a = application.getSettings("ac0a788e-d8b3-4eea-b56d-538608f1ded9")) === null || _a === void 0 ? void 0 : _a.getField("Key Type")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "int";
    if (typeNameToIdMap.has(typeName)) {
        return typeNameToIdMap.get(typeName);
    }
    return typeNameToIdMap.get("guid");
}
/// &lt;reference path="getSurrogateKeyType.ts"/&gt;
class DomainHelper {
    static async openSelectEntityDialog(options) {
        let classes = lookupTypesOf("Class").filter(x =&gt; DomainHelper.isAggregateRoot(x) || ((options === null || options === void 0 ? void 0 : options.includeOwnedRelationships) != false &amp;&amp; DomainHelper.ownerIsAggregateRoot(x)) || x.hasStereotype("Repository"));
        if (classes.length == 0) {
            await dialogService.info("No Domain types could be found. Please ensure that you have a reference to the Domain package and that at least one class exists in it.");
            return null;
        }
        let classId = await dialogService.lookupFromOptions(classes.map((x) =&gt; ({
            id: x.id,
            name: this.getFriendlyDisplayNameForClassSelection(x)
        })));
        if (classId == null) {
            await dialogService.error(`No class found with id "${classId}".`);
            return null;
        }
        let foundEntity = lookup(classId);
        return foundEntity;
    }
    static getFriendlyDisplayNameForClassSelection(element) {
        let found = DomainHelper.getOwningAggregate(element);
        return !found ? element.getName() : `${element.getName()} (${found.getName()})`;
    }
    static isAggregateRoot(element) {
        let result = !element.getAssociations("Association")
            .some(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable);
        return result;
    }
    static getOwningAggregate(entity) {
        var _a;
        let result = (_a = entity.getAssociations("Association")
            .filter(x =&gt; this.isAggregateRoot(x.typeReference.getType()) &amp;&amp; isOwnedBy(x) &amp;&amp;
            // Let's only target collections for now as part of the nested compositional crud support
            // as one-to-one relationships are more expensive to address and possibly not going to
            // be needed.
            x.getOtherEnd().typeReference.isCollection)[0]) === null || _a === void 0 ? void 0 : _a.typeReference.getType();
        return result;
        function isOwnedBy(association) {
            return association.isSourceEnd() &amp;&amp;
                !association.typeReference.isNullable &amp;&amp;
                !association.typeReference.isCollection;
        }
    }
    static ownerIsAggregateRoot(entity) {
        let result = DomainHelper.getOwningAggregate(entity);
        return result ? true : false;
    }
    static getPrimaryKeys(entity) {
        if (!entity) {
            throw new Error("entity not specified");
        }
        let primaryKeys = DomainHelper.getPrimaryKeysMap(entity);
        if (Object.keys(primaryKeys).length == 0) {
            return [
                {
                    id: null,
                    name: DomainHelper.getAttributeNameFormat("Id"),
                    typeId: DomainHelper.getSurrogateKeyType(),
                    mapPath: null,
                    isNullable: false,
                    isCollection: false
                }
            ];
        }
        return Object.values(primaryKeys);
    }
    static getPrimaryKeysMap(entity) {
        let keydict = Object.create(null);
        let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        keys.forEach(key =&gt; keydict[key.id] = {
            id: key.id,
            name: key.getName(),
            typeId: key.typeReference.typeId,
            mapPath: [key.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
        return keydict;
        function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
            baseKeys.forEach(key =&gt; {
                keydict[key.id] = {
                    id: key.id,
                    name: key.getName(),
                    typeId: key.typeReference.typeId,
                    mapPath: generalizationStack.concat([key.id]),
                    isNullable: key.typeReference.isNullable,
                    isCollection: key.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
        }
    }
    static getForeignKeys(entity, owningAggregate) {
        var _a;
        if (!entity) {
            throw new Error("entity not specified");
        }
        if (!owningAggregate) {
            throw new Error("nestedCompOwner not specified");
        }
        // Use the new Associated property on the FK stereotype method for FK Attribute lookup
        let foreignKeys = [];
        for (let attr of entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Foreign Key"))) {
            let associationId = (_a = attr.getStereotype("Foreign Key").getProperty("Association")) === null || _a === void 0 ? void 0 : _a.getValue();
            if (owningAggregate.getAssociations("Association").some(x =&gt; x.id == associationId)) {
                foreignKeys.push(attr);
            }
        }
        // Backward compatible lookup method
        if (foreignKeys.length == 0) {
            let foundFk = entity.getChildren("Attribute")
                .filter(x =&gt; x.getName().toLowerCase().indexOf(owningAggregate.getName().toLowerCase()) &gt;= 0 &amp;&amp; x.hasStereotype("Foreign Key"))[0];
            if (foundFk) {
                foreignKeys.push(foundFk);
            }
        }
        if (foreignKeys.length &gt; 0) {
            return foreignKeys.map(x =&gt; ({
                name: DomainHelper.getAttributeNameFormat(x.getName()),
                typeId: x.typeReference.typeId,
                id: x.id,
                mapPath: [x.id],
                isCollection: x.typeReference.isCollection,
                isNullable: x.typeReference.isNullable
            }));
        }
        // Implicit FKs:
        return [{
                name: DomainHelper.getAttributeNameFormat(`${owningAggregate.getName()}Id`),
                typeId: DomainHelper.getPrimaryKeys(owningAggregate)[0].typeId,
                id: null,
                mapPath: null,
                isCollection: false,
                isNullable: false
            }];
    }
    static getChildrenOfType(entity, type) {
        let attrDict = Object.create(null);
        let attributes = entity.getChildren(type);
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        return Object.values(attrDict);
    }
    static getAttributesWithMapPath(entity) {
        let attrDict = Object.create(null);
        let attributes = entity
            .getChildren("Attribute")
            .filter(x =&gt; {
            var _a;
            return !x.hasStereotype("Primary Key") &amp;&amp;
                !DomainHelper.legacyPartitionKey(x) &amp;&amp;
                (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
        });
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
        return Object.values(attrDict);
        function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !DomainHelper.legacyPartitionKey(x));
            baseKeys.forEach(attr =&gt; {
                attrDict[attr.id] = {
                    id: attr.id,
                    name: attr.getName(),
                    typeId: attr.typeReference.typeId,
                    mapPath: generalizationStack.concat([attr.id]),
                    isNullable: attr.typeReference.isNullable,
                    isCollection: attr.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
        }
    }
    static getAttributeNameFormat(str) {
        let convention = DomainHelper.getDomainAttributeNamingConvention();
        switch (convention) {
            case "pascal-case":
                return toPascalCase(str);
            case "camel-case":
                return toCamelCase(str);
        }
        return str;
    }
    static getDomainAttributeNamingConvention() {
        var _a, _b, _c;
        const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
        return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
    }
    static getSurrogateKeyType() {
        return getSurrogateKeyType();
    }
    // Just in case someone still uses this convention. Used to filter out those attributes when mapping
    // to domain entities that are within a Cosmos DB paradigm.
    static legacyPartitionKey(attribute) {
        return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
    }
    static requiresForeignKey(associationEnd) {
        return DomainHelper.isManyToVariantsOfOne(associationEnd) || DomainHelper.isSelfReferencingZeroToOne(associationEnd);
    }
    static isManyToVariantsOfOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.getOtherEnd().typeReference.isCollection;
    }
    static isSelfReferencingZeroToOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.typeReference.isNullable &amp;&amp;
            associationEnd.typeReference.typeId == associationEnd.getOtherEnd().typeReference.typeId;
    }
}
;
class ServicesConstants {
}
ServicesConstants.dtoToEntityMappingId = "942eae46-49f1-450e-9274-a92d40ac35fa"; //"01d74d4f-e478-4fde-a2f0-9ea92255f3c5";
ServicesConstants.dtoFromEntityMappingId = "1f747d14-681c-4a20-8c68-34223f41b825";
class ServicesHelper {
    static addDtoFieldsFromDomain(dto, attributes) {
        var _a;
        for (let key of attributes) {
            if (dto &amp;&amp; !dto.getChildren("DTO-Field").some(x =&gt; x.getName() == ServicesHelper.getFieldFormat(key.name))) {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(key.name), dto.id);
                field.typeReference.setType(key.typeId);
                if (((_a = key.mapPath) !== null &amp;&amp; _a !== void 0 ? _a : []).length &gt; 0) {
                    field.setMapping(key.mapPath);
                }
            }
        }
    }
    static getParameterFormat(str) {
        return toCamelCase(str);
    }
    static getRoutingFormat(str) {
        return pluralize(str);
    }
    static getFieldFormat(str) {
        return toPascalCase(str);
    }
}
class ElementManager {
    constructor(command, settings) {
        var _a;
        this.command = command;
        this.settings = settings;
        this.mappedElement = (_a = command.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    }
    get id() { return this.command.id; }
    ;
    setReturnType(typeId, isCollection) {
        this.command.typeReference.setType(typeId);
        if (isCollection != null) {
            this.command.typeReference.setIsCollection(isCollection);
        }
        return this;
    }
    addChild(name, type) {
        let field = createElement(this.settings.childSpecialization, ServicesHelper.getFieldFormat(name), this.command.id);
        const typeReferenceDetails = type == null
            ? null
            : typeof (type) === "string"
                ? { id: type, isNullable: false, isCollection: false }
                : { id: type.typeId, isNullable: type.isNullable, isCollection: type.isCollection };
        if (typeReferenceDetails != null) {
            field.typeReference.setType(typeReferenceDetails.id);
            field.typeReference.setIsCollection(typeReferenceDetails.isCollection);
            field.typeReference.setIsNullable(typeReferenceDetails.isNullable);
        }
        return field;
    }
    addChildrenFrom(elements, options) {
        let order = 0;
        elements.forEach(e =&gt; {
            if (e.mapPath != null) {
                if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == e.id; })) {
                    return;
                }
            }
            else if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; x.getName().toLowerCase() === e.name.toLowerCase())) {
                return;
            }
            let field = this.addChild(ServicesHelper.getFieldFormat(e.name), e.typeId);
            field.typeReference.setIsCollection(e.isCollection);
            field.typeReference.setIsNullable(e.isNullable);
            if (options === null || options === void 0 ? void 0 : options.addToTop) {
                field.setOrder(order++);
            }
            if (this.mappedElement != null &amp;&amp; e.mapPath) {
                field.setMapping(e.mapPath);
            }
        });
        return this;
    }
    mapToElement(param1, mappingSettingsId) {
        let elementIds;
        let element;
        if (Array.isArray(param1)) {
            elementIds = param1;
            element = lookup(elementIds[elementIds.length - 1]);
        }
        else {
            elementIds = [param1.id];
            element = param1;
        }
        this.mappedElement = element;
        this.command.setMapping(elementIds, mappingSettingsId);
        return this;
    }
    getElement() {
        return this.command;
    }
    collapse() {
        this.command.collapse();
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getSurrogateKeyType.ts" /&gt;
const constants = {
    PKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
        ExplicitComposite: "explicit_composite",
        Unknown: "unknown"
    },
    FKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
    }
};
function getFieldFormat(str) {
    return toPascalCase(str);
}
function getDomainAttributeNameFormat(str) {
    let convention = getDomainAttributeNamingConvention();
    switch (convention) {
        case "pascal-case":
            return toPascalCase(str);
        case "camel-case":
            return toCamelCase(str);
        default:
            return str;
    }
}
function getOrCreateDto(elementName, parentElement) {
    const expectedDtoName = `${elementName}Dto`;
    let existingDto = parentElement.getChildren("DTO").filter(x =&gt; x.getName() === expectedDtoName)[0];
    if (existingDto) {
        return existingDto;
    }
    let dto = createElement("DTO", expectedDtoName, parentElement.id);
    return dto;
}
function ensureDtoFields(autoAddPrimaryKey, mappedElement, dto) {
    var _a, _b, _c;
    let dtoUpdated = false;
    let domainElement = mappedElement
        .typeReference
        .getType();
    let attributesWithMapPaths = getAttributesWithMapPath(domainElement);
    let isCreateMode = ((_b = (_a = dto.getMetadata("originalVerb")) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.startsWith("create")) == true;
    for (var keyName of Object.keys(attributesWithMapPaths)) {
        let entry = attributesWithMapPaths[keyName];
        if (isCreateMode &amp;&amp; ((_c = entry.name) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === "id") {
            continue;
        }
        if (isCreateMode &amp;&amp; isOwnerForeignKey(entry.name, domainElement)) {
            continue;
        }
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == entry.name)) {
            continue;
        }
        let field = createElement("DTO-Field", entry.name, dto.id);
        field.typeReference.setType(entry.typeId);
        field.typeReference.setIsNullable(entry.isNullable);
        field.typeReference.setIsCollection(entry.isCollection);
        field.setMapping(entry.mapPath);
        dtoUpdated = true;
    }
    if (autoAddPrimaryKey &amp;&amp; !isCreateMode) {
        addPrimaryKeys(dto, domainElement, true);
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
function isOwnerForeignKey(attributeName, domainElement) {
    for (let association of domainElement.getAssociations().filter(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable)) {
        if (attributeName.toLowerCase().indexOf(association.getName().toLowerCase()) &gt;= 0) {
            return true;
        }
    }
    return false;
}
function addPrimaryKeys(dto, entity, map) {
    const primaryKeys = getPrimaryKeysWithMapPath(entity);
    if (primaryKeys.length == 0) {
        // Implicit key:
        primaryKeys.push({
            id: null,
            name: "Id",
            typeId: getSurrogateKeyType(),
            mapPath: null,
            isNullable: false,
            isCollection: false
        });
    }
    for (const primaryKey of primaryKeys) {
        const name = getDomainAttributeNameFormat(primaryKey.name);
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName().toLowerCase() == name.toLowerCase())) {
            continue;
        }
        const dtoField = createElement("DTO-Field", getFieldFormat(name), dto.id);
        dtoField.typeReference.setType(primaryKey.typeId);
        if (map &amp;&amp; primaryKey.mapPath != null) {
            console.log(`Doing mapping for ${dtoField.id}`);
            dtoField.setMapping(primaryKey.mapPath);
        }
    }
}
function getPrimaryKeysWithMapPath(entity) {
    let keydict = Object.create(null);
    let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
    keys.forEach(key =&gt; keydict[key.id] = {
        id: key.id,
        name: key.getName(),
        typeId: key.typeReference.typeId,
        mapPath: [key.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
    return Object.values(keydict);
    function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        baseKeys.forEach(key =&gt; {
            keydict[key.id] = {
                id: key.id,
                name: key.getName(),
                typeId: key.typeReference.typeId,
                mapPath: generalizationStack.concat([key.id]),
                isNullable: key.typeReference.isNullable,
                isCollection: key.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
    }
}
function getAttributesWithMapPath(entity) {
    let attrDict = Object.create(null);
    let attributes = entity.getChildren("Attribute")
        .filter(x =&gt; {
        var _a;
        return !x.hasStereotype("Primary Key") &amp;&amp;
            !legacyPartitionKey(x) &amp;&amp;
            (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
    });
    attributes.forEach(attr =&gt; attrDict[attr.id] = {
        id: attr.id,
        name: attr.getName(),
        typeId: attr.typeReference.typeId,
        mapPath: [attr.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
    return attrDict;
    function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !legacyPartitionKey(x));
        baseKeys.forEach(attr =&gt; {
            attrDict[attr.id] = {
                id: attr.id,
                name: attr.getName(),
                typeId: attr.typeReference.typeId,
                mapPath: generalizationStack.concat([attr.id]),
                isNullable: attr.typeReference.isNullable,
                isCollection: attr.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
    }
}
function getDomainAttributeNamingConvention() {
    var _a, _b, _c;
    const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
    return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
}
// Just in case someone still uses this convention. Used to filter out those attributes when mapping
// to domain entities that are within a Cosmos DB paradigm.
function legacyPartitionKey(attribute) {
    return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
}
/**
 * Workaround for element's from referenced packages not having getParent()
 * @param element The element whose parent should be searched for
 * @param parentSpecializationType The specialization type of the parent
 */
function getParent(element, parentSpecializationType) {
    const elements = lookupTypesOf(parentSpecializationType);
    const parent = elements
        .find(x =&gt; x.getChildren(element.specialization)
        .some(child =&gt; child.id === element.id));
    if (parent == null) {
        throw new Error("Could not find parent");
    }
    return parent;
}
/// &lt;reference path="../common/domainHelper.ts" /&gt;
/// &lt;reference path="../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../common/getParent.ts" /&gt;
/**
 * Gets select details of a mapped Command/Query. Intended for centralized logic of working out
 * things like keys (including implicit ones) for both the entity and owning entity if applicable.
 *
 * If the Command is for entity creation (either due to being mapped to a constructor or being
 * prefixed with "Create"), then primary keys for the entity are not populated.
 * @param request The Command or Query that has been mapped
 */
function getMappedRequestDetails(request) {
    var _a;
    const mappedElement = (_a = request.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    if (mappedElement == null) {
        return null;
    }
    let entity = mappedElement;
    if (entity.specialization !== "Class") {
        entity = getParent(entity, "Class");
    }
    const result = {
        entity: entity,
        mappingTargetType: mappedElement.specialization,
        entityKeyFields: [],
        ownerKeyFields: []
    };
    result.owningEntity = DomainHelper.getOwningAggregate(entity);
    // As long as it's not for creation, populate the PKs of the entity:
    if (result.mappingTargetType !== "Class Constructor" &amp;&amp;
        !request.getName().toLowerCase().startsWith("Create")) {
        result.entityKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity)
            : getKeysForOperationMapping(request, entity);
    }
    // If the entity is owned, populate its fields:
    if (result.owningEntity != null) {
        result.ownerKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity, result.owningEntity)
            : getKeysForOperationMapping(request, entity, result.owningEntity);
    }
    return result;
    /**
     * Return field details for primary keys. As requests mapped to operations and constructors can
     * never possibly map the attributes, these fields can only ever be matched by name.
     * @param request The CQRS Command or Query entity
     * @param owningEntity The Owning Aggregate Class
     */
    function getKeysForOperationMapping(request, entity, owningEntity) {
        const pks = DomainHelper.getPrimaryKeys(owningEntity !== null &amp;&amp; owningEntity !== void 0 ? owningEntity : entity);
        return pks.map(pk =&gt; {
            let fieldName = toPascalCase(pk.name);
            if (owningEntity != null) {
                fieldName = removePrefix(fieldName, toPascalCase(owningEntity.getName()));
                fieldName = `${owningEntity.getName()}${toCamelCase(fieldName)}`;
            }
            fieldName = ServicesHelper.getFieldFormat(fieldName);
            const existingField = request.getChildren("DTO-Field").find(field =&gt; field.getName().toLowerCase() == fieldName.toLowerCase());
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: [],
                name: fieldName,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
    function getKeysForClassMapping(request, entity, owningEntity) {
        const keys = owningEntity != null
            ? DomainHelper.getForeignKeys(entity, owningEntity)
            : DomainHelper.getPrimaryKeys(entity);
        return keys.map(pk =&gt; {
            const existingField = request.getChildren("DTO-Field").find(field =&gt; {
                if (field.getMapping() != null) {
                    return field.getMapping().getPath().some(x =&gt; x.id == pk.id);
                }
                return (pk.name.toLowerCase() === field.getName().toLowerCase());
            });
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: pk.mapPath,
                name: pk.name,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/**
 * Ensures that for the provided contract, it has the provided field creating it if necessary and
 * then ensure the field has the correct typeReference details and order.
 * The field's element is returned.
 */
function ensureHasField(options) {
    const { contract, fieldDetail, mappingSettingsId, order } = options;
    let field = fieldDetail.existingId != null
        ? contract.getChildren("DTO-Field").find(x =&gt; x.id === fieldDetail.existingId)
        : createElement("DTO-Field", fieldDetail.name, contract.id);
    field.typeReference.setType(fieldDetail.typeId);
    field.typeReference.setIsCollection(fieldDetail.isCollection);
    field.typeReference.setIsNullable(fieldDetail.isNullable);
    if (order != null) {
        field.setOrder(order);
    }
    if (mappingSettingsId != null) {
        field.setMapping(fieldDetail.mappingPath, mappingSettingsId);
    }
    return field;
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/// &lt;reference path="ensureHasField.ts" /&gt;
function onMapCommand(element, isForCrudScript, isForCreate = false) {
    var _a, _b, _c;
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const mapFromDomainMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    // const mapToDomainDataSettingsId = "735c87d0-06fc-4491-8b5f-5adc6f953c54";
    const mappingDetails = getMappedRequestDetails(element);
    if (mappingDetails == null) {
        return;
    }
    if (isForCrudScript ||
        mappingDetails.mappingTargetType !== "Class") {
        let order = 0;
        let keyFields = mappingDetails.ownerKeyFields;
        if (!isForCreate) {
            keyFields = keyFields.concat(mappingDetails.entityKeyFields);
        }
        for (const keyField of keyFields) {
            ensureHasField({
                contract: element,
                fieldDetail: keyField,
                order: order++
            });
        }
    }
    if (mappingDetails.mappingTargetType === "Operation" &amp;&amp;
        isComplexType((_c = (_b = (_a = element.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.typeReference) === null || _c === void 0 ? void 0 : _c.getType())) {
        getOrCreateCommandCrudDto(element, element, false, mapFromDomainMappingSettingId);
    }
    const fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; ((_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement().specialization.startsWith("Association")); });
    fields.forEach(field =&gt; {
        getOrCreateCommandCrudDto(element, field, true, projectMappingSettingId);
    });
    const complexFields = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp;
            isComplexType((_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType());
    });
    complexFields.forEach(cf =&gt; {
        getOrCreateCommandCrudDto(element, cf, false, projectMappingSettingId);
    });
    function isComplexType(element) {
        if (element == null) {
            console.warn("isComplexType element parameter received null");
        }
        return (element === null || element === void 0 ? void 0 : element.specialization) === "Data Contract" ||
            (element === null || element === void 0 ? void 0 : element.specialization) === "Value Object";
    }
    function getOrCreateCommandCrudDto(command, dtoField, autoAddPrimaryKey, mappingTypeSettingId) {
        let mappedElement = dtoField.getMapping().getElement();
        if (mappedElement.typeReference == null)
            throw new Error("TypeReference is undefined");
        let originalVerb = (command.getName().split(/(?=[A-Z])/))[0];
        let domainName = mappedElement.typeReference.getType().getName();
        let baseName = command.getMetadata("baseName")
            ? `${command.getMetadata("baseName")}${domainName}`
            : domainName;
        let dtoName = `${originalVerb}${baseName}`;
        let dto = getOrCreateDto(dtoName, command.getParent());
        dto.setMetadata("originalVerb", originalVerb);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(mappedElement.typeReference.getTypeId(), mappingTypeSettingId);
        ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
        dtoField.typeReference.setType(dto.id);
    }
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
const stringTypeId = "d384db9c-a279-45e1-801e-e4e8099625f2";
function onMapDto(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b, _c; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; ((_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.specialization.startsWith("Association")); });
    fields.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, true);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, false);
    });
}
function getOrCreateDtoCrudDto(element, dtoField, autoAddPrimaryKey) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const originalDtoMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    let mappedElement = dtoField.getMapping().getElement();
    let originalVerb = "";
    if (element.hasMetadata("originalVerb")) {
        originalVerb = element.getMetadata("originalVerb");
        // In the event that the prefix is no longer the same as the
        // originally called verb, then don't propagate this any further
        // as end users might get confused.
        if (element.getName().indexOf(originalVerb) &lt; 0) {
            originalVerb = "";
        }
    }
    let targetMappingSettingId = dtoField.getParent().getMapping().mappingSettingsId;
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : domainName;
    let dtoName = `${originalVerb}${baseName}`;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), targetMappingSettingId);
    if (originalVerb !== "") {
        dto.setMetadata("originalVerb", originalVerb);
    }
    dto.setMetadata("baseName", baseName);
    ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
function onMapQuery(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; x.getMapping().getElement().specialization.startsWith("Association"); });
    fields.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
}
function getOrCreateQueryCrudDto(element, dtoField) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    let mappedElement = dtoField.getMapping().getElement();
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : `${domainName}`;
    let dtoName = baseName;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), projectMappingSettingId);
    dto.setMetadata("baseName", baseName);
    ensureDtoFieldsQuery(mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
function ensureDtoFieldsQuery(mappedElement, dto) {
    let dtoUpdated = false;
    let mappedElementAttributes = mappedElement
        .typeReference
        .getType()
        .getChildren("Attribute");
    let dtoFields = dto.getChildren("DTO-Field");
    for (let attribute of mappedElementAttributes.filter(x =&gt; !dtoFields.some(y =&gt; x.getName() === y.getName()))) {
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == attribute.getName())) {
            continue;
        }
        let field = createElement("DTO-Field", attribute.getName(), dto.id);
        field.typeReference.setType(attribute.typeReference.typeId);
        field.typeReference.setIsNullable(attribute.typeReference.isNullable);
        field.typeReference.setIsCollection(attribute.typeReference.isCollection);
        field.setMapping(attribute.id);
        dtoUpdated = true;
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
var _a, _b;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../_common/onMapCommand.ts" /&gt;
/// &lt;reference path="../_common/onMapDto.ts" /&gt;
/// &lt;reference path="../_common/onMapQuery.ts" /&gt;
const privateSettersOnly = ((_b = (_a = application.getSettings("c4d1e35c-7c0d-4926-afe0-18f17563ce17")) === null || _a === void 0 ? void 0 : _a.getField("0cf704e1-9a61-499a-bb91-b20717e334f5")) === null || _b === void 0 ? void 0 : _b.value) == "true";
const mapToDomainOperationSettingId = "7c31c459-6229-4f10-bf13-507348cd8828";
var cqrsCrud;
(function (cqrsCrud) {
    async function execute(element) {
        var _a;
        let entity = await DomainHelper.openSelectEntityDialog();
        if (entity == null) {
            return;
        }
        const owningEntity = DomainHelper.getOwningAggregate(entity);
        const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
        const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
        const resultDto = createCqrsResultTypeDto(entity, folder);
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsCreateCommand(entity, folder);
        }
        createCqrsFindByIdQuery(entity, folder, resultDto);
        createCqrsFindAllQuery(entity, folder, resultDto);
        if (!privateSettersOnly) {
            createCqrsUpdateCommand(entity, folder);
        }
        const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
        for (const operation of operations) {
            createCqrsCallOperationCommand(entity, operation, folder);
        }
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsDeleteCommand(entity, folder);
        }
    }
    cqrsCrud.execute = execute;
    function createCqrsCreateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Create${baseName}Command`;
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            let command = folder.getChildren().filter(x =&gt; x.getName() == expectedCommandName)[0];
            let returnType = primaryKeys[0].typeId;
            if (primaryKeys.length &gt; 1) {
                returnType = null;
            }
            command.typeReference.setType(returnType);
            return command;
        }
        let commandManager = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        let entityCtor = entity
            .getChildren("Class Constructor")
            .filter(x =&gt; x.getChildren("Parameter").length &gt; 0)
            .sort((a, b) =&gt; {
            // In descending order:
            return b.getChildren("Parameter").length - a.getChildren("Parameter").length;
        })[0];
        if (entityCtor != null) {
            commandManager.mapToElement(entityCtor, mapToDomainOperationSettingId);
            commandManager.getElement().setMapping([entity.id, entityCtor.id], mapToDomainOperationSettingId);
        }
        else if (!privateSettersOnly) {
            commandManager.mapToElement(entity);
        }
        commandManager.getElement().setMetadata("baseName", baseName);
        let surrogateKey = primaryKeys.length === 1;
        if (surrogateKey) {
            commandManager.setReturnType(primaryKeys[0].typeId);
        }
        if (entityCtor) {
            commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(entityCtor, "Parameter")
                .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        }
        else {
            if (!surrogateKey) {
                ServicesHelper.addDtoFieldsFromDomain(commandManager.getElement(), primaryKeys);
            }
            commandManager.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
            commandManager.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        }
        onMapCommand(commandManager.getElement(), true, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCreateCommand = createCqrsCreateCommand;
    function createCqrsFindByIdQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedQueryName = `Get${baseName}ByIdQuery`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(query, primaryKeys);
        onMapQuery(query);
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindByIdQuery = createCqrsFindByIdQuery;
    function createCqrsFindAllQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, true);
        let expectedQueryName = `Get${baseName}Query`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.typeReference.setIsCollection(true);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindAllQuery = createCqrsFindAllQuery;
    function createCqrsUpdateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Update${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        command.mapToElement(entity);
        command.getElement().setMetadata("baseName", baseName);
        command.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
        command.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command.getElement(), primaryKeys);
        onMapCommand(command.getElement(), true);
        command.collapse();
        return command.getElement();
    }
    cqrsCrud.createCqrsUpdateCommand = createCqrsUpdateCommand;
    function createCqrsCallOperationCommand(entity, operation, folder) {
        var _a;
        const owningAggregate = DomainHelper.getOwningAggregate(entity);
        const baseName = (_a = owningAggregate === null || owningAggregate === void 0 ? void 0 : owningAggregate.getName()) !== null &amp;&amp; _a !== void 0 ? _a : "";
        let operationName = operation.getName();
        operationName = removeSuffix(operationName, "Async");
        operationName = toPascalCase(operationName);
        const commandName = `${operationName}${entity.getName()}Command`;
        const existing = folder.getChildren().find(x =&gt; {
            var _a, _b;
            return x.getName() == commandName ||
                ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) === operation.id;
        });
        if (existing) {
            return existing;
        }
        const commandElement = createElement("Command", commandName, folder.id);
        commandElement.setMetadata("baseName", baseName);
        const commandManager = new ElementManager(commandElement, { childSpecialization: "DTO-Field" });
        commandManager.mapToElement([entity.id, operation.id], mapToDomainOperationSettingId);
        const primaryKeys = DomainHelper.getPrimaryKeys(entity);
        for (const key of primaryKeys) {
            commandManager.addChild(key.name, lookup(key.id).typeReference);
        }
        commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(operation, "Parameter")
            .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        onMapCommand(commandElement, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCallOperationCommand = createCqrsCallOperationCommand;
    function createCqrsDeleteCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Delete${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = createElement("Command", expectedCommandName, folder.id);
        command.setMapping(entity.id);
        command.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), command.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command, primaryKeys);
        onMapCommand(command, true);
        command.collapse();
        return command;
    }
    cqrsCrud.createCqrsDeleteCommand = createCqrsDeleteCommand;
    function createCqrsResultTypeDto(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedDtoName = `${baseName}Dto`;
        let existing = folder.getChildren().find(x =&gt; x.getName() == expectedDtoName);
        if (existing) {
            return existing;
        }
        let dto = createElement("DTO", expectedDtoName, folder.id);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(entity.id);
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), dto.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        ServicesHelper.addDtoFieldsFromDomain(dto, primaryKeys);
        let attributesWithMapPaths = DomainHelper.getAttributesWithMapPath(entity);
        for (var attr of attributesWithMapPaths) {
            if (dto.getChildren("DTO-Field").some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == attr.id; })) {
                continue;
            }
            let field = createElement("DTO-Field", attr.name, dto.id);
            field.typeReference.setType(attr.typeId);
            field.setMapping(attr.mapPath);
        }
        onMapDto(dto);
        dto.collapse();
        return dto;
    }
    cqrsCrud.createCqrsResultTypeDto = createCqrsResultTypeDto;
    function getMandatoryAssociationsWithMapPath(entity) {
        return traverseInheritanceHierarchy(entity, [], []);
        function traverseInheritanceHierarchy(entity, results, generalizationStack) {
            entity
                .getAssociations("Association")
                .filter(x =&gt; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable &amp;&amp; x.typeReference.isNavigable &amp;&amp;
                !x.getOtherEnd().typeReference.isCollection &amp;&amp; !x.getOtherEnd().typeReference.isNullable)
                .forEach(association =&gt; {
                return results.push({
                    id: association.id,
                    name: association.getName(),
                    typeId: null,
                    mapPath: generalizationStack.concat([association.id]),
                    isNullable: false,
                    isCollection: false
                });
            });
            let generalizations = entity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return results;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            return traverseInheritanceHierarchy(generalization.typeReference.getType(), results, generalizationStack);
        }
    }
    function getBaseNameForElement(owningAggregate, entity, entityIsMany) {
        let entityName = entityIsMany ? toPascalCase(pluralize(entity.getName())) : toPascalCase(entity.getName());
        return owningAggregate ? `${toPascalCase(owningAggregate.getName())}${entityName}` : entityName;
    }
})(cqrsCrud || (cqrsCrud = {}));
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro/create-crud-macro.ts
 */
//await cqrsCrud.execute(element);
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
var convertToE2EMapping;
(function (convertToE2EMapping) {
    function execute() {
        if (element.isMapped() &amp;&amp; element.specialization == "Command") {
            convertCommand(element);
        }
        else if (element.isMapped() &amp;&amp; element.specialization == "Query") {
            convertQuery(element);
        }
    }
    convertToE2EMapping.execute = execute;
    function convertCommand(command) {
        var _a;
        let target = command.getMapping().getElement();
        let entity = (_a = target.getParent("Class")) !== null &amp;&amp; _a !== void 0 ? _a : target;
        if (command.getName().startsWith("Create")) {
            let action = createAssociation("Create Entity Action", command.id, target.id);
            let mapping = action.createMapping(command.id, entity.id);
            mapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
            mapContract("Data Mapping", command, [command.id], [target.id], mapping);
        }
        else if (command.getName().startsWith("Delete")) {
            let action = createAssociation("Delete Entity Action", command.id, entity.id);
            let mapping = action.createMapping(command.id, entity.id);
            let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
            let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
            if (idField &amp;&amp; entityPk) {
                mapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
            }
            mapContract("Filter Mapping", command, [command.id], [target.id], mapping);
        }
        else if (command.isMapped()) {
            let action = createAssociation("Update Entity Action", command.id, target.id);
            // Query Entity Mapping
            let queryMapping = action.createMapping(command.id, entity.id, "25f25af9-c38b-4053-9474-b0fabe9d7ea7");
            let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
            let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
            if (idField &amp;&amp; entityPk) {
                queryMapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
            }
            // Update Entity Mapping
            let updateMapping = action.createMapping(command.id, entity.id, "01721b1a-a85d-4320-a5cd-8bd39247196a");
            if (target.id != entity.id) {
                updateMapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
            }
            mapContract("Data Mapping", command, [command.id], [target.id], updateMapping);
        }
    }
    convertToE2EMapping.convertCommand = convertCommand;
    function convertQuery(query) {
        let entity = query.getMapping().getElement();
        let action = createAssociation("Query Entity Action", query.id, entity.id);
        if (query.typeReference.getIsCollection()) {
            action.typeReference.setIsCollection(true);
        }
        let mapping = action.createMapping(query.id, entity.id);
        mapContract("Filter Mapping", query, [query.id], [entity.id], mapping);
    }
    convertToE2EMapping.convertQuery = convertQuery;
    function mapContract(mappingType, dto, sourcePath, targetPathIds, mapping) {
        console.log("mapContract: " + dto.getName());
        dto.getChildren("DTO-Field").filter(x =&gt; x.isMapped() &amp;&amp; !(dto.specialization == "Command" &amp;&amp; x.getMapping().getElement().hasStereotype("Primary Key"))).forEach(field =&gt; {
            var _a, _b;
            if (((_a = field.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" || field.typeReference.getIsCollection()) {
                mapping.addMappedEnd(mappingType, sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)));
            }
            if (((_b = field.typeReference.getType()) === null || _b === void 0 ? void 0 : _b.specialization) == "DTO") {
                mapContract(mappingType, field.typeReference.getType(), sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)), mapping);
            }
            field.clearMapping();
        });
        dto.clearMapping();
    }
})(convertToE2EMapping || (convertToE2EMapping = {}));
//convertToE2EMapping.execute();
/// &lt;reference path="../create-crud-macro/create-crud-macro.ts"/&gt;
/// &lt;reference path="../convert-to-e2e-mapping/convert-to-e2e-mapping.ts"/&gt;
async function execute(element) {
    var _a;
    let entity = await DomainHelper.openSelectEntityDialog();
    if (entity == null) {
        return;
    }
    const owningEntity = DomainHelper.getOwningAggregate(entity);
    const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
    const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
    const resultDto = cqrsCrud.createCqrsResultTypeDto(entity, folder);
    if (owningEntity == null || !privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsCreateCommand(entity, folder));
    }
    convertToE2EMapping.convertQuery(cqrsCrud.createCqrsFindByIdQuery(entity, folder, resultDto));
    convertToE2EMapping.convertQuery(cqrsCrud.createCqrsFindAllQuery(entity, folder, resultDto));
    if (!privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsUpdateCommand(entity, folder));
    }
    const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
    for (const operation of operations) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsCallOperationCommand(entity, operation, folder));
    }
    if (owningEntity == null || !privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsDeleteCommand(entity, folder));
    }
    const diagramElement = createElement("Diagram", folderName, folder.id);
    diagramElement.loadDiagram();
    const diagram = getCurrentDiagram();
    diagram.layoutVisuals(folder, null, true);
}
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro-e2e-mapping/create-crud-macro-e2e-mapping.ts
 */
await execute(element);
</script>
        </option>
      </scriptOptions>
      <typeOrder />
    </packageExtension>
  </packageExtensions>
  <elementSettings>
    <elementSetting type="Processing Action" typeId="405a2857-b911-431f-8142-719a0e9f15f3">
      <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAB3VJREFUeF7tnVlsVFUYgL9/prIIRR8oiUpETY2RKG1DogajLyoaE4kJEBNf3BK2aX0wStAHY9yqUaMRWypEFGNU1CqKoiBoNK4o0orBhbKordCiiJYywMyd35zp3NpOO525S6czk3sTHkjPv5zv/nfOuef857/CKF2VdTqpHKZaCU4T4VyU8wUqUaYSogLlVJRxSfeEYwiHUbpQ2lXYjbJThbZwnP3dY2hvWy7/jkZXJK9G52t4RgVXCSwU4VJgfOpf2JUfQhzlGBBV5XNCNLV2spnXxXKlz4XQiAM871YtH3sys0MJ5iBcAZzhwk8nIu3AZlXWx2DTzkY54kTYadsRAzhzgZ4SK2NeSKgHKpw65lP7Lglx1xhY9/UIPeK+AzTg4mUsE+EG4GyfQHhVswdYG47x6LaV8o9XZf3lfQNYWadjyy2u096Iq/TTSd90KbsE7ukOs75tuRz3Q68vAKffrmeOsWgGqoEyPxwbQR1m4Nkeh7k/NMrvXu14AmiibkKCm0S5FxnxwcFrXwfIK7SLcv+JKazZeZ+ccKvcNcCZC/TkeBlPiLAwOVMrzktRVoTj3LVtpRx10wVXHa+p04qERbMIl7kxWoAyn4bHMXfbE/KnU98cA7ywVi8MK+uBaU6NFXj7fZYwZ8czssOJn44AVi3SMyTMV8BUJ0aKqG27WlzS2iQdufqcM8BU5G0oYXg2s3ZLuDbXSMwJ4MwFOtkq4xuEs3K9M0Xebm84xkXbVmb/TcwK0Iy21km8D1xe5FCcua98Eo5zbbbReViAZp43McGTwGJn1kujtcLyWAV3DjdPHBZgVUQXCDQV8TzP650088SFLY2yKpOijABrIjotucZWZG8YXomly5s3lliYS3c+Lb8NpXtIgMlH1+JLhBq/HSpGfQrf9YSYNdQCxJAAq2t1PsrLRbAwkK/7ESfBjS0r5PV0g4MAmvU86yS+LdglqXwhG2xndzjGzPT1xEEAq5ZovQjLRs/PgrZc39Ig9/T3cADAVPRtL6CV5EKjuWdsiJr+2wMDAFYt1lskxOp8eT1xPPREQfNl0Ac7Cre1Nkgfoz6AZvds/Dj2IEz2wU5OKl5eCms/hbfN8kTxXAdPKOfYu319AGfU6tyQ8kY++7HpIZg8Cd74DJo2wKHufFp3b0uVua2N8qbR0AewOqIvADe5V+tc0gCsOKX3ET5wCO5YCT+ZXd3Cv9a0NMjN/wOcr+HqCn7N91uHDdDm1X0Unv8QXv0Eoq53KfJAX+loOcg0kwGRjMCqOp0tCTbmwfQAE+kA7T9+8SMsWw3d0Xx75MBenNktz8qHvQCX6FsiXO9A3JemmQAa5fsPwePN8FGrL6Z8V6LQ3Nog8+TiOp10PEHbaKRfDAfQ9FgVXtwCz20syGjsik6gUmrqdLom+BqY6PttyqIwG0Ab4v6/obYR9h7It4fD2jsicS6WGRG9IkTy989dipmHPuUC0Fb/17+w6gNY9yUcj3kw6p9oPCFcLTURXazQ6J/e3DU5AWhr3fQdPPAKHCmAAUaVRVId0WeASO7d9q+lG4DG+r5OqF8LW3/xzxc3msySv1RF9H2Ba9wo8CrjFqD927jiPXjpY4j6kmflqjcbpLpWd6Bc4Erco5AXgMZ0QnsHlkgDdB726Iw78e9NBHYKTHEn703KK0DbetdhaHgX3tsKVsKbT06kFQ5I1RKNiqSy4Z1I+9DWL4D2I/3OV/BYM/SYtPP8XD1mEDH3LOsG+0j44ydA279fOuChV+H7vSPh8SCdVskB3NUBD+YTYPAIe4rUnmAQ8cAvOYgU+zRm3wFY0gidf3sg4V40OY0p2ol0U2oifXRUJ9LF+ir3Gmz92X3o+CGZfJULFhPco0wuJgTLWa4BppazFup0LQsWVF1gPBJXLpLzlmr5+B52B0v6jhF2RaNUBptKjrn1CvRtKpn/BNuaLij239Yk2Fh3RjB9Y91IF0Rqxyr4yfMBVGcsXLZOS+0AguSi3FEOmVwUpLflDHDo9LbkYBIkWGalmDHB0kgGKb5Z+Q2f4puMwlqtFw2SzDOgHD7JvF8UBsccBhPM7ZhDckoTHLRJx5f7QRsjGRz1GsjP8VEvIx4cNky98yodsTJmOTpsaPMPjrvi/rir/ShPsHhKhEVZB/gSbOD5wHVqVA6O/A8THDmldCSLTvSe4Cy1WjGZ0PhXdMK2EJQ9GZp1ThHYN6iUeuEdoV3jI1R4Jy0SS7H006+WcF2uBXdsHo4i0BYqxeJjEmLe9uVy0OlkwhVAe3QuifJ3CZrCFndmK7CTCaxrgH3zxGItwKh0INzfE2KNl3KgngDad6XoSoDC9rgWQAnQ/mGdXIBQ5qA8XMAVP9pEubvgitD2BxmUQXY6DGVo31eIGx7JZx2GNHe6gKXhGOv8rh/taRrjhHFaKfgrgdOdyLtoa4oGbElYrI+H2Fi0peCH7HjqYwQIi0Iwy/PHCMB8dMAcOzyqyhcl+TGCTBFkInPCOKbGhdPTP4ehwhSBckgeAApB6nMYCcxE13wOow3hR1V2lSl/9Byj/efVMio1P/4DVZlkAcv1M3UAAAAASUVORK5CYII=" />
      <saveAsOwnFile>false</saveAsOwnFile>
      <allowRename>true</allowRename>
      <allowAbstract>false</allowAbstract>
      <allowStatic>false</allowStatic>
      <allowGenericTypes>false</allowGenericTypes>
      <allowMapping>false</allowMapping>
      <allowSorting>true</allowSorting>
      <sortChildren p4:nil="true" xmlns:p4="http://www.w3.org/2001/XMLSchema-instance" />
      <allowFindInView>false</allowFindInView>
      <allowTypeReference>false</allowTypeReference>
      <allowConvertToType p4:nil="true" xmlns:p4="http://www.w3.org/2001/XMLSchema-instance" />
      <allowSetValue>false</allowSetValue>
      <typeOrder />
      <creationOptions />
      <scriptOptions />
      <mappingOptions>
        <option mappingType="Process Action Mapping" mappingTypeId="01bc7593-a6a2-45aa-8497-b4b6a269ab68">
          <text>Map Update</text>
          <shortcut>ctrl + shift + m</shortcut>
        </option>
      </mappingOptions>
      <mappingSettings />
      <childElementSettings />
    </elementSetting>
  </elementSettings>
  <elementExtensions>
    <elementExtension type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
      <creationOptions>
        <option type="association">
          <text>Create Entity</text>
          <shortcut>ctrl + shift + c</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Create Entity Action</specializationType>
          <specializationTypeId>7a3f0474-3cf8-4249-baac-8c07c49465e0</specializationTypeId>
          <defaultName>NewCreateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Update Entity</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Update Entity Action</specializationType>
          <specializationTypeId>9ea0382a-4617-412a-a8c8-af987bbce226</specializationTypeId>
          <defaultName>NewUpdateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Delete Entity</text>
          <shortcut>ctrl + shift + d</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Delete Entity Action</specializationType>
          <specializationTypeId>bfc823fb-60ab-451d-ba62-12671fe7e28e</specializationTypeId>
          <defaultName>NewDeleteEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
      </creationOptions>
      <scriptOptions>
        <option>
          <text>Convert to advanced mapping system</text>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return isMapped();</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
if (element.isMapped() &amp;&amp; element.specialization == "Command") {
    convertCommand(element);
}
else if (element.isMapped() &amp;&amp; element.specialization == "Query") {
    convertQuery(element);
}
function convertCommand(command) {
    var _a;
    let target = command.getMapping().getElement();
    let entity = (_a = target.getParent("Class")) !== null &amp;&amp; _a !== void 0 ? _a : target;
    if (command.getName().startsWith("Create")) {
        let action = createAssociation("Create Entity Action", command.id, target.id);
        let mapping = action.createMapping(command.id, entity.id);
        mapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
        mapContract("Data Mapping", command, [command.id], [target.id], mapping);
    }
    else if (command.getName().startsWith("Delete")) {
        let action = createAssociation("Delete Entity Action", command.id, entity.id);
        let mapping = action.createMapping(command.id, entity.id);
        let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
        let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
        if (idField &amp;&amp; entityPk) {
            mapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
        }
        mapContract("Filter Mapping", command, [command.id], [target.id], mapping);
    }
    else if (command.isMapped()) {
        let action = createAssociation("Update Entity Action", command.id, target.id);
        // Query Entity Mapping
        let queryMapping = action.createMapping(command.id, entity.id, "25f25af9-c38b-4053-9474-b0fabe9d7ea7");
        let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
        let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
        if (idField &amp;&amp; entityPk) {
            queryMapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
        }
        // Update Entity Mapping
        let updateMapping = action.createMapping(command.id, entity.id, "01721b1a-a85d-4320-a5cd-8bd39247196a");
        if (target.id != entity.id) {
            updateMapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
        }
        mapContract("Data Mapping", command, [command.id], [target.id], updateMapping);
    }
}
function convertQuery(query) {
    let entity = query.getMapping().getElement();
    let action = createAssociation("Query Entity Action", query.id, entity.id);
    if (query.typeReference.getIsCollection()) {
        action.typeReference.setIsCollection(true);
    }
    let mapping = action.createMapping(query.id, entity.id);
    mapContract("Filter Mapping", query, [query.id], [entity.id], mapping);
}
function mapContract(mappingType, dto, sourcePath, targetPathIds, mapping) {
    console.log("mapContract: " + dto.getName());
    dto.getChildren("DTO-Field").filter(x =&gt; x.isMapped() &amp;&amp; !(dto.specialization == "Command" &amp;&amp; x.getMapping().getElement().hasStereotype("Primary Key"))).forEach(field =&gt; {
        if (field.typeReference.getType().specialization != "DTO" || field.typeReference.getIsCollection()) {
            mapping.addMappedEnd(mappingType, sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)));
        }
        if (field.typeReference.getType().specialization == "DTO") {
            mapContract(mappingType, field.typeReference.getType(), sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)), mapping);
        }
        field.clearMapping();
    });
    dto.clearMapping();
}
</script>
        </option>
      </scriptOptions>
      <mappingOptions>
        <option mappingType="Map Return Type" mappingTypeId="b7ae8bf5-f2fd-4a5c-b57e-05410687bfc4">
          <text>Map Return Type</text>
          <shortcut>ctrl + shift + m</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAEbtJREFUeF7tXQl4VdW1/te5QxIgAwmEMSEDoBIGFZUqAjcCCejXOtVaZ+sTJ5TBOk9UK9X3ROMAKFrE8T1rW8GB0YeJyhOrIAK5ARWBEISQkeQmJLnDWf3WicEEcs7ZN0MD9q3vu1/gO/vsvdZ/9tl7TXsdQqcQk8ezOwI4GOlyRXXTXdxDDwaiwegBjXowO3qA9WjStHiGHk9MPRkcT0Q9mdGdCG6AnAx2CXsECgAcZIafCLVMXEk6VTBzJWlaBet6BUjzEYVqoHMNCDWa0+XTAlQTCNQdAuLq8/JSGgDijhaXOqrDsWPXRbu6x5+nEf9C13kUiBJAHEeg7gBcYHKC2AGwBpD8COAOGl+AYfnpAOlgCoE4CCDA4FowHQS4jECfh5jWBWoO5q5ff1ZdR8jeZgGmTv0uojYUGKORfi6BMsF8CoiMGXMsE7M8NaoH6ZuY6DME8W6Uy/3lypVDGtrCd9gAXnKJ111cTcMd0OcTtDGNM+p4JtIZ/Bk4NM1X7v9+48bTAuFIExaA4ydvGuLQ3PMAZAOICGeg46DtIYBWBYL+e9etPflbVX6VABx2idedWKVdRhR6CqB41c6Py3aMcp312TUVw9/auFE2L2uyBXD06A2umIRuC0B8rbEZ/HtQgEGLfWWHZti90pYATpy4LUF36jkALgPg/PfA7rCUoja95Qhps9auPancTHZTAGXmRSdELCHSrugM4ESJ0TQylJnGH0H7UbkxxiNCE3OG8iZayo9/dF3+y42KCwO6bAMdruE1Ss2MN3zlddeZzcRWAWxc87CQCNe0deYJKA4Hwe0mxPV0IT7ehZ7xLsTFOhET60S3bg5ERmqIiNDgdMqP4JCfg6AJoM3AbNLwdAZCIUYoyAgaPx0NDTrq63UcOhRCVVUQVQeDqKwMoKIigIOVAfj9bNzTDoBlJr5aEotbCv6a4T9yMrUKoGey91rS8GI4a57LRejTNwKDBkViUEoUkpIiEZ/gQo8eTmOGdQUJaDW+oAFm0Z56FBbWobCwHgeKGxAIhDVlA8zatLw1J71qC+D4SVtPcmj0GYjiVIVOHxyFyy7vh1693HC5tS4DzI5fAdTv11FW5sdbb+7H99+rGyMMVIJDZ+WtGbm9+Tgt5oZYF3Uh/1IiTLVjRq4n9nHjvPN6Y9Qp0XC7jy99WoD8elM1ViwvQ8mBo95ME/FpeaTmuri51dICwAkT80/XnLQOEGPemgYMiMD02wYhrufxvTlXVgSwYP4e7PtByZLzs66PzftwxIYmdA4DeOaZRVGRMdUC3qlK4M0YhLi44xu8JjkPHgxi0cIiY420JeaN9b7qcU3OiMMAerILJoF5TTPtodW++vZ1Y8bslJ8NeE1C+nxBPP1kIfbvt56JhjOCMTn3w4y1hrbV1IEnKz+HiGbZPYFbbk3G8BE97Jodl9fzt/qwcH6RPe9MOblrht3eAsDM7ILNAI+0uvvU0dH43X8MNHS1nyOJQr74z3uxaaPPRjzekrt6+KjDAI6b+lVvpx65HxCHZ+skSu99D6YZqsrxQKKytEX/LC/z40+P7kJdXchKzJAW1PqIiWdMpcws73UgLLa6Iy09CjNnp0AU5mOVBLTvdxzC/62rRG1tCD17ujDe0xP9+0cqgykWzrNPF2LHd4csxdRDoes+/t+RSww0PNn5Swgk3hZTyspOwAUX9TlWsTNMu4/WlmP5+6UtrAxZbn57eV+cNbanMojLlpZgzaoyS1mZsThvTcb15PHkOhGRuI6AMVZ33HBTEk4+JfqYBVA2gEXP7zXs3iNJlPw77k7BwIGRSvxv/lr6st5MmPE5/CXjyOPx9qAIbAQw1Kx38ZLMeWQwevc+dte/Z3IK8c32WlOAhp7QDTNnpRhOCjsqLfHj4Tk7IF4fC/qWGzCaPJ4NvcgdlQ+C6fsp6968nBOP2fVPzLIH7/8OvmrzhT82zok5Dw82PEB2JI6GO2Zvt3Q4MOOAI6Rl0NhJ3mS3A5sBmDoPZDGe+/gQu3G77LrsmHMe2IGaGnMAxYX24Jx0dO9uqmi04P++u7+FWCgWdNAfwigaN9E7zOnEPwCYasepqVG4857ULgPIbuDOAPC/Ht+F3bssTbuaUMh1Bo3L9p7hBD4GYLrCnnJqDKbdONBOji673hkAvrSoCJu+slSo63Xi8SQ2MDGvAJkHjDLPiccll/btMoDsBu4MAN9+az/ycivNh2YOQKOplDlp60VwaG8DMF0cfnV+Iqac28tOji673hkArlxeivffK7WSKcRMv6bM7PyrAXqluWPhyLsuv7Ifzh7Xs8sAshu4MwBc90kl/vvN/VZDS4rINfIKzyTw02YtxZ687voBGH1arJ0cbbpeXR2ErzqIiEgNcXEuI7gULnUGgBs3VOHlP/9gHYxifSZNyPbO1YD7zJiW0ONN05MwfHjHurBE11r692J8+UW1oW9pDiAh3oWrrx2ApGQ1i6GJ584AMD+/Bi8sKDJCpmbEzI/ShKz8BRrRLWaNZEbcOiMZQ0+QLLWOIYmS/f3tYnz9te+oJyxhzutvGIiMMB5YZwD47Te1eO7ZPUYI1RRAYD55sryvE+FKs0Zihcy6fRBS07p1CHrlZQE892yhZSAnPb0bZt+RYgTaVagzANy18xBynipE0DL8ya9RZrZ3GYDzzRgVQ/z3d6UYcd720raCGrzx+n5IIMeKxNwSs0vMLxXqDAAljjzviV0I+M1nIDGWkSc7/yMjQdKE5JW6695U9OvX9mw2WUe8+TV47dV9qLUwt5pYkGXjoT+ko5ei80I2oocf2oG6OnPrPzbWiYceTkdUlJopt39fA8QakcwHi1d4LWVm5X8OIlNXlsyGe+5PQ2Ji2z0xX35RhTdf32ekWahQdLQDjzw6xNiZVWhvUT0e/9NOS++J2PNzHklXjl9LrFj6lLQR800En1NmdsFGgE1DmYYr/4E05dnQfDBxB637tBLv/K1YGTy5/+zxcbj8iv4q2BltVq0sw3vLSizbJw+KxN33pik7VUtL/XjsURsAwRtlE9lKhOFmo0dFSSwkHQkJ4aUGint96xYfFr+0VzkPRXTO/gMiMGPWIERHq61/8oo99cRuFBXVWwIYrjnaGBvZabksALxFNhHJ9TjBHEAH7n8ozciuCofktX3jtX3K4EnfY8+Ow4UX9zEyt1RIvM/L3jmA3I8q7JyfuOOuFKSlq2sSFeUBzP2jAGjuImNgG3myvdsIONESwAfTjEwrVZLAzosvFMHns4xsHe5OVKWs7F6Yel4vI2dQhSQGsnpVKVZ8UGabutY70W34AsOxctQA5O3kySrYQsQjLF/hB9KR0EsNQMkxyXlqt9JuK2MKeL+7fgBGjoxWAk8SKwt31ePtt4uxp7De0lJokmni5ARc/OvwAmKSwSVroNXODpDxCks8xHITufeBNKV4iCQ2yswr3G29HjV/WBJnGTzE/tUS4GRHlHjFgQN+IwqnQjLrRA1TDSg19SnjPDZXbRNZT4RfmDFjqDH3pRmpbFYU8OtYuGAPvtluHU9VEbqj2sim9KsLEpE9JXxXnJIaA1pPmVnetSCcY8a0oUjfk4p+/c0VadlxP3i/BKtXliu9Uh0FkF0/kvgpKXgqgaQj+9q3rwFPKCnStqYc4fd3pVqaclUHA3jgvh2txmTthOys66L433BzEvpbPHirsYv21GHeE7stTTlmLJU18DUAV5l1puJM+O7bWuQ8WdhZWITdr0TeZswe1C77fef3h/B0joIzwZOdP59A0824NNxZM5MxdKi5O6twdx3+87FdYQvaGTekpkXhyqv6Wy45KuOqubN4PmVmb5sL6JYO1ZunJ1n658QakEj+wUrLOKoK321uI2/KqJOjcdkV/ZQdBlaD5W+twQsL7RyqmCsO1dka0VNmnam69LdvqzXySay8F21Gx+JG8RmOGhUNz8QEpKdHKemSKnyouPQZNIs8WfnXENGS9gaVZCdeuaIUK5eXhbWZCACq1kfT4R05eyKZBknJERgzJg7iKFDtQwU8afPpJ5X4H5ugEsDXUuakbRfBoVuGNX95fiKmKoQ1xTZd+rdi5OZW2ppXTYIMGdoNl17Wz9ZLIgaevKbuCA0uOdnkorBMM1XgmtqtWF6KD2zCmqTTJTQha+tkDdpyq8C6JzMev/mtWmBdEhuXLN6LAq95plRzYWRWjRjZwwBRfHbHCv3lrf342CawzqSdS+dke89g29SOaEy7MUlZNjnDJhnvO3cqHBv4sdeBSZG48eaksN1mykyF2fClF/Zi06Zqq7vqg8AEmjjVO0zXbZKL0qJw593hJReJLSkHWNRPAcGwt6+8uj/kte5qUkkuCgYxhiZN8iaHOim9TZwLz88vwt696s4F0TtvuTUJJ57UsXHocB+IcnqbkWAZEZUPWCVYangy5wRj4Q6X5MipJG0XF6ueRwPSB3fD7Xek2G4s4fKi2l4SNu+8/Ru1BMvGFF+SuEinpfjK6/zKyz9gl3W+3WH5jLDmI4MhkbSuIImHSJTPOsWXvnFxQFJ8c51wJ35q5dISIWSBF02/rRQI6Fg4X83dJZn14kG2c6G1lRe7+7Zu9uH5hTZJ5qD1aDgwvvGcyBTvIjBusOpYfGrnX5hoN7bl9ZqaIN57txSfrau0fLoxMU784Y/piIxUi420i6lWbn7v3RKsWmF9zAGMRblrMm5qBDC74GqAjzqN3bxvWZckWtbegzaibL//bgk+zqs0NfsklU5S6rqCVA/aMOGqvFUZbxgAnpntjY8EH5CCX2ZMR0p4U+LDHXDUS9aWrzdV4ZWX9x3lmpcUEvH+qIY1OxrkxliI7VGvQD2q+q5ffVZFs+Ou3q8IOMWKodGnxeDa6wZ0yGFDsZ3FDSbK6oFiv1GcQlxmp50R2yYPckcAKXGXJYt/wIYvLRVoGeqr3NUZo+UfhwGckOV9RiPMsGPk5luTMGJE2zcTu/678nqBtwbzn91jywIDz+StzjCOBv80A6ds80DXP7I7cD1gQCRum5UMWeh/TiQ2fM683ZBYiBU1HrjWMnM/PElONvwE4JlnfhYVERP7MQGn2wGTnByJm6cnK6ef2fXX1del3syLzxep6qn/4IZunry8VMO8amFaeCZ7TyYNn6tUZhMQp8/ousW+o0CXo/4Lnt2DPXuUzM2GAHjMutXD5WSXQS0AlNqAZdUQ36BpwmVzxvv2jcAvL+htZBUcb6fYRZ3astkH0flkE1MhZizrHYtL/9qsgtFRxu34rO2pGoW+IEA5Gj1yVDQuvDgR8fFuw8nZlpPiKgK0t43s/KLnVZT7sfSdEgNAVWJQqc7amE/WnNgiemZV+umlcOpmSQBeslhTUqMMF7vEY6VmluhzXQWoACavqDg0ZHOQXBqxx4v3N4QZuzEK4F6ft2a4fekneSJSfKxPFeWAeFo49bOaP81Wi48JoDEOo56WxG4FdJebWrjofyo+9tNMbiw+xmgqPmYUHgswAkHdSNz0N+jGEX8xFeXIa1PxMfkrOc7tLD4mtQRfLInh25WLjwkQHg87ye1dDKKrVad5uO0ay921LIFnzFap3nZEZ40l8H6s1dus9J0ovzYHo8Nlq0V7Bl5BQ8m0vLzMVmO2/1+A0RxeowBjBGHm6tUZFWbNbD2kRiHG+MiFpJHUEjx2oj7tmle2NweY8bKvvO62dpUAbRpm2DCvO3EAfgMNOeHszrZsHoMNmLmcWZtd+gP/paDg6IKLR7JsOwOb33D2xC1pTodzHmmYAuaoY1D+9rBUy8AqAPfkrc7YodpRWAAe3qGrMYSZnyOi8VbnjFWZ6OJ2ITByQ+y/pbYitNvulW3XDGx+s6yN3RMiTtckuMzsAWgUw/iQQNgP5V8JoGzg8rECMG8gok9Zd7zvq6jZHC5wTTx3mLCG2uMqmECETB18FkC9Wv8YAeT4kfjqO2zsH4URTUeOBbT6MQIClzLoEy2of6jrZV+YqSXhPsyOFqJJllY/h8GaK5pYjyVQDLPei0jro4NjiTkGhB4Mkk9mRB3+HAazq1En/OlzGCDUEdjHTD4QfBqoilk/QKSVMbiaSasiPeD7V30O45+WOt/BqOJnNgAAAABJRU5ErkJggg==" />
          <isOptionVisibleFunction>return false &amp;&amp; typeReference?.isTypeFound();</isOptionVisibleFunction>
        </option>
      </mappingOptions>
      <typeOrder>
        <type>Create Entity Action</type>
        <type>Update Entity Action</type>
        <type>Delete Entity Action</type>
      </typeOrder>
      <mappingSettings />
    </elementExtension>
    <elementExtension type="Diagram" typeId="8c90aca5-86f4-47f1-bd58-116fe79f5c55">
      <mappingSettings />
      <diagramSettings>
        <addNewElementsTo>Package</addNewElementsTo>
        <elementVisualSettings>
          <visualSettings type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
            <size width="${w}" height="70" />
            <position x="${x}" y="${y}" />
            <display>
              <drawText>
                <text>return getName();</text>
                <style>`font-size: 12px; 
font-family: Helvetica; 
font-weight: bold; 
text-align: center; 
white-space: inherit;
vertical-align: center`</style>
                <size width="${w}" height="18" />
                <position x="${x}" y="${y + 48}" />
              </drawText>
              <drawSvgResource>
                <path>dynamodb-table.svg</path>
                <size width="${w}" height="40" />
                <position x="${x}" y="${y + 6}" />
              </drawSvgResource>
            </display>
            <defaultSize width="${x}" height="70" />
            <autoResizeEnabledByDefault>true</autoResizeEnabledByDefault>
            <childElementVisualSettings>
              <childElementVisualSetting type="Class Constructor" typeId="dec2bd12-4699-4f45-8ec9-3b62dc692d2b">
                <size width="`${parent.w}`" height="18" />
                <position x="`${parent.x}`" y="`${parent.y + ($index * 20) + 66}`" />
                <anchorPointsFunction>return [getDimensions().getCenterLeft(), getDimensions().getCenterRight()];</anchorPointsFunction>
                <display>
                  <drawText>
                    <text>return label;</text>
                    <size width="${w - 26}" height="${h}" />
                    <position x="${x + 24}" y="${y}" />
                  </drawText>
                  <drawSvgResource>
                    <path>method.svg</path>
                    <size width="20" height="20" />
                    <position x="${x}" y="${y}" />
                  </drawSvgResource>
                </display>
                <defaultSize width="`${parent.w}`" height="18" />
                <autoResizeEnabledByDefault>true</autoResizeEnabledByDefault>
                <childElementVisualSettings />
              </childElementVisualSetting>
              <childElementVisualSetting type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
                <size width="`${parent.w}`" height="18" />
                <position x="`${parent.x}`" y="`${parent.y + (parent.elements['Class Constructor'].any() ? 2 : 0) + (parent.elements['Class Constructor'].size.height) + ($index * 20) + 66}`" />
                <anchorPointsFunction>return [getDimensions().getCenterLeft(), getDimensions().getCenterRight()];</anchorPointsFunction>
                <display>
                  <drawText>
                    <text>return label;</text>
                    <size width="${w - 26}" height="${h}" />
                    <position x="${x + 24}" y="${y}" />
                  </drawText>
                  <drawSvgResource>
                    <path>method.svg</path>
                    <size width="20" height="20" />
                    <position x="${x}" y="${y}" />
                  </drawSvgResource>
                </display>
                <defaultSize width="`${parent.w}`" height="18" />
                <autoResizeEnabledByDefault>true</autoResizeEnabledByDefault>
                <childElementVisualSettings />
              </childElementVisualSetting>
            </childElementVisualSettings>
          </visualSettings>
        </elementVisualSettings>
        <associationVisualSettings>
          <visualSettings type="Domain Event Origin Association" typeId="4c0cc50b-8a9d-43cd-b731-9f354f69f3c9">
            <lineType>Curved</lineType>
            <lineDashArray>return "3,7";</lineDashArray>
            <sourceEnd>
              <pointIndicator>
                <path>return `a 4,4 0 1,0 4,4 
        a 4,4 0 1,0 -4,4`;</path>
              </pointIndicator>
            </sourceEnd>
            <targetEnd>
              <pointIndicator>
                <path>return `l 4 8 l -8 0 l 4 -8 Z`</path>
              </pointIndicator>
            </targetEnd>
          </visualSettings>
        </associationVisualSettings>
      </diagramSettings>
    </elementExtension>
    <elementExtension type="Folder" typeId="4d95d53a-8855-4f35-aa82-e312643f5c5f">
      <creationOptions />
      <scriptOptions>
        <option>
          <text>Create CQRS CRUD Operations</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return application.isModuleInstalled("Intent.Modelers.Services.CQRS") &amp;&amp;
    application.getSettings("0ecca7c5-96f7-449a-96b9-f65ba0a4e3ad").getField("14bc1e98-930b-494c-97a9-5da4e1f3a5fa").value == "basic";</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../typings/elementmacro.context.api.d.ts" /&gt;
function getSurrogateKeyType() {
    var _a, _b, _c;
    const commonTypes = {
        guid: "6b649125-18ea-48fd-a6ba-0bfff0d8f488",
        long: "33013006-E404-48C2-AC46-24EF5A5774FD",
        int: "fb0a362d-e9e2-40de-b6ff-5ce8167cbe74"
    };
    const javaTypes = {
        long: "e9e575eb-f8de-4ce4-9838-2d09665a752d",
        int: "b3e5cb3b-8a26-4346-810b-9789afa25a82"
    };
    const typeNameToIdMap = new Map();
    typeNameToIdMap.set("guid", commonTypes.guid);
    typeNameToIdMap.set("int", lookup(javaTypes.int) != null ? javaTypes.int : commonTypes.int);
    typeNameToIdMap.set("long", lookup(javaTypes.long) != null ? javaTypes.long : commonTypes.long);
    let typeName = (_c = (_b = (_a = application.getSettings("ac0a788e-d8b3-4eea-b56d-538608f1ded9")) === null || _a === void 0 ? void 0 : _a.getField("Key Type")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "int";
    if (typeNameToIdMap.has(typeName)) {
        return typeNameToIdMap.get(typeName);
    }
    return typeNameToIdMap.get("guid");
}
/// &lt;reference path="getSurrogateKeyType.ts"/&gt;
class DomainHelper {
    static async openSelectEntityDialog(options) {
        let classes = lookupTypesOf("Class").filter(x =&gt; DomainHelper.isAggregateRoot(x) || ((options === null || options === void 0 ? void 0 : options.includeOwnedRelationships) != false &amp;&amp; DomainHelper.ownerIsAggregateRoot(x)) || x.hasStereotype("Repository"));
        if (classes.length == 0) {
            await dialogService.info("No Domain types could be found. Please ensure that you have a reference to the Domain package and that at least one class exists in it.");
            return null;
        }
        let classId = await dialogService.lookupFromOptions(classes.map((x) =&gt; ({
            id: x.id,
            name: this.getFriendlyDisplayNameForClassSelection(x)
        })));
        if (classId == null) {
            await dialogService.error(`No class found with id "${classId}".`);
            return null;
        }
        let foundEntity = lookup(classId);
        return foundEntity;
    }
    static getFriendlyDisplayNameForClassSelection(element) {
        let found = DomainHelper.getOwningAggregate(element);
        return !found ? element.getName() : `${element.getName()} (${found.getName()})`;
    }
    static isAggregateRoot(element) {
        let result = !element.getAssociations("Association")
            .some(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable);
        return result;
    }
    static getOwningAggregate(entity) {
        var _a;
        let result = (_a = entity.getAssociations("Association")
            .filter(x =&gt; this.isAggregateRoot(x.typeReference.getType()) &amp;&amp; isOwnedBy(x) &amp;&amp;
            // Let's only target collections for now as part of the nested compositional crud support
            // as one-to-one relationships are more expensive to address and possibly not going to
            // be needed.
            x.getOtherEnd().typeReference.isCollection)[0]) === null || _a === void 0 ? void 0 : _a.typeReference.getType();
        return result;
        function isOwnedBy(association) {
            return association.isSourceEnd() &amp;&amp;
                !association.typeReference.isNullable &amp;&amp;
                !association.typeReference.isCollection;
        }
    }
    static ownerIsAggregateRoot(entity) {
        let result = DomainHelper.getOwningAggregate(entity);
        return result ? true : false;
    }
    static getPrimaryKeys(entity) {
        if (!entity) {
            throw new Error("entity not specified");
        }
        let primaryKeys = DomainHelper.getPrimaryKeysMap(entity);
        if (Object.keys(primaryKeys).length == 0) {
            return [
                {
                    id: null,
                    name: DomainHelper.getAttributeNameFormat("Id"),
                    typeId: DomainHelper.getSurrogateKeyType(),
                    mapPath: null,
                    isNullable: false,
                    isCollection: false
                }
            ];
        }
        return Object.values(primaryKeys);
    }
    static getPrimaryKeysMap(entity) {
        let keydict = Object.create(null);
        let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        keys.forEach(key =&gt; keydict[key.id] = {
            id: key.id,
            name: key.getName(),
            typeId: key.typeReference.typeId,
            mapPath: [key.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
        return keydict;
        function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
            baseKeys.forEach(key =&gt; {
                keydict[key.id] = {
                    id: key.id,
                    name: key.getName(),
                    typeId: key.typeReference.typeId,
                    mapPath: generalizationStack.concat([key.id]),
                    isNullable: key.typeReference.isNullable,
                    isCollection: key.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
        }
    }
    static getForeignKeys(entity, owningAggregate) {
        var _a;
        if (!entity) {
            throw new Error("entity not specified");
        }
        if (!owningAggregate) {
            throw new Error("nestedCompOwner not specified");
        }
        // Use the new Associated property on the FK stereotype method for FK Attribute lookup
        let foreignKeys = [];
        for (let attr of entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Foreign Key"))) {
            let associationId = (_a = attr.getStereotype("Foreign Key").getProperty("Association")) === null || _a === void 0 ? void 0 : _a.getValue();
            if (owningAggregate.getAssociations("Association").some(x =&gt; x.id == associationId)) {
                foreignKeys.push(attr);
            }
        }
        // Backward compatible lookup method
        if (foreignKeys.length == 0) {
            let foundFk = entity.getChildren("Attribute")
                .filter(x =&gt; x.getName().toLowerCase().indexOf(owningAggregate.getName().toLowerCase()) &gt;= 0 &amp;&amp; x.hasStereotype("Foreign Key"))[0];
            if (foundFk) {
                foreignKeys.push(foundFk);
            }
        }
        if (foreignKeys.length &gt; 0) {
            return foreignKeys.map(x =&gt; ({
                name: DomainHelper.getAttributeNameFormat(x.getName()),
                typeId: x.typeReference.typeId,
                id: x.id,
                mapPath: [x.id],
                isCollection: x.typeReference.isCollection,
                isNullable: x.typeReference.isNullable
            }));
        }
        // Implicit FKs:
        return [{
                name: DomainHelper.getAttributeNameFormat(`${owningAggregate.getName()}Id`),
                typeId: DomainHelper.getPrimaryKeys(owningAggregate)[0].typeId,
                id: null,
                mapPath: null,
                isCollection: false,
                isNullable: false
            }];
    }
    static getChildrenOfType(entity, type) {
        let attrDict = Object.create(null);
        let attributes = entity.getChildren(type);
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        return Object.values(attrDict);
    }
    static getAttributesWithMapPath(entity) {
        let attrDict = Object.create(null);
        let attributes = entity
            .getChildren("Attribute")
            .filter(x =&gt; {
            var _a;
            return !x.hasStereotype("Primary Key") &amp;&amp;
                !DomainHelper.legacyPartitionKey(x) &amp;&amp;
                (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
        });
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
        return Object.values(attrDict);
        function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !DomainHelper.legacyPartitionKey(x));
            baseKeys.forEach(attr =&gt; {
                attrDict[attr.id] = {
                    id: attr.id,
                    name: attr.getName(),
                    typeId: attr.typeReference.typeId,
                    mapPath: generalizationStack.concat([attr.id]),
                    isNullable: attr.typeReference.isNullable,
                    isCollection: attr.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
        }
    }
    static getAttributeNameFormat(str) {
        let convention = DomainHelper.getDomainAttributeNamingConvention();
        switch (convention) {
            case "pascal-case":
                return toPascalCase(str);
            case "camel-case":
                return toCamelCase(str);
        }
        return str;
    }
    static getDomainAttributeNamingConvention() {
        var _a, _b, _c;
        const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
        return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
    }
    static getSurrogateKeyType() {
        return getSurrogateKeyType();
    }
    // Just in case someone still uses this convention. Used to filter out those attributes when mapping
    // to domain entities that are within a Cosmos DB paradigm.
    static legacyPartitionKey(attribute) {
        return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
    }
    static requiresForeignKey(associationEnd) {
        return DomainHelper.isManyToVariantsOfOne(associationEnd) || DomainHelper.isSelfReferencingZeroToOne(associationEnd);
    }
    static isManyToVariantsOfOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.getOtherEnd().typeReference.isCollection;
    }
    static isSelfReferencingZeroToOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.typeReference.isNullable &amp;&amp;
            associationEnd.typeReference.typeId == associationEnd.getOtherEnd().typeReference.typeId;
    }
}
;
class ServicesConstants {
}
ServicesConstants.dtoToEntityMappingId = "942eae46-49f1-450e-9274-a92d40ac35fa"; //"01d74d4f-e478-4fde-a2f0-9ea92255f3c5";
ServicesConstants.dtoFromEntityMappingId = "1f747d14-681c-4a20-8c68-34223f41b825";
class ServicesHelper {
    static addDtoFieldsFromDomain(dto, attributes) {
        var _a;
        for (let key of attributes) {
            if (dto &amp;&amp; !dto.getChildren("DTO-Field").some(x =&gt; x.getName() == ServicesHelper.getFieldFormat(key.name))) {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(key.name), dto.id);
                field.typeReference.setType(key.typeId);
                if (((_a = key.mapPath) !== null &amp;&amp; _a !== void 0 ? _a : []).length &gt; 0) {
                    field.setMapping(key.mapPath);
                }
            }
        }
    }
    static getParameterFormat(str) {
        return toCamelCase(str);
    }
    static getRoutingFormat(str) {
        return pluralize(str);
    }
    static getFieldFormat(str) {
        return toPascalCase(str);
    }
}
class ElementManager {
    constructor(command, settings) {
        var _a;
        this.command = command;
        this.settings = settings;
        this.mappedElement = (_a = command.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    }
    get id() { return this.command.id; }
    ;
    setReturnType(typeId, isCollection) {
        this.command.typeReference.setType(typeId);
        if (isCollection != null) {
            this.command.typeReference.setIsCollection(isCollection);
        }
        return this;
    }
    addChild(name, type) {
        let field = createElement(this.settings.childSpecialization, ServicesHelper.getFieldFormat(name), this.command.id);
        const typeReferenceDetails = type == null
            ? null
            : typeof (type) === "string"
                ? { id: type, isNullable: false, isCollection: false }
                : { id: type.typeId, isNullable: type.isNullable, isCollection: type.isCollection };
        if (typeReferenceDetails != null) {
            field.typeReference.setType(typeReferenceDetails.id);
            field.typeReference.setIsCollection(typeReferenceDetails.isCollection);
            field.typeReference.setIsNullable(typeReferenceDetails.isNullable);
        }
        return field;
    }
    addChildrenFrom(elements, options) {
        let order = 0;
        elements.forEach(e =&gt; {
            if (e.mapPath != null) {
                if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == e.id; })) {
                    return;
                }
            }
            else if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; x.getName().toLowerCase() === e.name.toLowerCase())) {
                return;
            }
            let field = this.addChild(ServicesHelper.getFieldFormat(e.name), e.typeId);
            field.typeReference.setIsCollection(e.isCollection);
            field.typeReference.setIsNullable(e.isNullable);
            if (options === null || options === void 0 ? void 0 : options.addToTop) {
                field.setOrder(order++);
            }
            if (this.mappedElement != null &amp;&amp; e.mapPath) {
                field.setMapping(e.mapPath);
            }
        });
        return this;
    }
    mapToElement(param1, mappingSettingsId) {
        let elementIds;
        let element;
        if (Array.isArray(param1)) {
            elementIds = param1;
            element = lookup(elementIds[elementIds.length - 1]);
        }
        else {
            elementIds = [param1.id];
            element = param1;
        }
        this.mappedElement = element;
        this.command.setMapping(elementIds, mappingSettingsId);
        return this;
    }
    getElement() {
        return this.command;
    }
    collapse() {
        this.command.collapse();
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getSurrogateKeyType.ts" /&gt;
const constants = {
    PKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
        ExplicitComposite: "explicit_composite",
        Unknown: "unknown"
    },
    FKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
    }
};
function getFieldFormat(str) {
    return toPascalCase(str);
}
function getDomainAttributeNameFormat(str) {
    let convention = getDomainAttributeNamingConvention();
    switch (convention) {
        case "pascal-case":
            return toPascalCase(str);
        case "camel-case":
            return toCamelCase(str);
        default:
            return str;
    }
}
function getOrCreateDto(elementName, parentElement) {
    const expectedDtoName = `${elementName}Dto`;
    let existingDto = parentElement.getChildren("DTO").filter(x =&gt; x.getName() === expectedDtoName)[0];
    if (existingDto) {
        return existingDto;
    }
    let dto = createElement("DTO", expectedDtoName, parentElement.id);
    return dto;
}
function ensureDtoFields(autoAddPrimaryKey, mappedElement, dto) {
    var _a, _b, _c;
    let dtoUpdated = false;
    let domainElement = mappedElement
        .typeReference
        .getType();
    let attributesWithMapPaths = getAttributesWithMapPath(domainElement);
    let isCreateMode = ((_b = (_a = dto.getMetadata("originalVerb")) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.startsWith("create")) == true;
    for (var keyName of Object.keys(attributesWithMapPaths)) {
        let entry = attributesWithMapPaths[keyName];
        if (isCreateMode &amp;&amp; ((_c = entry.name) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === "id") {
            continue;
        }
        if (isCreateMode &amp;&amp; isOwnerForeignKey(entry.name, domainElement)) {
            continue;
        }
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == entry.name)) {
            continue;
        }
        let field = createElement("DTO-Field", entry.name, dto.id);
        field.typeReference.setType(entry.typeId);
        field.typeReference.setIsNullable(entry.isNullable);
        field.typeReference.setIsCollection(entry.isCollection);
        field.setMapping(entry.mapPath);
        dtoUpdated = true;
    }
    if (autoAddPrimaryKey &amp;&amp; !isCreateMode) {
        addPrimaryKeys(dto, domainElement, true);
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
function isOwnerForeignKey(attributeName, domainElement) {
    for (let association of domainElement.getAssociations().filter(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable)) {
        if (attributeName.toLowerCase().indexOf(association.getName().toLowerCase()) &gt;= 0) {
            return true;
        }
    }
    return false;
}
function addPrimaryKeys(dto, entity, map) {
    const primaryKeys = getPrimaryKeysWithMapPath(entity);
    if (primaryKeys.length == 0) {
        // Implicit key:
        primaryKeys.push({
            id: null,
            name: "Id",
            typeId: getSurrogateKeyType(),
            mapPath: null,
            isNullable: false,
            isCollection: false
        });
    }
    for (const primaryKey of primaryKeys) {
        const name = getDomainAttributeNameFormat(primaryKey.name);
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName().toLowerCase() == name.toLowerCase())) {
            continue;
        }
        const dtoField = createElement("DTO-Field", getFieldFormat(name), dto.id);
        dtoField.typeReference.setType(primaryKey.typeId);
        if (map &amp;&amp; primaryKey.mapPath != null) {
            console.log(`Doing mapping for ${dtoField.id}`);
            dtoField.setMapping(primaryKey.mapPath);
        }
    }
}
function getPrimaryKeysWithMapPath(entity) {
    let keydict = Object.create(null);
    let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
    keys.forEach(key =&gt; keydict[key.id] = {
        id: key.id,
        name: key.getName(),
        typeId: key.typeReference.typeId,
        mapPath: [key.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
    return Object.values(keydict);
    function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        baseKeys.forEach(key =&gt; {
            keydict[key.id] = {
                id: key.id,
                name: key.getName(),
                typeId: key.typeReference.typeId,
                mapPath: generalizationStack.concat([key.id]),
                isNullable: key.typeReference.isNullable,
                isCollection: key.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
    }
}
function getAttributesWithMapPath(entity) {
    let attrDict = Object.create(null);
    let attributes = entity.getChildren("Attribute")
        .filter(x =&gt; {
        var _a;
        return !x.hasStereotype("Primary Key") &amp;&amp;
            !legacyPartitionKey(x) &amp;&amp;
            (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
    });
    attributes.forEach(attr =&gt; attrDict[attr.id] = {
        id: attr.id,
        name: attr.getName(),
        typeId: attr.typeReference.typeId,
        mapPath: [attr.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
    return attrDict;
    function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !legacyPartitionKey(x));
        baseKeys.forEach(attr =&gt; {
            attrDict[attr.id] = {
                id: attr.id,
                name: attr.getName(),
                typeId: attr.typeReference.typeId,
                mapPath: generalizationStack.concat([attr.id]),
                isNullable: attr.typeReference.isNullable,
                isCollection: attr.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
    }
}
function getDomainAttributeNamingConvention() {
    var _a, _b, _c;
    const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
    return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
}
// Just in case someone still uses this convention. Used to filter out those attributes when mapping
// to domain entities that are within a Cosmos DB paradigm.
function legacyPartitionKey(attribute) {
    return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
}
/**
 * Workaround for element's from referenced packages not having getParent()
 * @param element The element whose parent should be searched for
 * @param parentSpecializationType The specialization type of the parent
 */
function getParent(element, parentSpecializationType) {
    const elements = lookupTypesOf(parentSpecializationType);
    const parent = elements
        .find(x =&gt; x.getChildren(element.specialization)
        .some(child =&gt; child.id === element.id));
    if (parent == null) {
        throw new Error("Could not find parent");
    }
    return parent;
}
/// &lt;reference path="../common/domainHelper.ts" /&gt;
/// &lt;reference path="../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../common/getParent.ts" /&gt;
/**
 * Gets select details of a mapped Command/Query. Intended for centralized logic of working out
 * things like keys (including implicit ones) for both the entity and owning entity if applicable.
 *
 * If the Command is for entity creation (either due to being mapped to a constructor or being
 * prefixed with "Create"), then primary keys for the entity are not populated.
 * @param request The Command or Query that has been mapped
 */
function getMappedRequestDetails(request) {
    var _a;
    const mappedElement = (_a = request.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    if (mappedElement == null) {
        return null;
    }
    let entity = mappedElement;
    if (entity.specialization !== "Class") {
        entity = getParent(entity, "Class");
    }
    const result = {
        entity: entity,
        mappingTargetType: mappedElement.specialization,
        entityKeyFields: [],
        ownerKeyFields: []
    };
    result.owningEntity = DomainHelper.getOwningAggregate(entity);
    // As long as it's not for creation, populate the PKs of the entity:
    if (result.mappingTargetType !== "Class Constructor" &amp;&amp;
        !request.getName().toLowerCase().startsWith("Create")) {
        result.entityKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity)
            : getKeysForOperationMapping(request, entity);
    }
    // If the entity is owned, populate its fields:
    if (result.owningEntity != null) {
        result.ownerKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity, result.owningEntity)
            : getKeysForOperationMapping(request, entity, result.owningEntity);
    }
    return result;
    /**
     * Return field details for primary keys. As requests mapped to operations and constructors can
     * never possibly map the attributes, these fields can only ever be matched by name.
     * @param request The CQRS Command or Query entity
     * @param owningEntity The Owning Aggregate Class
     */
    function getKeysForOperationMapping(request, entity, owningEntity) {
        const pks = DomainHelper.getPrimaryKeys(owningEntity !== null &amp;&amp; owningEntity !== void 0 ? owningEntity : entity);
        return pks.map(pk =&gt; {
            let fieldName = toPascalCase(pk.name);
            if (owningEntity != null) {
                fieldName = removePrefix(fieldName, toPascalCase(owningEntity.getName()));
                fieldName = `${owningEntity.getName()}${toCamelCase(fieldName)}`;
            }
            fieldName = ServicesHelper.getFieldFormat(fieldName);
            const existingField = request.getChildren("DTO-Field").find(field =&gt; field.getName().toLowerCase() == fieldName.toLowerCase());
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: [],
                name: fieldName,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
    function getKeysForClassMapping(request, entity, owningEntity) {
        const keys = owningEntity != null
            ? DomainHelper.getForeignKeys(entity, owningEntity)
            : DomainHelper.getPrimaryKeys(entity);
        return keys.map(pk =&gt; {
            const existingField = request.getChildren("DTO-Field").find(field =&gt; {
                if (field.getMapping() != null) {
                    return field.getMapping().getPath().some(x =&gt; x.id == pk.id);
                }
                return (pk.name.toLowerCase() === field.getName().toLowerCase());
            });
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: pk.mapPath,
                name: pk.name,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/**
 * Ensures that for the provided contract, it has the provided field creating it if necessary and
 * then ensure the field has the correct typeReference details and order.
 * The field's element is returned.
 */
function ensureHasField(options) {
    const { contract, fieldDetail, mappingSettingsId, order } = options;
    let field = fieldDetail.existingId != null
        ? contract.getChildren("DTO-Field").find(x =&gt; x.id === fieldDetail.existingId)
        : createElement("DTO-Field", fieldDetail.name, contract.id);
    field.typeReference.setType(fieldDetail.typeId);
    field.typeReference.setIsCollection(fieldDetail.isCollection);
    field.typeReference.setIsNullable(fieldDetail.isNullable);
    if (order != null) {
        field.setOrder(order);
    }
    if (mappingSettingsId != null) {
        field.setMapping(fieldDetail.mappingPath, mappingSettingsId);
    }
    return field;
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/// &lt;reference path="ensureHasField.ts" /&gt;
function onMapCommand(element, isForCrudScript, isForCreate = false) {
    var _a, _b, _c;
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const mapFromDomainMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    // const mapToDomainDataSettingsId = "735c87d0-06fc-4491-8b5f-5adc6f953c54";
    const mappingDetails = getMappedRequestDetails(element);
    if (mappingDetails == null) {
        return;
    }
    if (isForCrudScript ||
        mappingDetails.mappingTargetType !== "Class") {
        let order = 0;
        let keyFields = mappingDetails.ownerKeyFields;
        if (!isForCreate) {
            keyFields = keyFields.concat(mappingDetails.entityKeyFields);
        }
        for (const keyField of keyFields) {
            ensureHasField({
                contract: element,
                fieldDetail: keyField,
                order: order++
            });
        }
    }
    if (mappingDetails.mappingTargetType === "Operation" &amp;&amp;
        isComplexType((_c = (_b = (_a = element.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.typeReference) === null || _c === void 0 ? void 0 : _c.getType())) {
        getOrCreateCommandCrudDto(element, element, false, mapFromDomainMappingSettingId);
    }
    const fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; ((_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement().specialization.startsWith("Association")); });
    fields.forEach(field =&gt; {
        getOrCreateCommandCrudDto(element, field, true, projectMappingSettingId);
    });
    const complexFields = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp;
            isComplexType((_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType());
    });
    complexFields.forEach(cf =&gt; {
        getOrCreateCommandCrudDto(element, cf, false, projectMappingSettingId);
    });
    function isComplexType(element) {
        if (element == null) {
            console.warn("isComplexType element parameter received null");
        }
        return (element === null || element === void 0 ? void 0 : element.specialization) === "Data Contract" ||
            (element === null || element === void 0 ? void 0 : element.specialization) === "Value Object";
    }
    function getOrCreateCommandCrudDto(command, dtoField, autoAddPrimaryKey, mappingTypeSettingId) {
        let mappedElement = dtoField.getMapping().getElement();
        if (mappedElement.typeReference == null)
            throw new Error("TypeReference is undefined");
        let originalVerb = (command.getName().split(/(?=[A-Z])/))[0];
        let domainName = mappedElement.typeReference.getType().getName();
        let baseName = command.getMetadata("baseName")
            ? `${command.getMetadata("baseName")}${domainName}`
            : domainName;
        let dtoName = `${originalVerb}${baseName}`;
        let dto = getOrCreateDto(dtoName, command.getParent());
        dto.setMetadata("originalVerb", originalVerb);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(mappedElement.typeReference.getTypeId(), mappingTypeSettingId);
        ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
        dtoField.typeReference.setType(dto.id);
    }
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
const stringTypeId = "d384db9c-a279-45e1-801e-e4e8099625f2";
function onMapDto(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b, _c; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; ((_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.specialization.startsWith("Association")); });
    fields.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, true);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, false);
    });
}
function getOrCreateDtoCrudDto(element, dtoField, autoAddPrimaryKey) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const originalDtoMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    let mappedElement = dtoField.getMapping().getElement();
    let originalVerb = "";
    if (element.hasMetadata("originalVerb")) {
        originalVerb = element.getMetadata("originalVerb");
        // In the event that the prefix is no longer the same as the
        // originally called verb, then don't propagate this any further
        // as end users might get confused.
        if (element.getName().indexOf(originalVerb) &lt; 0) {
            originalVerb = "";
        }
    }
    let targetMappingSettingId = dtoField.getParent().getMapping().mappingSettingsId;
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : domainName;
    let dtoName = `${originalVerb}${baseName}`;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), targetMappingSettingId);
    if (originalVerb !== "") {
        dto.setMetadata("originalVerb", originalVerb);
    }
    dto.setMetadata("baseName", baseName);
    ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
function onMapQuery(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; x.getMapping().getElement().specialization.startsWith("Association"); });
    fields.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
}
function getOrCreateQueryCrudDto(element, dtoField) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    let mappedElement = dtoField.getMapping().getElement();
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : `${domainName}`;
    let dtoName = baseName;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), projectMappingSettingId);
    dto.setMetadata("baseName", baseName);
    ensureDtoFieldsQuery(mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
function ensureDtoFieldsQuery(mappedElement, dto) {
    let dtoUpdated = false;
    let mappedElementAttributes = mappedElement
        .typeReference
        .getType()
        .getChildren("Attribute");
    let dtoFields = dto.getChildren("DTO-Field");
    for (let attribute of mappedElementAttributes.filter(x =&gt; !dtoFields.some(y =&gt; x.getName() === y.getName()))) {
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == attribute.getName())) {
            continue;
        }
        let field = createElement("DTO-Field", attribute.getName(), dto.id);
        field.typeReference.setType(attribute.typeReference.typeId);
        field.typeReference.setIsNullable(attribute.typeReference.isNullable);
        field.typeReference.setIsCollection(attribute.typeReference.isCollection);
        field.setMapping(attribute.id);
        dtoUpdated = true;
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
var _a, _b;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../_common/onMapCommand.ts" /&gt;
/// &lt;reference path="../_common/onMapDto.ts" /&gt;
/// &lt;reference path="../_common/onMapQuery.ts" /&gt;
const privateSettersOnly = ((_b = (_a = application.getSettings("c4d1e35c-7c0d-4926-afe0-18f17563ce17")) === null || _a === void 0 ? void 0 : _a.getField("0cf704e1-9a61-499a-bb91-b20717e334f5")) === null || _b === void 0 ? void 0 : _b.value) == "true";
const mapToDomainOperationSettingId = "7c31c459-6229-4f10-bf13-507348cd8828";
var cqrsCrud;
(function (cqrsCrud) {
    async function execute(element) {
        var _a;
        let entity = await DomainHelper.openSelectEntityDialog();
        if (entity == null) {
            return;
        }
        const owningEntity = DomainHelper.getOwningAggregate(entity);
        const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
        const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
        const resultDto = createCqrsResultTypeDto(entity, folder);
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsCreateCommand(entity, folder);
        }
        createCqrsFindByIdQuery(entity, folder, resultDto);
        createCqrsFindAllQuery(entity, folder, resultDto);
        if (!privateSettersOnly) {
            createCqrsUpdateCommand(entity, folder);
        }
        const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
        for (const operation of operations) {
            createCqrsCallOperationCommand(entity, operation, folder);
        }
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsDeleteCommand(entity, folder);
        }
    }
    cqrsCrud.execute = execute;
    function createCqrsCreateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Create${baseName}Command`;
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            let command = folder.getChildren().filter(x =&gt; x.getName() == expectedCommandName)[0];
            let returnType = primaryKeys[0].typeId;
            if (primaryKeys.length &gt; 1) {
                returnType = null;
            }
            command.typeReference.setType(returnType);
            return command;
        }
        let commandManager = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        let entityCtor = entity
            .getChildren("Class Constructor")
            .filter(x =&gt; x.getChildren("Parameter").length &gt; 0)
            .sort((a, b) =&gt; {
            // In descending order:
            return b.getChildren("Parameter").length - a.getChildren("Parameter").length;
        })[0];
        if (entityCtor != null) {
            commandManager.mapToElement(entityCtor, mapToDomainOperationSettingId);
            commandManager.getElement().setMapping([entity.id, entityCtor.id], mapToDomainOperationSettingId);
        }
        else if (!privateSettersOnly) {
            commandManager.mapToElement(entity);
        }
        commandManager.getElement().setMetadata("baseName", baseName);
        let surrogateKey = primaryKeys.length === 1;
        if (surrogateKey) {
            commandManager.setReturnType(primaryKeys[0].typeId);
        }
        if (entityCtor) {
            commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(entityCtor, "Parameter")
                .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        }
        else {
            if (!surrogateKey) {
                ServicesHelper.addDtoFieldsFromDomain(commandManager.getElement(), primaryKeys);
            }
            commandManager.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
            commandManager.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        }
        onMapCommand(commandManager.getElement(), true, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCreateCommand = createCqrsCreateCommand;
    function createCqrsFindByIdQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedQueryName = `Get${baseName}ByIdQuery`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(query, primaryKeys);
        onMapQuery(query);
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindByIdQuery = createCqrsFindByIdQuery;
    function createCqrsFindAllQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, true);
        let expectedQueryName = `Get${baseName}Query`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.typeReference.setIsCollection(true);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindAllQuery = createCqrsFindAllQuery;
    function createCqrsUpdateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Update${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        command.mapToElement(entity);
        command.getElement().setMetadata("baseName", baseName);
        command.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
        command.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command.getElement(), primaryKeys);
        onMapCommand(command.getElement(), true);
        command.collapse();
        return command.getElement();
    }
    cqrsCrud.createCqrsUpdateCommand = createCqrsUpdateCommand;
    function createCqrsCallOperationCommand(entity, operation, folder) {
        var _a;
        const owningAggregate = DomainHelper.getOwningAggregate(entity);
        const baseName = (_a = owningAggregate === null || owningAggregate === void 0 ? void 0 : owningAggregate.getName()) !== null &amp;&amp; _a !== void 0 ? _a : "";
        let operationName = operation.getName();
        operationName = removeSuffix(operationName, "Async");
        operationName = toPascalCase(operationName);
        const commandName = `${operationName}${entity.getName()}Command`;
        const existing = folder.getChildren().find(x =&gt; {
            var _a, _b;
            return x.getName() == commandName ||
                ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) === operation.id;
        });
        if (existing) {
            return existing;
        }
        const commandElement = createElement("Command", commandName, folder.id);
        commandElement.setMetadata("baseName", baseName);
        const commandManager = new ElementManager(commandElement, { childSpecialization: "DTO-Field" });
        commandManager.mapToElement([entity.id, operation.id], mapToDomainOperationSettingId);
        const primaryKeys = DomainHelper.getPrimaryKeys(entity);
        for (const key of primaryKeys) {
            commandManager.addChild(key.name, lookup(key.id).typeReference);
        }
        commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(operation, "Parameter")
            .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        onMapCommand(commandElement, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCallOperationCommand = createCqrsCallOperationCommand;
    function createCqrsDeleteCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Delete${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = createElement("Command", expectedCommandName, folder.id);
        command.setMapping(entity.id);
        command.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), command.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command, primaryKeys);
        onMapCommand(command, true);
        command.collapse();
        return command;
    }
    cqrsCrud.createCqrsDeleteCommand = createCqrsDeleteCommand;
    function createCqrsResultTypeDto(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedDtoName = `${baseName}Dto`;
        let existing = folder.getChildren().find(x =&gt; x.getName() == expectedDtoName);
        if (existing) {
            return existing;
        }
        let dto = createElement("DTO", expectedDtoName, folder.id);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(entity.id);
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), dto.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        ServicesHelper.addDtoFieldsFromDomain(dto, primaryKeys);
        let attributesWithMapPaths = DomainHelper.getAttributesWithMapPath(entity);
        for (var attr of attributesWithMapPaths) {
            if (dto.getChildren("DTO-Field").some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == attr.id; })) {
                continue;
            }
            let field = createElement("DTO-Field", attr.name, dto.id);
            field.typeReference.setType(attr.typeId);
            field.setMapping(attr.mapPath);
        }
        onMapDto(dto);
        dto.collapse();
        return dto;
    }
    cqrsCrud.createCqrsResultTypeDto = createCqrsResultTypeDto;
    function getMandatoryAssociationsWithMapPath(entity) {
        return traverseInheritanceHierarchy(entity, [], []);
        function traverseInheritanceHierarchy(entity, results, generalizationStack) {
            entity
                .getAssociations("Association")
                .filter(x =&gt; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable &amp;&amp; x.typeReference.isNavigable &amp;&amp;
                !x.getOtherEnd().typeReference.isCollection &amp;&amp; !x.getOtherEnd().typeReference.isNullable)
                .forEach(association =&gt; {
                return results.push({
                    id: association.id,
                    name: association.getName(),
                    typeId: null,
                    mapPath: generalizationStack.concat([association.id]),
                    isNullable: false,
                    isCollection: false
                });
            });
            let generalizations = entity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return results;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            return traverseInheritanceHierarchy(generalization.typeReference.getType(), results, generalizationStack);
        }
    }
    function getBaseNameForElement(owningAggregate, entity, entityIsMany) {
        let entityName = entityIsMany ? toPascalCase(pluralize(entity.getName())) : toPascalCase(entity.getName());
        return owningAggregate ? `${toPascalCase(owningAggregate.getName())}${entityName}` : entityName;
    }
})(cqrsCrud || (cqrsCrud = {}));
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro/create-crud-macro.ts
 */
await cqrsCrud.execute(element);
</script>
        </option>
        <option>
          <text>Create CRUD CQRS Operations</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return application.isModuleInstalled("Intent.Modelers.Services.CQRS") &amp;&amp;
    application.getSettings("0ecca7c5-96f7-449a-96b9-f65ba0a4e3ad").getField("14bc1e98-930b-494c-97a9-5da4e1f3a5fa").value == "advanced";</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../typings/elementmacro.context.api.d.ts" /&gt;
function getSurrogateKeyType() {
    var _a, _b, _c;
    const commonTypes = {
        guid: "6b649125-18ea-48fd-a6ba-0bfff0d8f488",
        long: "33013006-E404-48C2-AC46-24EF5A5774FD",
        int: "fb0a362d-e9e2-40de-b6ff-5ce8167cbe74"
    };
    const javaTypes = {
        long: "e9e575eb-f8de-4ce4-9838-2d09665a752d",
        int: "b3e5cb3b-8a26-4346-810b-9789afa25a82"
    };
    const typeNameToIdMap = new Map();
    typeNameToIdMap.set("guid", commonTypes.guid);
    typeNameToIdMap.set("int", lookup(javaTypes.int) != null ? javaTypes.int : commonTypes.int);
    typeNameToIdMap.set("long", lookup(javaTypes.long) != null ? javaTypes.long : commonTypes.long);
    let typeName = (_c = (_b = (_a = application.getSettings("ac0a788e-d8b3-4eea-b56d-538608f1ded9")) === null || _a === void 0 ? void 0 : _a.getField("Key Type")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "int";
    if (typeNameToIdMap.has(typeName)) {
        return typeNameToIdMap.get(typeName);
    }
    return typeNameToIdMap.get("guid");
}
/// &lt;reference path="getSurrogateKeyType.ts"/&gt;
class DomainHelper {
    static async openSelectEntityDialog(options) {
        let classes = lookupTypesOf("Class").filter(x =&gt; DomainHelper.isAggregateRoot(x) || ((options === null || options === void 0 ? void 0 : options.includeOwnedRelationships) != false &amp;&amp; DomainHelper.ownerIsAggregateRoot(x)) || x.hasStereotype("Repository"));
        if (classes.length == 0) {
            await dialogService.info("No Domain types could be found. Please ensure that you have a reference to the Domain package and that at least one class exists in it.");
            return null;
        }
        let classId = await dialogService.lookupFromOptions(classes.map((x) =&gt; ({
            id: x.id,
            name: this.getFriendlyDisplayNameForClassSelection(x)
        })));
        if (classId == null) {
            await dialogService.error(`No class found with id "${classId}".`);
            return null;
        }
        let foundEntity = lookup(classId);
        return foundEntity;
    }
    static getFriendlyDisplayNameForClassSelection(element) {
        let found = DomainHelper.getOwningAggregate(element);
        return !found ? element.getName() : `${element.getName()} (${found.getName()})`;
    }
    static isAggregateRoot(element) {
        let result = !element.getAssociations("Association")
            .some(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable);
        return result;
    }
    static getOwningAggregate(entity) {
        var _a;
        let result = (_a = entity.getAssociations("Association")
            .filter(x =&gt; this.isAggregateRoot(x.typeReference.getType()) &amp;&amp; isOwnedBy(x) &amp;&amp;
            // Let's only target collections for now as part of the nested compositional crud support
            // as one-to-one relationships are more expensive to address and possibly not going to
            // be needed.
            x.getOtherEnd().typeReference.isCollection)[0]) === null || _a === void 0 ? void 0 : _a.typeReference.getType();
        return result;
        function isOwnedBy(association) {
            return association.isSourceEnd() &amp;&amp;
                !association.typeReference.isNullable &amp;&amp;
                !association.typeReference.isCollection;
        }
    }
    static ownerIsAggregateRoot(entity) {
        let result = DomainHelper.getOwningAggregate(entity);
        return result ? true : false;
    }
    static getPrimaryKeys(entity) {
        if (!entity) {
            throw new Error("entity not specified");
        }
        let primaryKeys = DomainHelper.getPrimaryKeysMap(entity);
        if (Object.keys(primaryKeys).length == 0) {
            return [
                {
                    id: null,
                    name: DomainHelper.getAttributeNameFormat("Id"),
                    typeId: DomainHelper.getSurrogateKeyType(),
                    mapPath: null,
                    isNullable: false,
                    isCollection: false
                }
            ];
        }
        return Object.values(primaryKeys);
    }
    static getPrimaryKeysMap(entity) {
        let keydict = Object.create(null);
        let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        keys.forEach(key =&gt; keydict[key.id] = {
            id: key.id,
            name: key.getName(),
            typeId: key.typeReference.typeId,
            mapPath: [key.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
        return keydict;
        function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
            baseKeys.forEach(key =&gt; {
                keydict[key.id] = {
                    id: key.id,
                    name: key.getName(),
                    typeId: key.typeReference.typeId,
                    mapPath: generalizationStack.concat([key.id]),
                    isNullable: key.typeReference.isNullable,
                    isCollection: key.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
        }
    }
    static getForeignKeys(entity, owningAggregate) {
        var _a;
        if (!entity) {
            throw new Error("entity not specified");
        }
        if (!owningAggregate) {
            throw new Error("nestedCompOwner not specified");
        }
        // Use the new Associated property on the FK stereotype method for FK Attribute lookup
        let foreignKeys = [];
        for (let attr of entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Foreign Key"))) {
            let associationId = (_a = attr.getStereotype("Foreign Key").getProperty("Association")) === null || _a === void 0 ? void 0 : _a.getValue();
            if (owningAggregate.getAssociations("Association").some(x =&gt; x.id == associationId)) {
                foreignKeys.push(attr);
            }
        }
        // Backward compatible lookup method
        if (foreignKeys.length == 0) {
            let foundFk = entity.getChildren("Attribute")
                .filter(x =&gt; x.getName().toLowerCase().indexOf(owningAggregate.getName().toLowerCase()) &gt;= 0 &amp;&amp; x.hasStereotype("Foreign Key"))[0];
            if (foundFk) {
                foreignKeys.push(foundFk);
            }
        }
        if (foreignKeys.length &gt; 0) {
            return foreignKeys.map(x =&gt; ({
                name: DomainHelper.getAttributeNameFormat(x.getName()),
                typeId: x.typeReference.typeId,
                id: x.id,
                mapPath: [x.id],
                isCollection: x.typeReference.isCollection,
                isNullable: x.typeReference.isNullable
            }));
        }
        // Implicit FKs:
        return [{
                name: DomainHelper.getAttributeNameFormat(`${owningAggregate.getName()}Id`),
                typeId: DomainHelper.getPrimaryKeys(owningAggregate)[0].typeId,
                id: null,
                mapPath: null,
                isCollection: false,
                isNullable: false
            }];
    }
    static getChildrenOfType(entity, type) {
        let attrDict = Object.create(null);
        let attributes = entity.getChildren(type);
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        return Object.values(attrDict);
    }
    static getAttributesWithMapPath(entity) {
        let attrDict = Object.create(null);
        let attributes = entity
            .getChildren("Attribute")
            .filter(x =&gt; {
            var _a;
            return !x.hasStereotype("Primary Key") &amp;&amp;
                !DomainHelper.legacyPartitionKey(x) &amp;&amp;
                (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
        });
        attributes.forEach(attr =&gt; attrDict[attr.id] = {
            id: attr.id,
            name: attr.getName(),
            typeId: attr.typeReference.typeId,
            mapPath: [attr.id],
            isNullable: false,
            isCollection: false
        });
        traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
        return Object.values(attrDict);
        function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
            if (!curEntity) {
                return;
            }
            let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            let nextEntity = generalization.typeReference.getType();
            let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !DomainHelper.legacyPartitionKey(x));
            baseKeys.forEach(attr =&gt; {
                attrDict[attr.id] = {
                    id: attr.id,
                    name: attr.getName(),
                    typeId: attr.typeReference.typeId,
                    mapPath: generalizationStack.concat([attr.id]),
                    isNullable: attr.typeReference.isNullable,
                    isCollection: attr.typeReference.isCollection
                };
            });
            traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
        }
    }
    static getAttributeNameFormat(str) {
        let convention = DomainHelper.getDomainAttributeNamingConvention();
        switch (convention) {
            case "pascal-case":
                return toPascalCase(str);
            case "camel-case":
                return toCamelCase(str);
        }
        return str;
    }
    static getDomainAttributeNamingConvention() {
        var _a, _b, _c;
        const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
        return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
    }
    static getSurrogateKeyType() {
        return getSurrogateKeyType();
    }
    // Just in case someone still uses this convention. Used to filter out those attributes when mapping
    // to domain entities that are within a Cosmos DB paradigm.
    static legacyPartitionKey(attribute) {
        return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
    }
    static requiresForeignKey(associationEnd) {
        return DomainHelper.isManyToVariantsOfOne(associationEnd) || DomainHelper.isSelfReferencingZeroToOne(associationEnd);
    }
    static isManyToVariantsOfOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.getOtherEnd().typeReference.isCollection;
    }
    static isSelfReferencingZeroToOne(associationEnd) {
        return !associationEnd.typeReference.isCollection &amp;&amp; associationEnd.typeReference.isNullable &amp;&amp;
            associationEnd.typeReference.typeId == associationEnd.getOtherEnd().typeReference.typeId;
    }
}
;
class ServicesConstants {
}
ServicesConstants.dtoToEntityMappingId = "942eae46-49f1-450e-9274-a92d40ac35fa"; //"01d74d4f-e478-4fde-a2f0-9ea92255f3c5";
ServicesConstants.dtoFromEntityMappingId = "1f747d14-681c-4a20-8c68-34223f41b825";
class ServicesHelper {
    static addDtoFieldsFromDomain(dto, attributes) {
        var _a;
        for (let key of attributes) {
            if (dto &amp;&amp; !dto.getChildren("DTO-Field").some(x =&gt; x.getName() == ServicesHelper.getFieldFormat(key.name))) {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(key.name), dto.id);
                field.typeReference.setType(key.typeId);
                if (((_a = key.mapPath) !== null &amp;&amp; _a !== void 0 ? _a : []).length &gt; 0) {
                    field.setMapping(key.mapPath);
                }
            }
        }
    }
    static getParameterFormat(str) {
        return toCamelCase(str);
    }
    static getRoutingFormat(str) {
        return pluralize(str);
    }
    static getFieldFormat(str) {
        return toPascalCase(str);
    }
}
class ElementManager {
    constructor(command, settings) {
        var _a;
        this.command = command;
        this.settings = settings;
        this.mappedElement = (_a = command.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    }
    get id() { return this.command.id; }
    ;
    setReturnType(typeId, isCollection) {
        this.command.typeReference.setType(typeId);
        if (isCollection != null) {
            this.command.typeReference.setIsCollection(isCollection);
        }
        return this;
    }
    addChild(name, type) {
        let field = createElement(this.settings.childSpecialization, ServicesHelper.getFieldFormat(name), this.command.id);
        const typeReferenceDetails = type == null
            ? null
            : typeof (type) === "string"
                ? { id: type, isNullable: false, isCollection: false }
                : { id: type.typeId, isNullable: type.isNullable, isCollection: type.isCollection };
        if (typeReferenceDetails != null) {
            field.typeReference.setType(typeReferenceDetails.id);
            field.typeReference.setIsCollection(typeReferenceDetails.isCollection);
            field.typeReference.setIsNullable(typeReferenceDetails.isNullable);
        }
        return field;
    }
    addChildrenFrom(elements, options) {
        let order = 0;
        elements.forEach(e =&gt; {
            if (e.mapPath != null) {
                if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == e.id; })) {
                    return;
                }
            }
            else if (this.command.getChildren(this.settings.childSpecialization).some(x =&gt; x.getName().toLowerCase() === e.name.toLowerCase())) {
                return;
            }
            let field = this.addChild(ServicesHelper.getFieldFormat(e.name), e.typeId);
            field.typeReference.setIsCollection(e.isCollection);
            field.typeReference.setIsNullable(e.isNullable);
            if (options === null || options === void 0 ? void 0 : options.addToTop) {
                field.setOrder(order++);
            }
            if (this.mappedElement != null &amp;&amp; e.mapPath) {
                field.setMapping(e.mapPath);
            }
        });
        return this;
    }
    mapToElement(param1, mappingSettingsId) {
        let elementIds;
        let element;
        if (Array.isArray(param1)) {
            elementIds = param1;
            element = lookup(elementIds[elementIds.length - 1]);
        }
        else {
            elementIds = [param1.id];
            element = param1;
        }
        this.mappedElement = element;
        this.command.setMapping(elementIds, mappingSettingsId);
        return this;
    }
    getElement() {
        return this.command;
    }
    collapse() {
        this.command.collapse();
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getSurrogateKeyType.ts" /&gt;
const constants = {
    PKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
        ExplicitComposite: "explicit_composite",
        Unknown: "unknown"
    },
    FKSpecialization: {
        Implicit: "implicit",
        Explicit: "explicit",
    }
};
function getFieldFormat(str) {
    return toPascalCase(str);
}
function getDomainAttributeNameFormat(str) {
    let convention = getDomainAttributeNamingConvention();
    switch (convention) {
        case "pascal-case":
            return toPascalCase(str);
        case "camel-case":
            return toCamelCase(str);
        default:
            return str;
    }
}
function getOrCreateDto(elementName, parentElement) {
    const expectedDtoName = `${elementName}Dto`;
    let existingDto = parentElement.getChildren("DTO").filter(x =&gt; x.getName() === expectedDtoName)[0];
    if (existingDto) {
        return existingDto;
    }
    let dto = createElement("DTO", expectedDtoName, parentElement.id);
    return dto;
}
function ensureDtoFields(autoAddPrimaryKey, mappedElement, dto) {
    var _a, _b, _c;
    let dtoUpdated = false;
    let domainElement = mappedElement
        .typeReference
        .getType();
    let attributesWithMapPaths = getAttributesWithMapPath(domainElement);
    let isCreateMode = ((_b = (_a = dto.getMetadata("originalVerb")) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === null || _b === void 0 ? void 0 : _b.startsWith("create")) == true;
    for (var keyName of Object.keys(attributesWithMapPaths)) {
        let entry = attributesWithMapPaths[keyName];
        if (isCreateMode &amp;&amp; ((_c = entry.name) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === "id") {
            continue;
        }
        if (isCreateMode &amp;&amp; isOwnerForeignKey(entry.name, domainElement)) {
            continue;
        }
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == entry.name)) {
            continue;
        }
        let field = createElement("DTO-Field", entry.name, dto.id);
        field.typeReference.setType(entry.typeId);
        field.typeReference.setIsNullable(entry.isNullable);
        field.typeReference.setIsCollection(entry.isCollection);
        field.setMapping(entry.mapPath);
        dtoUpdated = true;
    }
    if (autoAddPrimaryKey &amp;&amp; !isCreateMode) {
        addPrimaryKeys(dto, domainElement, true);
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
function isOwnerForeignKey(attributeName, domainElement) {
    for (let association of domainElement.getAssociations().filter(x =&gt; x.isSourceEnd() &amp;&amp; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable)) {
        if (attributeName.toLowerCase().indexOf(association.getName().toLowerCase()) &gt;= 0) {
            return true;
        }
    }
    return false;
}
function addPrimaryKeys(dto, entity, map) {
    const primaryKeys = getPrimaryKeysWithMapPath(entity);
    if (primaryKeys.length == 0) {
        // Implicit key:
        primaryKeys.push({
            id: null,
            name: "Id",
            typeId: getSurrogateKeyType(),
            mapPath: null,
            isNullable: false,
            isCollection: false
        });
    }
    for (const primaryKey of primaryKeys) {
        const name = getDomainAttributeNameFormat(primaryKey.name);
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName().toLowerCase() == name.toLowerCase())) {
            continue;
        }
        const dtoField = createElement("DTO-Field", getFieldFormat(name), dto.id);
        dtoField.typeReference.setType(primaryKey.typeId);
        if (map &amp;&amp; primaryKey.mapPath != null) {
            console.log(`Doing mapping for ${dtoField.id}`);
            dtoField.setMapping(primaryKey.mapPath);
        }
    }
}
function getPrimaryKeysWithMapPath(entity) {
    let keydict = Object.create(null);
    let keys = entity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
    keys.forEach(key =&gt; keydict[key.id] = {
        id: key.id,
        name: key.getName(),
        typeId: key.typeReference.typeId,
        mapPath: [key.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForPrimaryKeys(keydict, entity, []);
    return Object.values(keydict);
    function traverseInheritanceHierarchyForPrimaryKeys(keydict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; x.hasStereotype("Primary Key"));
        baseKeys.forEach(key =&gt; {
            keydict[key.id] = {
                id: key.id,
                name: key.getName(),
                typeId: key.typeReference.typeId,
                mapPath: generalizationStack.concat([key.id]),
                isNullable: key.typeReference.isNullable,
                isCollection: key.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForPrimaryKeys(keydict, nextEntity, generalizationStack);
    }
}
function getAttributesWithMapPath(entity) {
    let attrDict = Object.create(null);
    let attributes = entity.getChildren("Attribute")
        .filter(x =&gt; {
        var _a;
        return !x.hasStereotype("Primary Key") &amp;&amp;
            !legacyPartitionKey(x) &amp;&amp;
            (x["hasMetadata"] &amp;&amp; (!x.hasMetadata("set-by-infrastructure") || ((_a = x.getMetadata("set-by-infrastructure")) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) != "true"));
    });
    attributes.forEach(attr =&gt; attrDict[attr.id] = {
        id: attr.id,
        name: attr.getName(),
        typeId: attr.typeReference.typeId,
        mapPath: [attr.id],
        isNullable: false,
        isCollection: false
    });
    traverseInheritanceHierarchyForAttributes(attrDict, entity, []);
    return attrDict;
    function traverseInheritanceHierarchyForAttributes(attrDict, curEntity, generalizationStack) {
        if (!curEntity) {
            return;
        }
        let generalizations = curEntity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
        if (generalizations.length == 0) {
            return;
        }
        let generalization = generalizations[0];
        generalizationStack.push(generalization.id);
        let nextEntity = generalization.typeReference.getType();
        let baseKeys = nextEntity.getChildren("Attribute").filter(x =&gt; !x.hasStereotype("Primary Key") &amp;&amp; !legacyPartitionKey(x));
        baseKeys.forEach(attr =&gt; {
            attrDict[attr.id] = {
                id: attr.id,
                name: attr.getName(),
                typeId: attr.typeReference.typeId,
                mapPath: generalizationStack.concat([attr.id]),
                isNullable: attr.typeReference.isNullable,
                isCollection: attr.typeReference.isCollection
            };
        });
        traverseInheritanceHierarchyForAttributes(attrDict, nextEntity, generalizationStack);
    }
}
function getDomainAttributeNamingConvention() {
    var _a, _b, _c;
    const domainSettingsId = "c4d1e35c-7c0d-4926-afe0-18f17563ce17";
    return (_c = (_b = (_a = application.getSettings(domainSettingsId)) === null || _a === void 0 ? void 0 : _a.getField("Attribute Naming Convention")) === null || _b === void 0 ? void 0 : _b.value) !== null &amp;&amp; _c !== void 0 ? _c : "pascal-case";
}
// Just in case someone still uses this convention. Used to filter out those attributes when mapping
// to domain entities that are within a Cosmos DB paradigm.
function legacyPartitionKey(attribute) {
    return attribute.hasStereotype("Partition Key") &amp;&amp; attribute.getName() === "PartitionKey";
}
/**
 * Workaround for element's from referenced packages not having getParent()
 * @param element The element whose parent should be searched for
 * @param parentSpecializationType The specialization type of the parent
 */
function getParent(element, parentSpecializationType) {
    const elements = lookupTypesOf(parentSpecializationType);
    const parent = elements
        .find(x =&gt; x.getChildren(element.specialization)
        .some(child =&gt; child.id === element.id));
    if (parent == null) {
        throw new Error("Could not find parent");
    }
    return parent;
}
/// &lt;reference path="../common/domainHelper.ts" /&gt;
/// &lt;reference path="../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../common/getParent.ts" /&gt;
/**
 * Gets select details of a mapped Command/Query. Intended for centralized logic of working out
 * things like keys (including implicit ones) for both the entity and owning entity if applicable.
 *
 * If the Command is for entity creation (either due to being mapped to a constructor or being
 * prefixed with "Create"), then primary keys for the entity are not populated.
 * @param request The Command or Query that has been mapped
 */
function getMappedRequestDetails(request) {
    var _a;
    const mappedElement = (_a = request.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement();
    if (mappedElement == null) {
        return null;
    }
    let entity = mappedElement;
    if (entity.specialization !== "Class") {
        entity = getParent(entity, "Class");
    }
    const result = {
        entity: entity,
        mappingTargetType: mappedElement.specialization,
        entityKeyFields: [],
        ownerKeyFields: []
    };
    result.owningEntity = DomainHelper.getOwningAggregate(entity);
    // As long as it's not for creation, populate the PKs of the entity:
    if (result.mappingTargetType !== "Class Constructor" &amp;&amp;
        !request.getName().toLowerCase().startsWith("Create")) {
        result.entityKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity)
            : getKeysForOperationMapping(request, entity);
    }
    // If the entity is owned, populate its fields:
    if (result.owningEntity != null) {
        result.ownerKeyFields = result.mappingTargetType === "Class"
            ? getKeysForClassMapping(request, entity, result.owningEntity)
            : getKeysForOperationMapping(request, entity, result.owningEntity);
    }
    return result;
    /**
     * Return field details for primary keys. As requests mapped to operations and constructors can
     * never possibly map the attributes, these fields can only ever be matched by name.
     * @param request The CQRS Command or Query entity
     * @param owningEntity The Owning Aggregate Class
     */
    function getKeysForOperationMapping(request, entity, owningEntity) {
        const pks = DomainHelper.getPrimaryKeys(owningEntity !== null &amp;&amp; owningEntity !== void 0 ? owningEntity : entity);
        return pks.map(pk =&gt; {
            let fieldName = toPascalCase(pk.name);
            if (owningEntity != null) {
                fieldName = removePrefix(fieldName, toPascalCase(owningEntity.getName()));
                fieldName = `${owningEntity.getName()}${toCamelCase(fieldName)}`;
            }
            fieldName = ServicesHelper.getFieldFormat(fieldName);
            const existingField = request.getChildren("DTO-Field").find(field =&gt; field.getName().toLowerCase() == fieldName.toLowerCase());
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: [],
                name: fieldName,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
    function getKeysForClassMapping(request, entity, owningEntity) {
        const keys = owningEntity != null
            ? DomainHelper.getForeignKeys(entity, owningEntity)
            : DomainHelper.getPrimaryKeys(entity);
        return keys.map(pk =&gt; {
            const existingField = request.getChildren("DTO-Field").find(field =&gt; {
                if (field.getMapping() != null) {
                    return field.getMapping().getPath().some(x =&gt; x.id == pk.id);
                }
                return (pk.name.toLowerCase() === field.getName().toLowerCase());
            });
            return {
                existingId: existingField === null || existingField === void 0 ? void 0 : existingField.id,
                mappingPath: pk.mapPath,
                name: pk.name,
                typeId: pk.typeId,
                isCollection: pk.isCollection,
                isNullable: pk.isNullable
            };
        });
    }
}
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/**
 * Ensures that for the provided contract, it has the provided field creating it if necessary and
 * then ensure the field has the correct typeReference details and order.
 * The field's element is returned.
 */
function ensureHasField(options) {
    const { contract, fieldDetail, mappingSettingsId, order } = options;
    let field = fieldDetail.existingId != null
        ? contract.getChildren("DTO-Field").find(x =&gt; x.id === fieldDetail.existingId)
        : createElement("DTO-Field", fieldDetail.name, contract.id);
    field.typeReference.setType(fieldDetail.typeId);
    field.typeReference.setIsCollection(fieldDetail.isCollection);
    field.typeReference.setIsNullable(fieldDetail.isNullable);
    if (order != null) {
        field.setOrder(order);
    }
    if (mappingSettingsId != null) {
        field.setMapping(fieldDetail.mappingPath, mappingSettingsId);
    }
    return field;
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../../common/getMappedRequestDetails.ts" /&gt;
/// &lt;reference path="ensureHasField.ts" /&gt;
function onMapCommand(element, isForCrudScript, isForCreate = false) {
    var _a, _b, _c;
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const mapFromDomainMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    // const mapToDomainDataSettingsId = "735c87d0-06fc-4491-8b5f-5adc6f953c54";
    const mappingDetails = getMappedRequestDetails(element);
    if (mappingDetails == null) {
        return;
    }
    if (isForCrudScript ||
        mappingDetails.mappingTargetType !== "Class") {
        let order = 0;
        let keyFields = mappingDetails.ownerKeyFields;
        if (!isForCreate) {
            keyFields = keyFields.concat(mappingDetails.entityKeyFields);
        }
        for (const keyField of keyFields) {
            ensureHasField({
                contract: element,
                fieldDetail: keyField,
                order: order++
            });
        }
    }
    if (mappingDetails.mappingTargetType === "Operation" &amp;&amp;
        isComplexType((_c = (_b = (_a = element.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.typeReference) === null || _c === void 0 ? void 0 : _c.getType())) {
        getOrCreateCommandCrudDto(element, element, false, mapFromDomainMappingSettingId);
    }
    const fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; ((_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement().specialization.startsWith("Association")); });
    fields.forEach(field =&gt; {
        getOrCreateCommandCrudDto(element, field, true, projectMappingSettingId);
    });
    const complexFields = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp;
            isComplexType((_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType());
    });
    complexFields.forEach(cf =&gt; {
        getOrCreateCommandCrudDto(element, cf, false, projectMappingSettingId);
    });
    function isComplexType(element) {
        if (element == null) {
            console.warn("isComplexType element parameter received null");
        }
        return (element === null || element === void 0 ? void 0 : element.specialization) === "Data Contract" ||
            (element === null || element === void 0 ? void 0 : element.specialization) === "Value Object";
    }
    function getOrCreateCommandCrudDto(command, dtoField, autoAddPrimaryKey, mappingTypeSettingId) {
        let mappedElement = dtoField.getMapping().getElement();
        if (mappedElement.typeReference == null)
            throw new Error("TypeReference is undefined");
        let originalVerb = (command.getName().split(/(?=[A-Z])/))[0];
        let domainName = mappedElement.typeReference.getType().getName();
        let baseName = command.getMetadata("baseName")
            ? `${command.getMetadata("baseName")}${domainName}`
            : domainName;
        let dtoName = `${originalVerb}${baseName}`;
        let dto = getOrCreateDto(dtoName, command.getParent());
        dto.setMetadata("originalVerb", originalVerb);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(mappedElement.typeReference.getTypeId(), mappingTypeSettingId);
        ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
        dtoField.typeReference.setType(dto.id);
    }
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
const stringTypeId = "d384db9c-a279-45e1-801e-e4e8099625f2";
function onMapDto(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a, _b, _c; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; ((_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.specialization.startsWith("Association")); });
    fields.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, true);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateDtoCrudDto(element, f, false);
    });
}
function getOrCreateDtoCrudDto(element, dtoField, autoAddPrimaryKey) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    const originalDtoMappingSettingId = "1f747d14-681c-4a20-8c68-34223f41b825";
    let mappedElement = dtoField.getMapping().getElement();
    let originalVerb = "";
    if (element.hasMetadata("originalVerb")) {
        originalVerb = element.getMetadata("originalVerb");
        // In the event that the prefix is no longer the same as the
        // originally called verb, then don't propagate this any further
        // as end users might get confused.
        if (element.getName().indexOf(originalVerb) &lt; 0) {
            originalVerb = "";
        }
    }
    let targetMappingSettingId = dtoField.getParent().getMapping().mappingSettingsId;
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : domainName;
    let dtoName = `${originalVerb}${baseName}`;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), targetMappingSettingId);
    if (originalVerb !== "") {
        dto.setMetadata("originalVerb", originalVerb);
    }
    dto.setMetadata("baseName", baseName);
    ensureDtoFields(autoAddPrimaryKey, mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
/// &lt;reference path="./onMapFunctions.ts" /&gt;
function onMapQuery(element) {
    var complexTypes = ["Data Contract", "Value Object"];
    let fields = element.getChildren("DTO-Field")
        .filter(x =&gt; { var _a; return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" &amp;&amp; x.isMapped() &amp;&amp; x.getMapping().getElement().specialization.startsWith("Association"); });
    fields.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
    let complexAttributes = element.getChildren("DTO-Field")
        .filter(x =&gt; {
        var _a, _b, _c, _d, _e;
        return ((_a = x.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO"
            &amp;&amp; (complexTypes.includes((_e = (_d = (_c = (_b = x.getMapping()) === null || _b === void 0 ? void 0 : _b.getElement()) === null || _c === void 0 ? void 0 : _c.typeReference) === null || _d === void 0 ? void 0 : _d.getType()) === null || _e === void 0 ? void 0 : _e.specialization));
    });
    complexAttributes.forEach(f =&gt; {
        getOrCreateQueryCrudDto(element, f);
    });
}
function getOrCreateQueryCrudDto(element, dtoField) {
    const projectMappingSettingId = "942eae46-49f1-450e-9274-a92d40ac35fa";
    let mappedElement = dtoField.getMapping().getElement();
    let domainName = mappedElement.typeReference.getType().getName();
    let baseName = element.getMetadata("baseName")
        ? `${element.getMetadata("baseName")}${domainName}`
        : `${domainName}`;
    let dtoName = baseName;
    let dto = getOrCreateDto(dtoName, element.getParent());
    dto.setMapping(mappedElement.typeReference.getTypeId(), projectMappingSettingId);
    dto.setMetadata("baseName", baseName);
    ensureDtoFieldsQuery(mappedElement, dto);
    dtoField.typeReference.setType(dto.id);
}
function ensureDtoFieldsQuery(mappedElement, dto) {
    let dtoUpdated = false;
    let mappedElementAttributes = mappedElement
        .typeReference
        .getType()
        .getChildren("Attribute");
    let dtoFields = dto.getChildren("DTO-Field");
    for (let attribute of mappedElementAttributes.filter(x =&gt; !dtoFields.some(y =&gt; x.getName() === y.getName()))) {
        if (dto.getChildren("DTO-Field").some(x =&gt; x.getName() == attribute.getName())) {
            continue;
        }
        let field = createElement("DTO-Field", attribute.getName(), dto.id);
        field.typeReference.setType(attribute.typeReference.typeId);
        field.typeReference.setIsNullable(attribute.typeReference.isNullable);
        field.typeReference.setIsCollection(attribute.typeReference.isCollection);
        field.setMapping(attribute.id);
        dtoUpdated = true;
    }
    if (dtoUpdated) {
        dto.collapse();
    }
}
var _a, _b;
/// &lt;reference path="../../common/domainHelper.ts" /&gt;
/// &lt;reference path="../../common/servicesHelper.ts" /&gt;
/// &lt;reference path="../_common/onMapCommand.ts" /&gt;
/// &lt;reference path="../_common/onMapDto.ts" /&gt;
/// &lt;reference path="../_common/onMapQuery.ts" /&gt;
const privateSettersOnly = ((_b = (_a = application.getSettings("c4d1e35c-7c0d-4926-afe0-18f17563ce17")) === null || _a === void 0 ? void 0 : _a.getField("0cf704e1-9a61-499a-bb91-b20717e334f5")) === null || _b === void 0 ? void 0 : _b.value) == "true";
const mapToDomainOperationSettingId = "7c31c459-6229-4f10-bf13-507348cd8828";
var cqrsCrud;
(function (cqrsCrud) {
    async function execute(element) {
        var _a;
        let entity = await DomainHelper.openSelectEntityDialog();
        if (entity == null) {
            return;
        }
        const owningEntity = DomainHelper.getOwningAggregate(entity);
        const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
        const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
        const resultDto = createCqrsResultTypeDto(entity, folder);
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsCreateCommand(entity, folder);
        }
        createCqrsFindByIdQuery(entity, folder, resultDto);
        createCqrsFindAllQuery(entity, folder, resultDto);
        if (!privateSettersOnly) {
            createCqrsUpdateCommand(entity, folder);
        }
        const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
        for (const operation of operations) {
            createCqrsCallOperationCommand(entity, operation, folder);
        }
        if (owningEntity == null || !privateSettersOnly) {
            createCqrsDeleteCommand(entity, folder);
        }
    }
    cqrsCrud.execute = execute;
    function createCqrsCreateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Create${baseName}Command`;
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            let command = folder.getChildren().filter(x =&gt; x.getName() == expectedCommandName)[0];
            let returnType = primaryKeys[0].typeId;
            if (primaryKeys.length &gt; 1) {
                returnType = null;
            }
            command.typeReference.setType(returnType);
            return command;
        }
        let commandManager = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        let entityCtor = entity
            .getChildren("Class Constructor")
            .filter(x =&gt; x.getChildren("Parameter").length &gt; 0)
            .sort((a, b) =&gt; {
            // In descending order:
            return b.getChildren("Parameter").length - a.getChildren("Parameter").length;
        })[0];
        if (entityCtor != null) {
            commandManager.mapToElement(entityCtor, mapToDomainOperationSettingId);
            commandManager.getElement().setMapping([entity.id, entityCtor.id], mapToDomainOperationSettingId);
        }
        else if (!privateSettersOnly) {
            commandManager.mapToElement(entity);
        }
        commandManager.getElement().setMetadata("baseName", baseName);
        let surrogateKey = primaryKeys.length === 1;
        if (surrogateKey) {
            commandManager.setReturnType(primaryKeys[0].typeId);
        }
        if (entityCtor) {
            commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(entityCtor, "Parameter")
                .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        }
        else {
            if (!surrogateKey) {
                ServicesHelper.addDtoFieldsFromDomain(commandManager.getElement(), primaryKeys);
            }
            commandManager.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
            commandManager.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        }
        onMapCommand(commandManager.getElement(), true, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCreateCommand = createCqrsCreateCommand;
    function createCqrsFindByIdQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedQueryName = `Get${baseName}ByIdQuery`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(query, primaryKeys);
        onMapQuery(query);
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindByIdQuery = createCqrsFindByIdQuery;
    function createCqrsFindAllQuery(entity, folder, resultDto) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, true);
        let expectedQueryName = `Get${baseName}Query`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedQueryName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedQueryName);
        }
        let query = createElement("Query", expectedQueryName, folder.id);
        query.typeReference.setType(resultDto.id);
        query.typeReference.setIsCollection(true);
        query.setMapping(entity.id);
        query.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), query.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        query.collapse();
        return query;
    }
    cqrsCrud.createCqrsFindAllQuery = createCqrsFindAllQuery;
    function createCqrsUpdateCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Update${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = new ElementManager(createElement("Command", expectedCommandName, folder.id), {
            childSpecialization: "DTO-Field"
        });
        command.mapToElement(entity);
        command.getElement().setMetadata("baseName", baseName);
        command.addChildrenFrom(DomainHelper.getAttributesWithMapPath(entity));
        command.addChildrenFrom(getMandatoryAssociationsWithMapPath(entity));
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command.getElement(), primaryKeys);
        onMapCommand(command.getElement(), true);
        command.collapse();
        return command.getElement();
    }
    cqrsCrud.createCqrsUpdateCommand = createCqrsUpdateCommand;
    function createCqrsCallOperationCommand(entity, operation, folder) {
        var _a;
        const owningAggregate = DomainHelper.getOwningAggregate(entity);
        const baseName = (_a = owningAggregate === null || owningAggregate === void 0 ? void 0 : owningAggregate.getName()) !== null &amp;&amp; _a !== void 0 ? _a : "";
        let operationName = operation.getName();
        operationName = removeSuffix(operationName, "Async");
        operationName = toPascalCase(operationName);
        const commandName = `${operationName}${entity.getName()}Command`;
        const existing = folder.getChildren().find(x =&gt; {
            var _a, _b;
            return x.getName() == commandName ||
                ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) === operation.id;
        });
        if (existing) {
            return existing;
        }
        const commandElement = createElement("Command", commandName, folder.id);
        commandElement.setMetadata("baseName", baseName);
        const commandManager = new ElementManager(commandElement, { childSpecialization: "DTO-Field" });
        commandManager.mapToElement([entity.id, operation.id], mapToDomainOperationSettingId);
        const primaryKeys = DomainHelper.getPrimaryKeys(entity);
        for (const key of primaryKeys) {
            commandManager.addChild(key.name, lookup(key.id).typeReference);
        }
        commandManager.addChildrenFrom(DomainHelper.getChildrenOfType(operation, "Parameter")
            .filter(x =&gt; x.typeId != null &amp;&amp; lookup(x.typeId).specialization !== "Domain Service"));
        onMapCommand(commandElement, true);
        commandManager.collapse();
        return commandManager.getElement();
    }
    cqrsCrud.createCqrsCallOperationCommand = createCqrsCallOperationCommand;
    function createCqrsDeleteCommand(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedCommandName = `Delete${baseName}Command`;
        if (folder.getChildren().some(x =&gt; x.getName() == expectedCommandName)) {
            return folder.getChildren().find(x =&gt; x.getName() == expectedCommandName);
        }
        let command = createElement("Command", expectedCommandName, folder.id);
        command.setMapping(entity.id);
        command.setMetadata("baseName", baseName);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), command.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        ServicesHelper.addDtoFieldsFromDomain(command, primaryKeys);
        onMapCommand(command, true);
        command.collapse();
        return command;
    }
    cqrsCrud.createCqrsDeleteCommand = createCqrsDeleteCommand;
    function createCqrsResultTypeDto(entity, folder) {
        let owningAggregate = DomainHelper.getOwningAggregate(entity);
        let baseName = getBaseNameForElement(owningAggregate, entity, false);
        let expectedDtoName = `${baseName}Dto`;
        let existing = folder.getChildren().find(x =&gt; x.getName() == expectedDtoName);
        if (existing) {
            return existing;
        }
        let dto = createElement("DTO", expectedDtoName, folder.id);
        dto.setMetadata("baseName", baseName);
        dto.setMapping(entity.id);
        let primaryKeys = DomainHelper.getPrimaryKeys(entity);
        if (owningAggregate) {
            let foreignKeys = DomainHelper.getForeignKeys(entity, owningAggregate);
            foreignKeys.forEach(fk =&gt; {
                let field = createElement("DTO-Field", ServicesHelper.getFieldFormat(fk.name), dto.id);
                field.typeReference.setType(fk.typeId);
                if (fk.mapPath) {
                    field.setMapping(fk.mapPath);
                }
            });
        }
        ServicesHelper.addDtoFieldsFromDomain(dto, primaryKeys);
        let attributesWithMapPaths = DomainHelper.getAttributesWithMapPath(entity);
        for (var attr of attributesWithMapPaths) {
            if (dto.getChildren("DTO-Field").some(x =&gt; { var _a, _b; return ((_b = (_a = x.getMapping()) === null || _a === void 0 ? void 0 : _a.getElement()) === null || _b === void 0 ? void 0 : _b.id) == attr.id; })) {
                continue;
            }
            let field = createElement("DTO-Field", attr.name, dto.id);
            field.typeReference.setType(attr.typeId);
            field.setMapping(attr.mapPath);
        }
        onMapDto(dto);
        dto.collapse();
        return dto;
    }
    cqrsCrud.createCqrsResultTypeDto = createCqrsResultTypeDto;
    function getMandatoryAssociationsWithMapPath(entity) {
        return traverseInheritanceHierarchy(entity, [], []);
        function traverseInheritanceHierarchy(entity, results, generalizationStack) {
            entity
                .getAssociations("Association")
                .filter(x =&gt; !x.typeReference.isCollection &amp;&amp; !x.typeReference.isNullable &amp;&amp; x.typeReference.isNavigable &amp;&amp;
                !x.getOtherEnd().typeReference.isCollection &amp;&amp; !x.getOtherEnd().typeReference.isNullable)
                .forEach(association =&gt; {
                return results.push({
                    id: association.id,
                    name: association.getName(),
                    typeId: null,
                    mapPath: generalizationStack.concat([association.id]),
                    isNullable: false,
                    isCollection: false
                });
            });
            let generalizations = entity.getAssociations("Generalization").filter(x =&gt; x.isTargetEnd());
            if (generalizations.length == 0) {
                return results;
            }
            let generalization = generalizations[0];
            generalizationStack.push(generalization.id);
            return traverseInheritanceHierarchy(generalization.typeReference.getType(), results, generalizationStack);
        }
    }
    function getBaseNameForElement(owningAggregate, entity, entityIsMany) {
        let entityName = entityIsMany ? toPascalCase(pluralize(entity.getName())) : toPascalCase(entity.getName());
        return owningAggregate ? `${toPascalCase(owningAggregate.getName())}${entityName}` : entityName;
    }
})(cqrsCrud || (cqrsCrud = {}));
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro/create-crud-macro.ts
 */
//await cqrsCrud.execute(element);
/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
var convertToE2EMapping;
(function (convertToE2EMapping) {
    function execute() {
        if (element.isMapped() &amp;&amp; element.specialization == "Command") {
            convertCommand(element);
        }
        else if (element.isMapped() &amp;&amp; element.specialization == "Query") {
            convertQuery(element);
        }
    }
    convertToE2EMapping.execute = execute;
    function convertCommand(command) {
        var _a;
        let target = command.getMapping().getElement();
        let entity = (_a = target.getParent("Class")) !== null &amp;&amp; _a !== void 0 ? _a : target;
        if (command.getName().startsWith("Create")) {
            let action = createAssociation("Create Entity Action", command.id, target.id);
            let mapping = action.createMapping(command.id, entity.id);
            mapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
            mapContract("Data Mapping", command, [command.id], [target.id], mapping);
        }
        else if (command.getName().startsWith("Delete")) {
            let action = createAssociation("Delete Entity Action", command.id, entity.id);
            let mapping = action.createMapping(command.id, entity.id);
            let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
            let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
            if (idField &amp;&amp; entityPk) {
                mapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
            }
            mapContract("Filter Mapping", command, [command.id], [target.id], mapping);
        }
        else if (command.isMapped()) {
            let action = createAssociation("Update Entity Action", command.id, target.id);
            // Query Entity Mapping
            let queryMapping = action.createMapping(command.id, entity.id, "25f25af9-c38b-4053-9474-b0fabe9d7ea7");
            let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
            let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
            if (idField &amp;&amp; entityPk) {
                queryMapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
            }
            // Update Entity Mapping
            let updateMapping = action.createMapping(command.id, entity.id, "01721b1a-a85d-4320-a5cd-8bd39247196a");
            if (target.id != entity.id) {
                updateMapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
            }
            mapContract("Data Mapping", command, [command.id], [target.id], updateMapping);
        }
    }
    convertToE2EMapping.convertCommand = convertCommand;
    function convertQuery(query) {
        let entity = query.getMapping().getElement();
        let action = createAssociation("Query Entity Action", query.id, entity.id);
        if (query.typeReference.getIsCollection()) {
            action.typeReference.setIsCollection(true);
        }
        let mapping = action.createMapping(query.id, entity.id);
        mapContract("Filter Mapping", query, [query.id], [entity.id], mapping);
    }
    convertToE2EMapping.convertQuery = convertQuery;
    function mapContract(mappingType, dto, sourcePath, targetPathIds, mapping) {
        console.log("mapContract: " + dto.getName());
        dto.getChildren("DTO-Field").filter(x =&gt; x.isMapped() &amp;&amp; !(dto.specialization == "Command" &amp;&amp; x.getMapping().getElement().hasStereotype("Primary Key"))).forEach(field =&gt; {
            var _a, _b;
            if (((_a = field.typeReference.getType()) === null || _a === void 0 ? void 0 : _a.specialization) != "DTO" || field.typeReference.getIsCollection()) {
                mapping.addMappedEnd(mappingType, sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)));
            }
            if (((_b = field.typeReference.getType()) === null || _b === void 0 ? void 0 : _b.specialization) == "DTO") {
                mapContract(mappingType, field.typeReference.getType(), sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)), mapping);
            }
            field.clearMapping();
        });
        dto.clearMapping();
    }
})(convertToE2EMapping || (convertToE2EMapping = {}));
//convertToE2EMapping.execute();
/// &lt;reference path="../create-crud-macro/create-crud-macro.ts"/&gt;
/// &lt;reference path="../convert-to-e2e-mapping/convert-to-e2e-mapping.ts"/&gt;
async function execute(element) {
    var _a;
    let entity = await DomainHelper.openSelectEntityDialog();
    if (entity == null) {
        return;
    }
    const owningEntity = DomainHelper.getOwningAggregate(entity);
    const folderName = pluralize(DomainHelper.ownerIsAggregateRoot(entity) ? owningEntity.getName() : entity.getName());
    const folder = (_a = element.getChildren().find(x =&gt; x.getName() == pluralize(folderName))) !== null &amp;&amp; _a !== void 0 ? _a : createElement("Folder", pluralize(folderName), element.id);
    const resultDto = cqrsCrud.createCqrsResultTypeDto(entity, folder);
    if (owningEntity == null || !privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsCreateCommand(entity, folder));
    }
    convertToE2EMapping.convertQuery(cqrsCrud.createCqrsFindByIdQuery(entity, folder, resultDto));
    convertToE2EMapping.convertQuery(cqrsCrud.createCqrsFindAllQuery(entity, folder, resultDto));
    if (!privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsUpdateCommand(entity, folder));
    }
    const operations = entity.getChildren("Operation").filter(x =&gt; x.typeReference.getType() == null);
    for (const operation of operations) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsCallOperationCommand(entity, operation, folder));
    }
    if (owningEntity == null || !privateSettersOnly) {
        convertToE2EMapping.convertCommand(cqrsCrud.createCqrsDeleteCommand(entity, folder));
    }
    const diagramElement = createElement("Diagram", folderName, folder.id);
    diagramElement.loadDiagram();
    const diagram = getCurrentDiagram();
    diagram.layoutVisuals(folder, null, true);
}
/**
 * Used by Intent.Modelers.Services.DomainInteractions
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/services-cqrs-crud/create-crud-macro-e2e-mapping/create-crud-macro-e2e-mapping.ts
 */
await execute(element);
</script>
        </option>
      </scriptOptions>
      <mappingOptions />
      <typeOrder />
      <mappingSettings />
    </elementExtension>
    <elementExtension type="Integration Event Handler" typeId="c0582230-22f5-4f74-8eb0-ec6fc9364900">
      <creationOptions>
        <option type="association">
          <text>Create Entity</text>
          <shortcut>ctrl + shift + c</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Create Entity Action</specializationType>
          <specializationTypeId>7a3f0474-3cf8-4249-baac-8c07c49465e0</specializationTypeId>
          <defaultName>NewCreateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Update Entity</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Update Entity Action</specializationType>
          <specializationTypeId>9ea0382a-4617-412a-a8c8-af987bbce226</specializationTypeId>
          <defaultName>NewUpdateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Delete Entity</text>
          <shortcut>ctrl + shift + d</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Delete Entity Action</specializationType>
          <specializationTypeId>bfc823fb-60ab-451d-ba62-12671fe7e28e</specializationTypeId>
          <defaultName>NewDeleteEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
      </creationOptions>
      <scriptOptions />
      <mappingOptions />
      <typeOrder>
        <type>Create Entity Action</type>
        <type>Update Entity Action</type>
        <type>Delete Entity Action</type>
      </typeOrder>
      <mappingSettings />
    </elementExtension>
    <elementExtension type="Operation" typeId="e030c97a-e066-40a7-8188-808c275df3cb">
      <creationOptions>
        <option type="association">
          <text>Create Entity</text>
          <shortcut>ctrl + shift + c</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Create Entity Action</specializationType>
          <specializationTypeId>7a3f0474-3cf8-4249-baac-8c07c49465e0</specializationTypeId>
          <defaultName>NewCreateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Update Entity</text>
          <shortcut>ctrl + shift + u</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Update Entity Action</specializationType>
          <specializationTypeId>9ea0382a-4617-412a-a8c8-af987bbce226</specializationTypeId>
          <defaultName>NewUpdateEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Delete Entity</text>
          <shortcut>ctrl + shift + d</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
          <specializationType>Delete Entity Action</specializationType>
          <specializationTypeId>bfc823fb-60ab-451d-ba62-12671fe7e28e</specializationTypeId>
          <defaultName>NewDeleteEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
        <option type="association">
          <text>Query Entity</text>
          <shortcut>ctrl + shift + q</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <specializationType>Query Entity Action</specializationType>
          <specializationTypeId>47ab5888-a258-4bec-a9fc-a83de69eb79d</specializationTypeId>
          <defaultName>NewQueryEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
      </creationOptions>
      <scriptOptions />
      <mappingOptions />
      <typeOrder>
        <type>Create Entity Action</type>
        <type>Update Entity Action</type>
        <type>Delete Entity Action</type>
        <type>Query Entity Action</type>
      </typeOrder>
      <mappingSettings />
    </elementExtension>
    <elementExtension type="Query" typeId="e71b0662-e29d-4db2-868b-8a12464b25d0">
      <creationOptions>
        <option type="association">
          <text>Query Entity</text>
          <shortcut>ctrl + shift + q</shortcut>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <specializationType>Query Entity Action</specializationType>
          <specializationTypeId>47ab5888-a258-4bec-a9fc-a83de69eb79d</specializationTypeId>
          <defaultName>NewQueryEntityAction</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
      </creationOptions>
      <scriptOptions>
        <option>
          <text>Convert to advanced mapping system</text>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <isOptionVisibleFunction>return isMapped();</isOptionVisibleFunction>
          <script>/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
if (element.isMapped() &amp;&amp; element.specialization == "Command") {
    convertCommand(element);
}
else if (element.isMapped() &amp;&amp; element.specialization == "Query") {
    convertQuery(element);
}
function convertCommand(command) {
    var _a;
    let target = command.getMapping().getElement();
    let entity = (_a = target.getParent("Class")) !== null &amp;&amp; _a !== void 0 ? _a : target;
    if (command.getName().startsWith("Create")) {
        let action = createAssociation("Create Entity Action", command.id, target.id);
        let mapping = action.createMapping(command.id, entity.id);
        mapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
        mapContract("Data Mapping", command, [command.id], [target.id], mapping);
    }
    else if (command.getName().startsWith("Delete")) {
        let action = createAssociation("Delete Entity Action", command.id, entity.id);
        let mapping = action.createMapping(command.id, entity.id);
        let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
        let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
        if (idField &amp;&amp; entityPk) {
            mapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
        }
        mapContract("Filter Mapping", command, [command.id], [target.id], mapping);
    }
    else if (command.isMapped()) {
        let action = createAssociation("Update Entity Action", command.id, target.id);
        // Query Entity Mapping
        let queryMapping = action.createMapping(command.id, entity.id, "25f25af9-c38b-4053-9474-b0fabe9d7ea7");
        let idField = command.getChildren("DTO-Field").find(x =&gt; (x.isMapped() &amp;&amp; x.getMapping().getElement().hasStereotype("PrimaryKey")) || (x.getName() == "Id" || x.getName() == `${entity.getName()}Id`));
        let entityPk = entity.getChildren("Attribute").find(x =&gt; x.hasStereotype("Primary Key"));
        if (idField &amp;&amp; entityPk) {
            queryMapping.addMappedEnd("Filter Mapping", [idField.id], [entityPk.id]);
        }
        // Update Entity Mapping
        let updateMapping = action.createMapping(command.id, entity.id, "01721b1a-a85d-4320-a5cd-8bd39247196a");
        if (target.id != entity.id) {
            updateMapping.addMappedEnd("Invocation Mapping", [command.id], [target.id]);
        }
        mapContract("Data Mapping", command, [command.id], [target.id], updateMapping);
    }
}
function convertQuery(query) {
    let entity = query.getMapping().getElement();
    let action = createAssociation("Query Entity Action", query.id, entity.id);
    if (query.typeReference.getIsCollection()) {
        action.typeReference.setIsCollection(true);
    }
    let mapping = action.createMapping(query.id, entity.id);
    mapContract("Filter Mapping", query, [query.id], [entity.id], mapping);
}
function mapContract(mappingType, dto, sourcePath, targetPathIds, mapping) {
    console.log("mapContract: " + dto.getName());
    dto.getChildren("DTO-Field").filter(x =&gt; x.isMapped() &amp;&amp; !(dto.specialization == "Command" &amp;&amp; x.getMapping().getElement().hasStereotype("Primary Key"))).forEach(field =&gt; {
        if (field.typeReference.getType().specialization != "DTO" || field.typeReference.getIsCollection()) {
            mapping.addMappedEnd(mappingType, sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)));
        }
        if (field.typeReference.getType().specialization == "DTO") {
            mapContract(mappingType, field.typeReference.getType(), sourcePath.concat([field.id]), targetPathIds.concat(field.getMapping().getPath().map(x =&gt; x.id)), mapping);
        }
        field.clearMapping();
    });
    dto.clearMapping();
}
</script>
        </option>
      </scriptOptions>
      <mappingOptions>
        <option mappingType="Map Return Type" mappingTypeId="b7ae8bf5-f2fd-4a5c-b57e-05410687bfc4">
          <text>Map Return Type</text>
          <shortcut>ctrl + shift + m</shortcut>
          <isOptionVisibleFunction>return false &amp;&amp; typeReference?.isTypeFound();</isOptionVisibleFunction>
        </option>
      </mappingOptions>
      <typeOrder>
        <type>Query Entity Action</type>
      </typeOrder>
      <mappingSettings />
    </elementExtension>
  </elementExtensions>
  <associationSettings>
    <associationSetting type="Create Entity Action" typeId="7a3f0474-3cf8-4249-baac-8c07c49465e0">
      <sourceEnd type="Create Entity Action Source End" typeId="a3e7c59e-b0a1-47e1-ba29-66f2c7047b0a">
        <displayFunction>return `created by : ${typeReference.getType().getParent().getName()}.${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>optional</nameAccessibilityMode>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABGpJREFUeF7tWk1vE1cUPfdlgUWFknGqLlD5WrZFrQpS6YqSik/ROKzYAO2qP6BItkNV6EQqNGNX/ACWwMorPOarJZBCNyAkkBCt1FWBrmu7qhSEBHOrCXZij+fjzcybwZJntnlz7rnnnXtz3xsTRvyhEc8fmQCZA0ZcgawERtwAWRPMSiArgRFXICuBETdA9l8gK4HYJVCrjU38tWYnCbEHzBs6eM+YeaH9/OFt6LoVK0atNjb+NPeZYOwBbHxiEP3NlnWjveXFHRw+/CoOfiwH5Ocv72NhnQXwvgeJ3wl0vFma/iUKyXylvp9BNv57Hu//QZY43pz94uco+PY7kQXQKvUSQD8CEAHBLTDNtsrT1TAkNcMsg3BGCh98olWaqYTB766NJEDeqOtM9H2ogASjVSzMyryTr5hzDJySWbuyJgR+L25oASIlvyp3oAhJ4ztFDSVALHISIiSN7+YoaQGUkOswIOa5ZnlG7yW0WV/M/bv2v18B7AhlfZfFbvhemFICqEzer2a1+do4RO46gE/jigDJnhAoQCLJ+zihI8ItANviiiDjBF8BkkzezwlvG/X1r4juA1gfV4QgJ3gKkEryPk4Yr5qfC8bN2ALYw45Lz/GdAzpDyLyK4PIYXHYOM5rRuAzig/IYfisH8V0nwc74eUViAlPDaxXFItCB3rF50mh8YhHfUxRoAH9QgFptTHuSe+Qz2yvi4gnzZ2tp3VboUy+7K7SK+QTAJkWBB/D7esCEUZ8iIrsDv7GHiabaxWl7Hlh+NKN+DkRfqyLkxO8TQKs2zoD5hKpgkXAYp1vlwnerAjSKII500HGN78DvF6BSvwjQkUjEVb1EuNAqFr5cEaBaPwqmC6rg4cB3CGDagY4qCxYJiM+3SjNfdV+dMMxjRDgfCcrdAn34TgFOA/hWXbDwSAT+oVmaOZlUCTjx+5tgtbGLmBfD01b3BgO72qXC7cSaoAO/fxLUdaGt3fYQwIfqUgqF9Li19OCjlXtEZtKq5jOA3g2F4r24H9/tSixfaexl8LU3MQgJsvb9Uzy00OU/Wb20w2JxV1HylhPfxnU9C3Tu+wxFgaVgCCg2S4WfehdrhnkVhANSAAGL3PA9BbD/kOZhiIn0dnF6rjeHyeql3RaLGyqSd8Pv4voeh9M4FLmR0+bNjSRwn4F34grgl7yvA7qBk3SCe/K1cVBuEYSPk05eSgB7URJO8Exe5OyPHLHvBYN2XqoEendApRPcyKm8FJVNXtoBq0PJ8teaWBclfuRUOC1M8qEFiFsOMuTiiCCD7+wrgbfCbo0oCskw5JLG780pkgCvnbB8TrfLIfDjKAFl55AT1OGTxg/dBN0Id8Zm+/P1Bx4JPRZkfdM73gYl3td4X4/lieFH6gEDCei6mHhr+06yeDcENi6DMj+1QAvtpQe/xf6BRML4kUsgzE4O89pMgGHenTS4ZQ5IQ+VhjpE5YJh3Jw1umQPSUHmYY2QOGObdSYNb5oA0VB7mGJkDhnl30uD2P6Sq8VCQLRDUAAAAAElFTkSuQmCC" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Command</type>
            <type>Operation</type>
            <type>Domain Event Handler Association Target End</type>
            <type>Integration Event Handler</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>false</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
      </sourceEnd>
      <targetEnd type="Create Entity Action Target End" typeId="328f54e5-7bad-4b5f-90ca-03ce3105d016">
        <displayFunction>return `[create] ${getName()}: ${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>required</nameAccessibilityMode>
        <defaultNameFunction>let name = (typeReference.getType()?.getParent("Class") ?? typeReference.getType())?.getName() ?? "entity"
return typeReference.getIsCollection() 
    ? pluralize(toCamelCase(name))
    : toCamelCase(name);</defaultNameFunction>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Class</type>
            <type>Class Constructor</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>false</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
        <typeOrder>
          <type order="0">Processing Action</type>
        </typeOrder>
        <creationOptions>
          <option type="element">
            <text>Add Processing Action</text>
            <icon type="UrlImagePath" source="data:image/png;base64,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" />
            <specializationType>Processing Action</specializationType>
            <specializationTypeId>405a2857-b911-431f-8142-719a0e9f15f3</specializationTypeId>
            <defaultName>Action</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
        </creationOptions>
        <scriptOptions />
        <mappingOptions>
          <option mappingType="Create Entity Mapping" mappingTypeId="5f172141-fdba-426b-980e-163e782ff53e">
            <text>Map Entity Creation</text>
            <shortcut>ctrl + shift + m</shortcut>
          </option>
        </mappingOptions>
      </targetEnd>
      <visualSettings>
        <lineType>Curved</lineType>
        <lineDashArray>return "3,7";</lineDashArray>
        <sourceEnd>
          <pointIndicator>
            <fillColor>return 'limegreen'</fillColor>
            <lineWidth>return 3;</lineWidth>
            <path>return `a 4,4 0 1,0 4,4 
        a 4,4 0 1,0 -4,4`;</path>
          </pointIndicator>
        </sourceEnd>
        <targetEnd>
          <pointIndicator>
            <path>return `l 4 8 l -8 0 l 4 -8 Z`</path>
          </pointIndicator>
        </targetEnd>
      </visualSettings>
    </associationSetting>
    <associationSetting type="Delete Entity Action" typeId="bfc823fb-60ab-451d-ba62-12671fe7e28e">
      <sourceEnd type="Delete Entity Action Source End" typeId="8c2d9fed-bd14-44b2-9f98-8a801aaf157e">
        <displayFunction>return `deleted by : ${typeReference.getType().getParent().getName()}.${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>optional</nameAccessibilityMode>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABGpJREFUeF7tWk1vE1cUPfdlgUWFknGqLlD5WrZFrQpS6YqSik/ROKzYAO2qP6BItkNV6EQqNGNX/ACWwMorPOarJZBCNyAkkBCt1FWBrmu7qhSEBHOrCXZij+fjzcybwZJntnlz7rnnnXtz3xsTRvyhEc8fmQCZA0ZcgawERtwAWRPMSiArgRFXICuBETdA9l8gK4HYJVCrjU38tWYnCbEHzBs6eM+YeaH9/OFt6LoVK0atNjb+NPeZYOwBbHxiEP3NlnWjveXFHRw+/CoOfiwH5Ocv72NhnQXwvgeJ3wl0vFma/iUKyXylvp9BNv57Hu//QZY43pz94uco+PY7kQXQKvUSQD8CEAHBLTDNtsrT1TAkNcMsg3BGCh98olWaqYTB766NJEDeqOtM9H2ogASjVSzMyryTr5hzDJySWbuyJgR+L25oASIlvyp3oAhJ4ztFDSVALHISIiSN7+YoaQGUkOswIOa5ZnlG7yW0WV/M/bv2v18B7AhlfZfFbvhemFICqEzer2a1+do4RO46gE/jigDJnhAoQCLJ+zihI8ItANviiiDjBF8BkkzezwlvG/X1r4juA1gfV4QgJ3gKkEryPk4Yr5qfC8bN2ALYw45Lz/GdAzpDyLyK4PIYXHYOM5rRuAzig/IYfisH8V0nwc74eUViAlPDaxXFItCB3rF50mh8YhHfUxRoAH9QgFptTHuSe+Qz2yvi4gnzZ2tp3VboUy+7K7SK+QTAJkWBB/D7esCEUZ8iIrsDv7GHiabaxWl7Hlh+NKN+DkRfqyLkxO8TQKs2zoD5hKpgkXAYp1vlwnerAjSKII500HGN78DvF6BSvwjQkUjEVb1EuNAqFr5cEaBaPwqmC6rg4cB3CGDagY4qCxYJiM+3SjNfdV+dMMxjRDgfCcrdAn34TgFOA/hWXbDwSAT+oVmaOZlUCTjx+5tgtbGLmBfD01b3BgO72qXC7cSaoAO/fxLUdaGt3fYQwIfqUgqF9Li19OCjlXtEZtKq5jOA3g2F4r24H9/tSixfaexl8LU3MQgJsvb9Uzy00OU/Wb20w2JxV1HylhPfxnU9C3Tu+wxFgaVgCCg2S4WfehdrhnkVhANSAAGL3PA9BbD/kOZhiIn0dnF6rjeHyeql3RaLGyqSd8Pv4voeh9M4FLmR0+bNjSRwn4F34grgl7yvA7qBk3SCe/K1cVBuEYSPk05eSgB7URJO8Exe5OyPHLHvBYN2XqoEendApRPcyKm8FJVNXtoBq0PJ8teaWBclfuRUOC1M8qEFiFsOMuTiiCCD7+wrgbfCbo0oCskw5JLG780pkgCvnbB8TrfLIfDjKAFl55AT1OGTxg/dBN0Id8Zm+/P1Bx4JPRZkfdM73gYl3td4X4/lieFH6gEDCei6mHhr+06yeDcENi6DMj+1QAvtpQe/xf6BRML4kUsgzE4O89pMgGHenTS4ZQ5IQ+VhjpE5YJh3Jw1umQPSUHmYY2QOGObdSYNb5oA0VB7mGJkDhnl30uD2P6Sq8VCQLRDUAAAAAElFTkSuQmCC" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Command</type>
            <type>Operation</type>
            <type>Domain Event Handler Association Target End</type>
            <type>Integration Event Handler</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>false</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
      </sourceEnd>
      <targetEnd type="Delete Entity Action Target End" typeId="4a04cfc2-5841-438c-9c16-fb58b784b365">
        <displayFunction>return `[delete] ${getName()}: ${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>required</nameAccessibilityMode>
        <defaultNameFunction>let name = (typeReference.getType()?.getParent("Class") ?? typeReference.getType())?.getName() ?? "entity"
return typeReference.getIsCollection() 
    ? pluralize(toCamelCase(name))
    : toCamelCase(name);</defaultNameFunction>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Class</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>true</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
        <typeOrder />
        <creationOptions />
        <scriptOptions />
        <mappingOptions>
          <option mappingType="Query Entity Mapping" mappingTypeId="25f25af9-c38b-4053-9474-b0fabe9d7ea7">
            <text>Map Entity Filter</text>
            <shortcut>ctrl + shift + m</shortcut>
          </option>
        </mappingOptions>
      </targetEnd>
      <visualSettings>
        <lineType>Curved</lineType>
        <lineDashArray>return "3,7";</lineDashArray>
        <sourceEnd>
          <pointIndicator>
            <fillColor>return 'indianred'</fillColor>
            <lineWidth>return 3;</lineWidth>
            <path>return `a 4,4 0 1,0 4,4 
        a 4,4 0 1,0 -4,4`;</path>
          </pointIndicator>
        </sourceEnd>
        <targetEnd>
          <pointIndicator>
            <path>return `l 4 8 l -8 0 l 4 -8 Z`</path>
          </pointIndicator>
        </targetEnd>
      </visualSettings>
      <macros>
        <macro trigger="on-created">
          <script>let mapping = association.createMapping(association.getOtherEnd().typeReference.getTypeId(), association.typeReference.getTypeId(), "25f25af9-c38b-4053-9474-b0fabe9d7ea7") // Query Entity Mapping
association.typeReference.getType().getChildren("Attribute")
    .filter(x =&gt; x.hasStereotype("Primary Key"))
    .forEach(attr =&gt; {
        let command = association.getOtherEnd().typeReference.getType();
        let pkField = command.getChildren("DTO-Field").find(x =&gt; x.getName().toLowerCase() == attr.getName().toLowerCase()
            &amp;&amp; x.typeReference.getTypeId() == attr.typeReference.getTypeId())
        if (!pkField) {
            let newField = createElement("DTO-Field", attr.getName(), command.id);
            newField.typeReference.setType(attr.typeReference.getTypeId());
            newField.typeReference.setIsNullable(attr.typeReference.getIsNullable())
            newField.typeReference.setIsCollection(attr.typeReference.getIsCollection())
            pkField = newField;
        }
        mapping.addMappedEnd("Filter Mapping", [pkField.id], [attr.id]);
    })</script>
        </macro>
      </macros>
    </associationSetting>
    <associationSetting type="Query Entity Action" typeId="47ab5888-a258-4bec-a9fc-a83de69eb79d">
      <sourceEnd type="Query Entity Action Source End" typeId="32a65f26-2555-4616-8a2c-6a90805600bb">
        <nameAccessibilityMode>optional</nameAccessibilityMode>
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Query</type>
            <type>Operation</type>
          </targetTypes>
          <allowIsNavigable>true</allowIsNavigable>
          <allowIsNullable>true</allowIsNullable>
          <allowIsCollection>true</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
      </sourceEnd>
      <targetEnd type="Query Entity Action Target End" typeId="93ef6675-cba4-4998-adff-cb22d5343ed4">
        <displayFunction>return `[query] ${getName()}: ${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>required</nameAccessibilityMode>
        <defaultNameFunction>let name = (typeReference.getType()?.getParent("Class") ?? typeReference.getType())?.getName() ?? "entity"
return typeReference.getIsCollection() 
    ? pluralize(toCamelCase(name))
    : toCamelCase(name);</defaultNameFunction>
        <icon type="UrlImagePath" source="data:image/png;base64,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" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Class</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>true</allowIsNullable>
          <allowIsCollection>true</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
        <typeOrder>
          <type order="0">Processing Action</type>
        </typeOrder>
        <creationOptions>
          <option type="element">
            <text>Add Processing Action</text>
            <icon type="UrlImagePath" source="data:image/png;base64,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" />
            <specializationType>Processing Action</specializationType>
            <specializationTypeId>405a2857-b911-431f-8142-719a0e9f15f3</specializationTypeId>
            <defaultName>Action</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
        </creationOptions>
        <scriptOptions />
        <mappingOptions>
          <option mappingType="Query Entity Mapping" mappingTypeId="25f25af9-c38b-4053-9474-b0fabe9d7ea7">
            <text>Map Entity Query</text>
            <shortcut>ctrl + shift + m</shortcut>
          </option>
        </mappingOptions>
      </targetEnd>
      <visualSettings>
        <lineType>Curved</lineType>
        <lineDashArray>return "3,7";</lineDashArray>
        <sourceEnd>
          <pointIndicator>
            <fillColor>return 'dodgerblue'</fillColor>
            <lineWidth>return 3;</lineWidth>
            <path>return `a 4,4 0 1,0 4,4 
        a 4,4 0 1,0 -4,4`;</path>
          </pointIndicator>
        </sourceEnd>
        <targetEnd>
          <pointIndicator>
            <path>return `l 4 8 l -8 0 l 4 -8 Z`</path>
          </pointIndicator>
        </targetEnd>
      </visualSettings>
      <macros />
    </associationSetting>
    <associationSetting type="Update Entity Action" typeId="9ea0382a-4617-412a-a8c8-af987bbce226">
      <sourceEnd type="Update Entity Action Source End" typeId="6bc95978-6def-4d0c-a4f5-25bdeda8a9f6">
        <displayFunction>return `updated by : ${typeReference.getType().getParent().getName()}.${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>optional</nameAccessibilityMode>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABGpJREFUeF7tWk1vE1cUPfdlgUWFknGqLlD5WrZFrQpS6YqSik/ROKzYAO2qP6BItkNV6EQqNGNX/ACWwMorPOarJZBCNyAkkBCt1FWBrmu7qhSEBHOrCXZij+fjzcybwZJntnlz7rnnnXtz3xsTRvyhEc8fmQCZA0ZcgawERtwAWRPMSiArgRFXICuBETdA9l8gK4HYJVCrjU38tWYnCbEHzBs6eM+YeaH9/OFt6LoVK0atNjb+NPeZYOwBbHxiEP3NlnWjveXFHRw+/CoOfiwH5Ocv72NhnQXwvgeJ3wl0vFma/iUKyXylvp9BNv57Hu//QZY43pz94uco+PY7kQXQKvUSQD8CEAHBLTDNtsrT1TAkNcMsg3BGCh98olWaqYTB766NJEDeqOtM9H2ogASjVSzMyryTr5hzDJySWbuyJgR+L25oASIlvyp3oAhJ4ztFDSVALHISIiSN7+YoaQGUkOswIOa5ZnlG7yW0WV/M/bv2v18B7AhlfZfFbvhemFICqEzer2a1+do4RO46gE/jigDJnhAoQCLJ+zihI8ItANviiiDjBF8BkkzezwlvG/X1r4juA1gfV4QgJ3gKkEryPk4Yr5qfC8bN2ALYw45Lz/GdAzpDyLyK4PIYXHYOM5rRuAzig/IYfisH8V0nwc74eUViAlPDaxXFItCB3rF50mh8YhHfUxRoAH9QgFptTHuSe+Qz2yvi4gnzZ2tp3VboUy+7K7SK+QTAJkWBB/D7esCEUZ8iIrsDv7GHiabaxWl7Hlh+NKN+DkRfqyLkxO8TQKs2zoD5hKpgkXAYp1vlwnerAjSKII500HGN78DvF6BSvwjQkUjEVb1EuNAqFr5cEaBaPwqmC6rg4cB3CGDagY4qCxYJiM+3SjNfdV+dMMxjRDgfCcrdAn34TgFOA/hWXbDwSAT+oVmaOZlUCTjx+5tgtbGLmBfD01b3BgO72qXC7cSaoAO/fxLUdaGt3fYQwIfqUgqF9Li19OCjlXtEZtKq5jOA3g2F4r24H9/tSixfaexl8LU3MQgJsvb9Uzy00OU/Wb20w2JxV1HylhPfxnU9C3Tu+wxFgaVgCCg2S4WfehdrhnkVhANSAAGL3PA9BbD/kOZhiIn0dnF6rjeHyeql3RaLGyqSd8Pv4voeh9M4FLmR0+bNjSRwn4F34grgl7yvA7qBk3SCe/K1cVBuEYSPk05eSgB7URJO8Exe5OyPHLHvBYN2XqoEendApRPcyKm8FJVNXtoBq0PJ8teaWBclfuRUOC1M8qEFiFsOMuTiiCCD7+wrgbfCbo0oCskw5JLG780pkgCvnbB8TrfLIfDjKAFl55AT1OGTxg/dBN0Id8Zm+/P1Bx4JPRZkfdM73gYl3td4X4/lieFH6gEDCei6mHhr+06yeDcENi6DMj+1QAvtpQe/xf6BRML4kUsgzE4O89pMgGHenTS4ZQ5IQ+VhjpE5YJh3Jw1umQPSUHmYY2QOGObdSYNb5oA0VB7mGJkDhnl30uD2P6Sq8VCQLRDUAAAAAElFTkSuQmCC" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Command</type>
            <type>Operation</type>
            <type>Domain Event Handler Association Target End</type>
            <type>Integration Event Handler</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>false</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
      </sourceEnd>
      <targetEnd type="Update Entity Action Target End" typeId="516069f6-09cc-4de8-8e31-3c71ca823452">
        <displayFunction>return `[update] ${getName()}: ${typeReference.display}`</displayFunction>
        <nameAccessibilityMode>required</nameAccessibilityMode>
        <defaultNameFunction>let name = (typeReference.getType()?.getParent("Class") ?? typeReference.getType())?.getName() ?? "entity"
return typeReference.getIsCollection() 
    ? pluralize(toCamelCase(name))
    : toCamelCase(name);</defaultNameFunction>
        <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
        <allowSorting>true</allowSorting>
        <sortChildren p5:nil="true" xmlns:p5="http://www.w3.org/2001/XMLSchema-instance" />
        <typeReferenceSetting>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Class</type>
            <type>Operation</type>
          </targetTypes>
          <allowIsNavigable>false</allowIsNavigable>
          <allowIsNullable>false</allowIsNullable>
          <allowIsCollection>true</allowIsCollection>
          <isNavigableDefault>true</isNavigableDefault>
          <isNullableDefault>false</isNullableDefault>
          <isCollectionDefault>false</isCollectionDefault>
        </typeReferenceSetting>
        <typeOrder>
          <type order="0">Processing Action</type>
        </typeOrder>
        <creationOptions>
          <option type="element">
            <text>Add Processing Action</text>
            <icon type="UrlImagePath" source="data:image/png;base64,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" />
            <specializationType>Processing Action</specializationType>
            <specializationTypeId>405a2857-b911-431f-8142-719a0e9f15f3</specializationTypeId>
            <defaultName>NewProcessingAction</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
        </creationOptions>
        <scriptOptions />
        <mappingOptions>
          <option mappingType="Query Entity Mapping" mappingTypeId="25f25af9-c38b-4053-9474-b0fabe9d7ea7">
            <text>Map Entity Query</text>
            <shortcut>ctrl + shift + q</shortcut>
          </option>
          <option mappingType="Update Entity Mapping" mappingTypeId="01721b1a-a85d-4320-a5cd-8bd39247196a">
            <text>Map Entity Update</text>
            <shortcut>ctrl + shift + m</shortcut>
          </option>
        </mappingOptions>
      </targetEnd>
      <visualSettings>
        <lineType>Curved</lineType>
        <lineDashArray>return "3,7";</lineDashArray>
        <sourceEnd>
          <pointIndicator>
            <fillColor>return 'orange'</fillColor>
            <lineWidth>return 3;</lineWidth>
            <path>return `a 4,4 0 1,0 4,4 
        a 4,4 0 1,0 -4,4`;</path>
          </pointIndicator>
        </sourceEnd>
        <targetEnd>
          <pointIndicator>
            <path>return `l 4 8 l -8 0 l 4 -8 Z`</path>
          </pointIndicator>
        </targetEnd>
      </visualSettings>
      <macros>
        <macro trigger="on-created">
          <script>if (association.getParent().specialization !== "Command") {
    return;
}
let mapping = association.createMapping(association.getOtherEnd().typeReference.getTypeId(), association.typeReference.getTypeId(), "25f25af9-c38b-4053-9474-b0fabe9d7ea7") // Query Entity Mapping
association.typeReference.getType().getChildren("Attribute")
    .filter(x =&gt; x.hasStereotype("Primary Key"))
    .forEach(attr =&gt; {
        let sourceType = association.getOtherEnd().typeReference.getType();
        let pkField = sourceType.specialization == "Command" 
            ? getOrCreatePkField(sourceType, attr, "DTO-Field")
            : getOrCreatePkField(sourceType, attr, "Parameter")
        mapping.addMappedEnd("Filter Mapping", [pkField.id], [attr.id]);
    })

function getOrCreatePkField(sourceType, attr, fieldType) {
    let pkField = sourceType.getChildren(fieldType).find(x =&gt; x.getName().toLowerCase() == attr.getName().toLowerCase()
    &amp;&amp; x.typeReference.getTypeId() == attr.typeReference.getTypeId())
    if (!pkField) {
        let newField = createElement(fieldType, attr.getName(), sourceType.id);
        newField.typeReference.setType(attr.typeReference.getTypeId());
        newField.typeReference.setIsNullable(attr.typeReference.getIsNullable())
        newField.typeReference.setIsCollection(attr.typeReference.getIsCollection())
        pkField = newField;
    }
    return pkField;
}</script>
        </macro>
      </macros>
    </associationSetting>
  </associationSettings>
  <associationExtensions>
    <associationExtension type="Domain Event Handler Association" typeId="90831494-f069-44eb-b488-ab2dba7518ea">
      <sourceEndExtension>
        <typeReferenceExtension>
          <isRequired>true</isRequired>
          <targetTypes />
          <allowIsNavigable>inherit</allowIsNavigable>
          <allowIsNullable>inherit</allowIsNullable>
          <allowIsCollection>inherit</allowIsCollection>
        </typeReferenceExtension>
      </sourceEndExtension>
      <targetEndExtension>
        <typeReferenceExtension>
          <isRequired>true</isRequired>
          <targetTypes />
          <allowIsNavigable>inherit</allowIsNavigable>
          <allowIsNullable>inherit</allowIsNullable>
          <allowIsCollection>inherit</allowIsCollection>
        </typeReferenceExtension>
        <creationOptions>
          <option type="association">
            <text>Create Entity</text>
            <shortcut>ctrl + shift + c</shortcut>
            <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
            <specializationType>Create Entity Action</specializationType>
            <specializationTypeId>7a3f0474-3cf8-4249-baac-8c07c49465e0</specializationTypeId>
            <defaultName>NewCreateEntityAction</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
          <option type="association">
            <text>Update Entity</text>
            <shortcut>ctrl + shift + u</shortcut>
            <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
            <specializationType>Update Entity Action</specializationType>
            <specializationTypeId>9ea0382a-4617-412a-a8c8-af987bbce226</specializationTypeId>
            <defaultName>NewUpdateEntityAction</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
          <option type="association">
            <text>Delete Entity</text>
            <shortcut>ctrl + shift + d</shortcut>
            <icon type="UrlImagePath" source="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABYhJREFUeF7tWU1sVFUU/s6rRqiR9g1bFZdGjSaQCJtWKkIhYd6w0Cb+b/1ZQZz3KgGZEtHOa9XEaKJbQReDC2cGf6kiwgJd0EQxxhWi686bokES6D3mtjP0zevceb84k/Td7bv3O+d85zv3nnsfYZUPWuXxIyUgVcAqZyAtgVUugHQTTEsgLYFVzkBaAqtcAOkpkJZA7BIolfoGL942TJq2Hcx3NfD+ZOaZ+r+zp1EoiFg2SqW+gYtrt2oaS/w7l7DoL0E4Ob/h6mmMjS3EwY+lgMzkiVHWxNsA7lM48SuB9tXM7DdRnNSnK7sgIPHvVaz/jcD7ambuqyj4i1RGXajbZROgNwFoPhgCTOOOlZ0KY0u3K+MAjgTDx37HMoph8JtzIxGQKZYLTHQolEFC0ckbMijfkbErEwy85juxZQLZjpm1wq2JoID2wdM1QJRAdGbRAeYhQBsD+Fa3Q8Q8UbNyhU5Otg8+ID5wuGYaoRITSgGKzM9DYLczbpx1B6bbJ4YAUQUwEJQERebD4YckITABquA1ph1zVvandlldX6w+LIjlBuhLwj2FU2vm+/8+BWCLC6uuMY2Gxg9BQiAClMGTGJ3L7/mxk6QH7MpGDTgJINNasiv3hMy7X6zjq9e/bpAwryWM385PXwKiZN5rKIwSGiQc15gOqjK/An/qs82CNUlcq9ICKKEjAXEy73UyjBLC7uRyflR8JQFJBt8MKKqTQQmJgt+WAL1YsUCY9BgOVJN+zq5XyBVgyzFztt96v+9h8VcQkLHLOxn0uacDSyT4pvMKJwWBdkVtm93EhMFvJaBU6tP/WPOzp7dPNHifcvjduXLHAyiMXPfLtN/3gekTmzQh5Omju+auwG8hYLBYHiGi75YX0DUIftTb5PgZD/q90SxJe7c01zDRSD2f/T4oRqd5g9PlYRL0bSf8FgL0qeobYH7VBXrMMY1nk3BGhaHblY8BPHXjO+OIYxkHkrLph99KgF0+BtDTN4wTXnDyxodJOdMORy9WXgLhfZfNo07eeC4pm374HgIqRwE8s5wNetGxsh8k5UxbAuzqywC/t/yNP3LM3PNJ2dR98L0EyPv3/v+5BD4B8GTTJoFfr5m5g8kRUOmI37oJTlW3ErO8kDSGvIbSNsfcvXTNTXgM2pVHCJhp2aSArXXTOJ2EqSD4rcdgoaDp/RtnATzocuDmHIPtj6kLzpXzD8V+R5StcUD8No1QdQeDv7yZjVCmWNnCBHl5WeciWjRuf1IRsYaiEVrQSOycy+9pwW/fCi+993nf2BJRgiJ4+TiZr5nGdKzIAahaYRW+8jKkug8QY2fNMs5FcVQhSzBRoZ7PTkTBdK9R4gOH6qZxuB1+x+twkiT0YvCSkMgPImGUoJJ9u8zrk6UB1tZ+2kcLB/xem5oZVcmeO2R++dgNoDuFEi4TY9SvHMJkXgYPbY3cHDcDmA9CchTZu0P2VUBzsuqBpJOTYTLfeBSVlyAZfHN03HjjZD6UAnxIuMyA4W1eBpeaqrLnqOu44alIZo2N+iu5H9yZazQ5Er/lHTCI7CMpwIcEeX8/Dkbj3wANgfhxd4cn1wfZ7RUkLOGDGx0pDQF4YgV+gJr3VnzgEnAvVOwJHXeTIME3ASLhRwg+0CmgikovVvMglu+Gvj9HCbDCNjkh8BeI2apZubcC7OcrpkRSwI1ysBfbZvn7+n6F8Qsaib3e9jOoo5lieTsTvaPGp18EY++8lZWvPpFGLAIWLRYK2uDtm4ZJ8GPQcPeirJgvCdBM/cr5M7EvNhK/f+OQxrSNSWxYwtcuiT4xU/9n9mxc/PgEROK9dxalBPROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjSaqA7vDeO1ZTBfROLrrjyX+Fpw5umCJAIAAAAABJRU5ErkJggg==" />
            <specializationType>Delete Entity Action</specializationType>
            <specializationTypeId>bfc823fb-60ab-451d-ba62-12671fe7e28e</specializationTypeId>
            <defaultName>NewDeleteEntityAction</defaultName>
            <allowMultiple>true</allowMultiple>
          </option>
        </creationOptions>
        <scriptOptions />
        <mappingOptions />
      </targetEndExtension>
      <macros />
    </associationExtension>
  </associationExtensions>
  <mappingSettings>
    <mappingSetting type="Create Entity Mapping" typeId="5f172141-fdba-426b-980e-163e782ff53e">
      <title>Create Entity Mapping</title>
      <targetRootElementFunction>return element.getParent("Class")?.id ?? element.id;</targetRootElementFunction>
      <sourceMappings>
        <mapping id="31aad2f3-ec4d-49bb-bf1f-25faa57b90b8" name="Command" type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="cda28aa7-8ea4-49b1-9595-5b2c074691d7" name="Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return !element.typeReference.getIsCollection();</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>588ef54a-51eb-4244-8fd0-24d8d8ad49f6</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="d77a05b6-115a-4419-92c2-ebb475bca1d0" name="Collection Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return element.typeReference.getIsCollection();</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>588ef54a-51eb-4244-8fd0-24d8d8ad49f6</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="588ef54a-51eb-4244-8fd0-24d8d8ad49f6" name="Create DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <useChildSettingsFrom>31aad2f3-ec4d-49bb-bf1f-25faa57b90b8</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="946bd311-8699-4747-a6de-62633330891e" name="Service Operation" type="Operation" typeId="e030c97a-e066-40a7-8188-808c275df3cb">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="81e71bc3-27cf-4d3e-ae52-8e129f6a1faf" name="Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>588ef54a-51eb-4244-8fd0-24d8d8ad49f6</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="6f6f145b-0be8-4a9d-aa53-1da1689a6060" name="Domain Event Handler Association" type="Domain Event Handler Association Target End" typeId="f45dfee9-f62b-45ac-bfce-a3878e04b73f">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return element.typeReference.getIsCollection();</isMappableFunction>
          <traversableTypes>
            <mappingId>effa8078-0daf-4489-a60f-ea2b482bd5e0</mappingId>
          </traversableTypes>
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="effa8078-0daf-4489-a60f-ea2b482bd5e0" name="Domain Event" type="Domain Event" typeId="0814e459-fb9b-47db-b7eb-32ce30397e8a">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="c8af32ed-5a8e-49b4-bc55-6ba4826f4007" name="Property" type="Property" typeId="b4d69073-5abb-4968-b41b-545b2f7408ed">
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return true;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>f5b2a838-ff3b-4ba3-8967-05e6215c5150</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="f5b2a838-ff3b-4ba3-8967-05e6215c5150" name="Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="ea4f8f96-3aec-4aec-8a24-2af01f2faf7b" name="Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <filterFunction>let fkAssociation = element.getStereotype("Foreign Key")?.getProperty("Association")?.getSelected();

return !element.hasStereotype('Primary Key') 
    // if has FK, is aggregation
    &amp;&amp; (fkAssociation == null || fkAssociation.getOtherEnd().typeReference.getIsCollection() || fkAssociation.getOtherEnd().typeReference.getIsNullable()); 
    </filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>85c961d8-ad45-4995-8089-89fde655bbdc</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="6942833b-530d-4fa1-92a3-567320798d5b" name="Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>85c961d8-ad45-4995-8089-89fde655bbdc</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>f5b2a838-ff3b-4ba3-8967-05e6215c5150</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="4f4cc6b1-8ca5-4cc0-991e-f7da06100f31" name="Invoke Domain Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
              <filterFunction>return element.id == mappingContext.targetElementId</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return element.typeReference.isTypeFound() &amp;&amp; element.getChildren("Parameter").length == 0;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="85c961d8-ad45-4995-8089-89fde655bbdc" name="Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>f5b2a838-ff3b-4ba3-8967-05e6215c5150</useChildSettingsFrom>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
      </sourceMappings>
      <targetMappings>
        <mapping id="e04ab087-8c1a-42b9-aac7-d76ed674e319" name="Create Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <isRequiredFunction>return element.id == mappingContext.targetElementId</isRequiredFunction>
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return element.id == mappingContext.targetElementId</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="53e8bc33-5930-4364-9526-7f8f181b14a1" name="Set Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <filterFunction>let fkAssociation = element.getStereotype("Foreign Key")?.getProperty("Association")?.getSelected();

return !element.hasStereotype('Primary Key') 
    // if has FK, is aggregation
    &amp;&amp; (fkAssociation == null || fkAssociation.getOtherEnd().typeReference.getIsCollection() || fkAssociation.getOtherEnd().typeReference.getIsNullable()); 
    </filterFunction>
              <isRequiredFunction>return !element.typeReference.getIsNullable() &amp;&amp; !element.typeReference.getIsCollection()
    &amp;&amp; (element.getParent("Class").getIsMapped());</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>// Attribute is under mapped to Class or Constructor
return element.getParent("Class").id == mappingContext.targetElementId || element.getParent("Class Constructor")?.id == mappingContext.targetElementId</isMappableFunction>
              <traversableTypes>
                <mappingId>8829efad-54fa-4ea6-a5c8-14f556cb528d</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="a4a2572b-57d1-4782-8ace-dd22540211dc" name="Set Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <isRequiredFunction>return !element.typeReference.getIsNullable() &amp;&amp; !element.typeReference.getIsCollection()
    &amp;&amp; element.getParent("Class").getIsMapped();</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>// Association is under mapped to Class or Constructor
return element.getParent("Class").id == mappingContext.targetElementId || element.getParent("Class Constructor")?.id == mappingContext.targetElementId</isMappableFunction>
              <traversableTypes>
                <mappingId>e04ab087-8c1a-42b9-aac7-d76ed674e319</mappingId>
                <mappingId>8829efad-54fa-4ea6-a5c8-14f556cb528d</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>e04ab087-8c1a-42b9-aac7-d76ed674e319</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="1fba46e9-3cf7-4154-ad38-451c9696c413" name="Invoke Constructor" type="Class Constructor" typeId="dec2bd12-4699-4f45-8ec9-3b62dc692d2b">
              <isRequiredFunction>return element.id == mappingContext.targetElementId || element.getParent().getChildren("Class Constructor").length == 1</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return element.id == mappingContext.targetElementId || element.getParent("Class Constructor")?.id == mappingContext.targetElementId;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="8ec45776-c6cc-4174-84f8-efb5d4308ed4" name="Constructor Parameter" type="Parameter" typeId="c26d8d0a-a26b-4b5f-b449-e9bdb60b3a4b">
                  <isRequiredFunction>return true;</isRequiredFunction>
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return element.getParent()?.getIsMapped();</isMappableFunction>
                  <traversableTypes>
                    <mappingId>8829efad-54fa-4ea6-a5c8-14f556cb528d</mappingId>
                    <mappingId>e04ab087-8c1a-42b9-aac7-d76ed674e319</mappingId>
                    <mappingId>15b84be5-c79b-41bf-881c-447fe70f5f5b</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="8829efad-54fa-4ea6-a5c8-14f556cb528d" name="Create Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <useChildSettingsFrom>e04ab087-8c1a-42b9-aac7-d76ed674e319</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="15b84be5-c79b-41bf-881c-447fe70f5f5b" name="Create Data Contract" type="Data Contract" typeId="4464fabe-c59e-4d90-81fc-c9245bdd1afd">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <useChildSettingsFrom>e04ab087-8c1a-42b9-aac7-d76ed674e319</useChildSettingsFrom>
          <childSettings />
        </mapping>
      </targetMappings>
      <mappingTypes>
        <mappingType type="Invocation Mapping" typeId="47dc4a51-30a3-4ee8-8c7d-25a35bb965b9">
          <represents>invokable</represents>
          <sources>
            <source id="31aad2f3-ec4d-49bb-bf1f-25faa57b90b8" name="Command" />
            <source id="946bd311-8699-4747-a6de-62633330891e" name="Service Operation" />
            <source id="6f6f145b-0be8-4a9d-aa53-1da1689a6060" name="Domain Event Handler Association" />
          </sources>
          <targets>
            <target id="e04ab087-8c1a-42b9-aac7-d76ed674e319" name="Create Class" />
            <target id="1fba46e9-3cf7-4154-ad38-451c9696c413" name="Invoke Constructor" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
        <mappingType type="Data Mapping" typeId="50dccfb2-bd24-4135-adf6-ed31f28f8fe0">
          <represents>data</represents>
          <sources>
            <source id="cda28aa7-8ea4-49b1-9595-5b2c074691d7" name="Field" />
            <source id="81e71bc3-27cf-4d3e-ae52-8e129f6a1faf" name="Parameter" />
            <source id="ea4f8f96-3aec-4aec-8a24-2af01f2faf7b" name="Attribute" />
            <source id="6942833b-530d-4fa1-92a3-567320798d5b" name="Association Target End" />
            <source id="4f4cc6b1-8ca5-4cc0-991e-f7da06100f31" name="Invoke Domain Operation" />
            <source id="c8af32ed-5a8e-49b4-bc55-6ba4826f4007" name="Property" />
            <source id="d77a05b6-115a-4419-92c2-ebb475bca1d0" name="Collection Field" />
          </sources>
          <targets>
            <target id="53e8bc33-5930-4364-9526-7f8f181b14a1" name="Set Attribute" />
            <target id="a4a2572b-57d1-4782-8ace-dd22540211dc" name="Set Association Target End" />
            <target id="8ec45776-c6cc-4174-84f8-efb5d4308ed4" name="Constructor Parameter" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
      </mappingTypes>
    </mappingSetting>
    <mappingSetting type="Map Return Type" typeId="b7ae8bf5-f2fd-4a5c-b57e-05410687bfc4">
      <title>Map Return Type</title>
      <sourceMappings>
        <mapping id="c6fc7bd7-b9cc-441a-8504-e4d163724173" name="Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="e183c35c-9e86-4442-bd58-debd75c437da" name="Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return element.hasStereotype("Primary Key");</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>f878e4f3-0928-44a1-a6ac-9a7a827c2c06</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="867a6a2b-11cc-44ae-a3ac-d25a8a945731" name="Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <isRequiredFunction>return false;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
                <mappingId>f878e4f3-0928-44a1-a6ac-9a7a827c2c06</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>c6fc7bd7-b9cc-441a-8504-e4d163724173</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="df0b450b-572c-44b3-aad3-dc2ae75e3065" name="Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="d5206710-a80f-483d-adf1-163301df6237" name="Command" type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="c4f786ba-6fd6-4d17-8cb5-1ddbaa8bd76f" name="Create Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>cc0e4c6e-ac32-4694-9a3b-62c97d9e0e24</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="e663340d-7da8-4bd7-8131-bf4fad7d1bc9" name="Create Entity" type="Create Entity Action Target End" typeId="328f54e5-7bad-4b5f-90ca-03ce3105d016">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false;</isMappableFunction>
              <traversableTypes>
                <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="796a464a-0002-447b-857e-05de76cd55b6" name="Update Class Variable" type="Create Entity Action Target End" typeId="328f54e5-7bad-4b5f-90ca-03ce3105d016">
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return false;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
            <childSetting id="79d92ad8-078e-4592-ab74-366916ef59eb" name="Update Entity" type="Update Entity Action Target End" typeId="516069f6-09cc-4de8-8e31-3c71ca823452">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false;</isMappableFunction>
              <traversableTypes>
                <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="3719e5a7-78c8-4d08-a034-607138273afc" name="Update Class Variable" type="Create Entity Action Target End" typeId="328f54e5-7bad-4b5f-90ca-03ce3105d016">
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return false;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="cc0e4c6e-ac32-4694-9a3b-62c97d9e0e24" name="DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <useChildSettingsFrom>d5206710-a80f-483d-adf1-163301df6237</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="939e496e-4554-4926-b0f8-83bb71722c15" name="Query" type="Query" typeId="e71b0662-e29d-4db2-868b-8a12464b25d0">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="2b99baa5-10d0-474b-98fb-cd55a8566e0b" name="Query Entity" type="Query Entity Action Target End" typeId="93ef6675-cba4-4998-adff-cb22d5343ed4">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false</isMappableFunction>
              <traversableTypes>
                <mappingId>c6fc7bd7-b9cc-441a-8504-e4d163724173</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="529a376e-a39e-42ba-95da-b06bb8a76ebe" name="Create Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>cc0e4c6e-ac32-4694-9a3b-62c97d9e0e24</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="f878e4f3-0928-44a1-a6ac-9a7a827c2c06" name="Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="44a42dbb-17f4-409e-ba68-1da4bad7fdae" name="Value Object Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return true;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>f878e4f3-0928-44a1-a6ac-9a7a827c2c06</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
      </sourceMappings>
      <targetMappings>
        <mapping id="7e501670-11af-47fa-bf05-b0da94c85225" name="Return DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('DTO').getName() + element.getName() + 'Dto'</createNameFunction>
          <childSettings>
            <childSetting id="ee4038a2-7109-4ae2-b667-983ef574070b" name="Return DTO-Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>7e501670-11af-47fa-bf05-b0da94c85225</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="e2e407d6-4f3e-41bb-8ec2-12f110b620a5" name="Type-Defintion" type="Type-Definition" typeId="d4e577cd-ad05-4180-9a2e-fff4ddea0e1e">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings />
        </mapping>
      </targetMappings>
      <mappingTypes />
    </mappingSetting>
    <mappingSetting type="Process Action Mapping" typeId="01bc7593-a6a2-45aa-8497-b4b6a269ab68">
      <title>Process Action Mapping</title>
      <sourceRootElementFunction>return element.getParent("Command")?.id ?? element.getParent("Operation").id</sourceRootElementFunction>
      <targetRootElementFunction>let updateType = element.getParent().typeReference.getType();
return updateType.getParent("Class")?.id ?? updateType.id;</targetRootElementFunction>
      <sourceMappings>
        <mapping id="b585bde3-d87d-411e-81b4-2919bb0e4c9f" name="Update Command" type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="766bd1a3-0d5d-490b-b31c-c5af9e1394d9" name="Update Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return !element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>e18acbbe-3f10-406d-beee-2bce1134dad1</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="90553c32-fb23-4231-8776-77d495014a72" name="Update Collection Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>e18acbbe-3f10-406d-beee-2bce1134dad1</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="e18acbbe-3f10-406d-beee-2bce1134dad1" name="Update DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <useChildSettingsFrom>b585bde3-d87d-411e-81b4-2919bb0e4c9f</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="41ceeb7e-4ec5-4a64-b69a-42c16df26343" name="Update Operation" type="Operation" typeId="e030c97a-e066-40a7-8188-808c275df3cb">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="ace00d89-ecb6-42a6-8a95-e2be8223b669" name="Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <filterFunction>return !element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>e18acbbe-3f10-406d-beee-2bce1134dad1</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="1b0e5a36-0fdb-4ca5-90a2-dbd15ab51c1c" name="Collection Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <filterFunction>return element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>e18acbbe-3f10-406d-beee-2bce1134dad1</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
      </sourceMappings>
      <targetMappings>
        <mapping id="aa775538-38be-41ac-a091-5568c5f63465" name="Update Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="d91737ab-e838-493f-aff5-e38e43f8ac47" name="Update Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return element.getParent().typeReference?.getIsCollection()</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>let fkAssociation = element.getStereotype("Foreign Key")?.getProperty("Association")?.getSelected();  
return (!element.hasStereotype('Primary Key') || element.getParent().specialization == "Association Target End")
    // if is FK, include if is for aggregational relationahip:
    &amp;&amp; (fkAssociation == null || fkAssociation.getOtherEnd().typeReference.getIsCollection() || fkAssociation.getOtherEnd().typeReference.getIsNullable());</isMappableFunction>
              <traversableTypes>
                <mappingId>92ff28e5-94c2-42f2-b5b3-f4cde4ff614b</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="c919dea4-c764-4d7d-b0af-0b96bf101567" name="Update Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <isRequiredFunction>return false;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>aa775538-38be-41ac-a091-5568c5f63465</mappingId>
                <mappingId>92ff28e5-94c2-42f2-b5b3-f4cde4ff614b</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>aa775538-38be-41ac-a091-5568c5f63465</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="f53131e5-cb81-4eeb-94a6-62fd1f76c9dc" name="Invoke Class Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
              <isRequiredFunction>return element.id == mappingContext.targetElementId</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="5f9b4556-02df-45c3-8d48-20e2ed859963" name="Operation Parameter" type="Parameter" typeId="c26d8d0a-a26b-4b5f-b449-e9bdb60b3a4b">
                  <isRequiredFunction>return true;</isRequiredFunction>
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return true;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>92ff28e5-94c2-42f2-b5b3-f4cde4ff614b</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="92ff28e5-94c2-42f2-b5b3-f4cde4ff614b" name="Update Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="90a27716-2e2b-4403-b4ff-ca310e5dad1a" name="Value Object Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return true;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>92ff28e5-94c2-42f2-b5b3-f4cde4ff614b</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="c1ea4448-cbcb-4369-8e3e-f370dcca4603" name="Update New Entity" type="Create Entity Action Target End" typeId="328f54e5-7bad-4b5f-90ca-03ce3105d016">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes>
            <mappingId>aa775538-38be-41ac-a091-5568c5f63465</mappingId>
          </traversableTypes>
          <canBeModified>false</canBeModified>
          <childSettings />
        </mapping>
        <mapping id="0c2780a7-959a-4b8b-b710-3603a1d748fe" name="Update Existing Entity" type="Update Entity Action Target End" typeId="516069f6-09cc-4de8-8e31-3c71ca823452">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes>
            <mappingId>aa775538-38be-41ac-a091-5568c5f63465</mappingId>
          </traversableTypes>
          <canBeModified>false</canBeModified>
          <childSettings />
        </mapping>
      </targetMappings>
      <mappingTypes>
        <mappingType type="Invocation Mapping" typeId="19c5ccad-f41f-4613-bd0b-b8e2adba6245">
          <represents>invokable</represents>
          <sources>
            <source id="b585bde3-d87d-411e-81b4-2919bb0e4c9f" name="Update Command" />
            <source id="41ceeb7e-4ec5-4a64-b69a-42c16df26343" name="Update Operation" />
            <source id="90553c32-fb23-4231-8776-77d495014a72" name="Update Collection Field" />
            <source id="1b0e5a36-0fdb-4ca5-90a2-dbd15ab51c1c" name="Collection Parameter" />
          </sources>
          <targets>
            <target id="f53131e5-cb81-4eeb-94a6-62fd1f76c9dc" name="Invoke Class Operation" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
        <mappingType type="Data Mapping" typeId="ac40ddfb-4d32-495d-928e-ddb991434a87">
          <represents>data</represents>
          <sources>
            <source id="766bd1a3-0d5d-490b-b31c-c5af9e1394d9" name="Update Field" />
            <source id="ace00d89-ecb6-42a6-8a95-e2be8223b669" name="Parameter" />
            <source id="90553c32-fb23-4231-8776-77d495014a72" name="Update Collection Field" />
            <source id="1b0e5a36-0fdb-4ca5-90a2-dbd15ab51c1c" name="Collection Parameter" />
          </sources>
          <targets>
            <target id="d91737ab-e838-493f-aff5-e38e43f8ac47" name="Update Attribute" />
            <target id="c919dea4-c764-4d7d-b0af-0b96bf101567" name="Update Association Target End" />
            <target id="5f9b4556-02df-45c3-8d48-20e2ed859963" name="Operation Parameter" />
            <target id="90a27716-2e2b-4403-b4ff-ca310e5dad1a" name="Value Object Attribute" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
      </mappingTypes>
    </mappingSetting>
    <mappingSetting type="Query Entity Mapping" typeId="25f25af9-c38b-4053-9474-b0fabe9d7ea7">
      <title>Query Entity Mapping</title>
      <targetRootElementFunction>return element.getParent("Class")?.id ?? element.id;</targetRootElementFunction>
      <sourceMappings>
        <mapping id="89099190-d76a-45d7-a07b-c38247de88aa" name="Command" type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="8328b1d4-596f-4283-a682-29fef39e5b04" name="Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>238dc86d-77f0-4668-8c2f-53ee96e117ec</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="0556825b-177b-4093-b13a-5dfabb13c9b6" name="Query" type="Query" typeId="e71b0662-e29d-4db2-868b-8a12464b25d0">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="f46abe58-f9f0-4719-a2cc-9e4beb99b897" name="Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>238dc86d-77f0-4668-8c2f-53ee96e117ec</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="238dc86d-77f0-4668-8c2f-53ee96e117ec" name="DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <useChildSettingsFrom>0556825b-177b-4093-b13a-5dfabb13c9b6</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="cd1f23f1-a55d-4e65-a55e-53cf0dc42c41" name="Service Operation" type="Operation" typeId="e030c97a-e066-40a7-8188-808c275df3cb">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="ddbe52ee-9fb8-4b98-9ac3-d77ba537099e" name="Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>238dc86d-77f0-4668-8c2f-53ee96e117ec</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="7edb15d2-93c3-4b71-930e-7ecdfc046da7" name="Domain Event Handler Association" type="Domain Event Handler Association Target End" typeId="f45dfee9-f62b-45ac-bfce-a3878e04b73f">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes>
            <mappingId>6cb9ae35-2501-4d8c-9e01-6b0d1513ff5e</mappingId>
          </traversableTypes>
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="6cb9ae35-2501-4d8c-9e01-6b0d1513ff5e" name="Domain Event" type="Domain Event" typeId="0814e459-fb9b-47db-b7eb-32ce30397e8a">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="5481a51e-378a-4b9d-833f-67071e16ff33" name="Property" type="Property" typeId="b4d69073-5abb-4968-b41b-545b2f7408ed">
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return true;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>fbe2f619-f186-4eb3-87fa-4e96cd013b6b</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="fbe2f619-f186-4eb3-87fa-4e96cd013b6b" name="Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="64a613d4-17da-4172-8a9f-92924cfe8251" name="Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <filterFunction>let fkAssociation = element.getStereotype("Foreign Key")?.getProperty("Association")?.getSelected();

return !element.hasStereotype('Primary Key') 
    // if has FK, is aggregation
    &amp;&amp; (fkAssociation == null || fkAssociation.getOtherEnd().typeReference.getIsCollection() || fkAssociation.getOtherEnd().typeReference.getIsNullable()); 
    </filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>555d5544-0017-4447-a84e-78d7fe41091f</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="35641622-620f-42a1-8bd9-7f07cb422cda" name="Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>555d5544-0017-4447-a84e-78d7fe41091f</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>fbe2f619-f186-4eb3-87fa-4e96cd013b6b</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="ceb48915-1959-4de3-9a64-f3d420c56885" name="Invoke Domain Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
              <filterFunction>return element.id == mappingContext.targetElementId</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return element.typeReference.isTypeFound() &amp;&amp; element.getChildren("Parameter").length == 0;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="555d5544-0017-4447-a84e-78d7fe41091f" name="Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>fbe2f619-f186-4eb3-87fa-4e96cd013b6b</useChildSettingsFrom>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
      </sourceMappings>
      <targetMappings>
        <mapping id="0cd3919e-8d19-4b35-8c2b-dc8037efc3d5" name="Create Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="a861cc4a-9aed-41f5-ad5d-fdc651497de4" name="Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>c5a629db-c717-400b-9204-7cdb6acfa13e</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="4e6c69aa-dfdb-4f34-b9dd-80ad18cfe855" name="Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return false;</isMappableFunction>
              <traversableTypes>
                <mappingId>0cd3919e-8d19-4b35-8c2b-dc8037efc3d5</mappingId>
                <mappingId>c5a629db-c717-400b-9204-7cdb6acfa13e</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>0cd3919e-8d19-4b35-8c2b-dc8037efc3d5</useChildSettingsFrom>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="c5a629db-c717-400b-9204-7cdb6acfa13e" name="Create Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <useChildSettingsFrom>0cd3919e-8d19-4b35-8c2b-dc8037efc3d5</useChildSettingsFrom>
          <childSettings />
        </mapping>
      </targetMappings>
      <mappingTypes>
        <mappingType type="Filter Mapping" typeId="01d09a7f-0e7c-4670-b7bc-395d7e893ef2">
          <represents>data</represents>
          <sources>
            <source id="8328b1d4-596f-4283-a682-29fef39e5b04" name="Field" />
            <source id="f46abe58-f9f0-4719-a2cc-9e4beb99b897" name="Field" />
            <source id="ddbe52ee-9fb8-4b98-9ac3-d77ba537099e" name="Parameter" />
            <source id="5481a51e-378a-4b9d-833f-67071e16ff33" name="Property" />
            <source id="64a613d4-17da-4172-8a9f-92924cfe8251" name="Attribute" />
            <source id="35641622-620f-42a1-8bd9-7f07cb422cda" name="Association Target End" />
            <source id="ceb48915-1959-4de3-9a64-f3d420c56885" name="Invoke Domain Operation" />
          </sources>
          <targets>
            <target id="a861cc4a-9aed-41f5-ad5d-fdc651497de4" name="Attribute" />
            <target id="4e6c69aa-dfdb-4f34-b9dd-80ad18cfe855" name="Association Target End" />
          </targets>
          <lineColor>lawngreen</lineColor>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
      </mappingTypes>
    </mappingSetting>
    <mappingSetting type="Update Entity Mapping" typeId="01721b1a-a85d-4320-a5cd-8bd39247196a">
      <title>Update Entity Mapping</title>
      <targetRootElementFunction>return element.getParent("Class")?.id ?? element.id;</targetRootElementFunction>
      <sourceMappings>
        <mapping id="b2f0849a-864b-447d-b896-300b597bbb02" name="Command" type="Command" typeId="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <childSettings>
            <childSetting id="cb557bfc-e7c7-49ab-b842-0124959fe5ec" name="Update Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return !element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>b91d2d99-42c9-43fe-a110-ea1294daae96</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="bf848a07-0fcd-4599-9a8a-0824085fb9f6" name="Update Collection Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>b91d2d99-42c9-43fe-a110-ea1294daae96</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="b91d2d99-42c9-43fe-a110-ea1294daae96" name="DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <useChildSettingsFrom>b2f0849a-864b-447d-b896-300b597bbb02</useChildSettingsFrom>
          <childSettings />
        </mapping>
        <mapping id="36780dcc-1942-42cf-b50a-f5b2571cf218" name="Service Operation" type="Operation" typeId="e030c97a-e066-40a7-8188-808c275df3cb">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="b29d236f-473a-4ad5-871b-38d5c652bf1a" name="Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <filterFunction>return !element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>b91d2d99-42c9-43fe-a110-ea1294daae96</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="3b4ddbc4-154e-40ac-8f17-7a1603270f8c" name="Collection Parameter" type="Parameter" typeId="00208d20-469d-41cb-8501-768fd5eb796b">
              <filterFunction>return element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>b91d2d99-42c9-43fe-a110-ea1294daae96</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="0c8933f1-4df2-4bde-a50c-4f8f3bb29323" name="Domain Event Handler Association" type="Domain Event Handler Association Target End" typeId="f45dfee9-f62b-45ac-bfce-a3878e04b73f">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <traversableTypes>
            <mappingId>b1f79bcc-4f4e-4b5e-8f49-c49b485e7987</mappingId>
          </traversableTypes>
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="b1f79bcc-4f4e-4b5e-8f49-c49b485e7987" name="Domain Event" type="Domain Event" typeId="0814e459-fb9b-47db-b7eb-32ce30397e8a">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="47476752-e9aa-4250-b805-8474413ab402" name="Property" type="Property" typeId="b4d69073-5abb-4968-b41b-545b2f7408ed">
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return true;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>5bc07df5-9804-4806-bc5c-15252656339b</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings>
                    <childSetting id="5bc07df5-9804-4806-bc5c-15252656339b" name="Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
                      <allowMultipleMappings>true</allowMultipleMappings>
                      <isMappableFunction>return false;</isMappableFunction>
                      <traversableTypes />
                      <canBeModified>false</canBeModified>
                      <childSettings>
                        <childSetting id="c7ae1336-1218-4f28-8634-22a114cbeb1b" name="Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
                          <allowMultipleMappings>true</allowMultipleMappings>
                          <isMappableFunction>return true;</isMappableFunction>
                          <traversableTypes>
                            <mappingId>084158c1-8dec-462b-a450-54e9c5988eae</mappingId>
                          </traversableTypes>
                          <canBeModified>false</canBeModified>
                          <childSettings />
                        </childSetting>
                        <childSetting id="276b73a8-e17f-4985-a1ba-9b4253489b82" name="Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
                          <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
                          <allowMultipleMappings>true</allowMultipleMappings>
                          <isMappableFunction>return true;</isMappableFunction>
                          <traversableTypes>
                            <mappingId>084158c1-8dec-462b-a450-54e9c5988eae</mappingId>
                          </traversableTypes>
                          <canBeModified>false</canBeModified>
                          <useChildSettingsFrom>5bc07df5-9804-4806-bc5c-15252656339b</useChildSettingsFrom>
                          <childSettings />
                        </childSetting>
                        <childSetting id="2ac46697-cbc5-4b3d-a64f-edb74a64f761" name="Invoke Domain Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
                          <allowMultipleMappings>true</allowMultipleMappings>
                          <isMappableFunction>return element.typeReference.isTypeFound() &amp;&amp; element.getChildren("Parameter").length == 0;</isMappableFunction>
                          <traversableTypes />
                          <canBeModified>false</canBeModified>
                          <childSettings />
                        </childSetting>
                        <childSetting id="084158c1-8dec-462b-a450-54e9c5988eae" name="Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
                          <allowMultipleMappings>true</allowMultipleMappings>
                          <isMappableFunction>return false;</isMappableFunction>
                          <traversableTypes />
                          <canBeModified>false</canBeModified>
                          <useChildSettingsFrom>5bc07df5-9804-4806-bc5c-15252656339b</useChildSettingsFrom>
                          <childSettings />
                        </childSetting>
                      </childSettings>
                    </childSetting>
                  </childSettings>
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
      </sourceMappings>
      <targetMappings>
        <mapping id="40237ee3-1071-4635-b3e9-4b4a0662d83d" name="Update Class" type="Class" typeId="04e12b51-ed12-42a3-9667-a6aa81bb6d10">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="f36d1424-356d-44f1-8518-2a3c5b4887f7" name="Update Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return !element.getParent().hasType || element.getParent().typeReference?.getIsCollection()</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>let fkAssociation = element.getStereotype("Foreign Key")?.getProperty("Association")?.getSelected();  
return (!element.hasStereotype('Primary Key') || element.getParent().specialization == "Association Target End")     
    // mapping association is to Class, not Operation:
    &amp;&amp; element.getParent("Class").id == mappingContext.targetElementId
    // if is FK, include if is for aggregational relationahip:
    &amp;&amp; (fkAssociation == null || fkAssociation.getOtherEnd().typeReference.getIsCollection() || fkAssociation.getOtherEnd().typeReference.getIsNullable());</isMappableFunction>
              <traversableTypes>
                <mappingId>21c1865a-d426-4b55-bb99-20d88b0891b7</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
            <childSetting id="0601475b-1210-42ae-a51a-f8c714e141a1" name="Update Association Target End" type="Association Target End" typeId="0a66489f-30aa-417b-a75d-b945863366fd">
              <filterFunction>return element.getOtherEnd().typeReference.getIsCollection() == false</filterFunction>
              <isRequiredFunction>return false;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return element.getParent("Class").id == mappingContext.targetElementId</isMappableFunction>
              <traversableTypes>
                <mappingId>40237ee3-1071-4635-b3e9-4b4a0662d83d</mappingId>
                <mappingId>21c1865a-d426-4b55-bb99-20d88b0891b7</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <useChildSettingsFrom>40237ee3-1071-4635-b3e9-4b4a0662d83d</useChildSettingsFrom>
              <childSettings />
            </childSetting>
            <childSetting id="7e59bbbb-eb82-4b16-b8b3-0547d86e41d8" name="Invoke Class Operation" type="Operation" typeId="e042bb67-a1df-480c-9935-b26210f78591">
              <filterFunction>return element.id == mappingContext.targetElementId || element.getParent("Class").id == mappingContext.targetElementId</filterFunction>
              <isRequiredFunction>return element.id == mappingContext.targetElementId</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return element.id == mappingContext.targetElementId || element.getParent("Class").id == mappingContext.targetElementId</isMappableFunction>
              <traversableTypes />
              <canBeModified>false</canBeModified>
              <childSettings>
                <childSetting id="33263133-596d-44ea-b713-840113c226ba" name="Operation Parameter" type="Parameter" typeId="c26d8d0a-a26b-4b5f-b449-e9bdb60b3a4b">
                  <isRequiredFunction>return true;</isRequiredFunction>
                  <allowMultipleMappings>true</allowMultipleMappings>
                  <isMappableFunction>return true;</isMappableFunction>
                  <traversableTypes>
                    <mappingId>21c1865a-d426-4b55-bb99-20d88b0891b7</mappingId>
                  </traversableTypes>
                  <canBeModified>false</canBeModified>
                  <childSettings />
                </childSetting>
              </childSettings>
            </childSetting>
          </childSettings>
        </mapping>
        <mapping id="21c1865a-d426-4b55-bb99-20d88b0891b7" name="Update Value Object" type="Value Object" typeId="5fe6bb0a-7fc3-42ae-a351-d9188f5b8bc5">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <childSettings>
            <childSetting id="1f8058b9-55bc-4ab4-ab8c-8ebde1a99018" name="Value Object Attribute" type="Attribute" typeId="0090fb93-483e-41af-a11d-5ad2dc796adf">
              <isRequiredFunction>return true;</isRequiredFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <traversableTypes>
                <mappingId>21c1865a-d426-4b55-bb99-20d88b0891b7</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <childSettings />
            </childSetting>
          </childSettings>
        </mapping>
      </targetMappings>
      <mappingTypes>
        <mappingType type="Invocation Mapping" typeId="d30bdba1-9c47-4917-b81d-29230fed5d6a">
          <represents>invokable</represents>
          <sources>
            <source id="b2f0849a-864b-447d-b896-300b597bbb02" name="Command" />
            <source id="bf848a07-0fcd-4599-9a8a-0824085fb9f6" name="Update Collection Field" />
            <source id="36780dcc-1942-42cf-b50a-f5b2571cf218" name="Service Operation" />
            <source id="3b4ddbc4-154e-40ac-8f17-7a1603270f8c" name="Collection Parameter" />
            <source id="0c8933f1-4df2-4bde-a50c-4f8f3bb29323" name="Domain Event Handler Association" />
          </sources>
          <targets>
            <target id="7e59bbbb-eb82-4b16-b8b3-0547d86e41d8" name="Invoke Class Operation" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
        <mappingType type="Data Mapping" typeId="ca88649b-f20b-44db-a9c0-017c26155ba8">
          <represents>data</represents>
          <sources>
            <source id="cb557bfc-e7c7-49ab-b842-0124959fe5ec" name="Update Field" />
            <source id="b29d236f-473a-4ad5-871b-38d5c652bf1a" name="Parameter" />
            <source id="bf848a07-0fcd-4599-9a8a-0824085fb9f6" name="Update Collection Field" />
            <source id="3b4ddbc4-154e-40ac-8f17-7a1603270f8c" name="Collection Parameter" />
            <source id="47476752-e9aa-4250-b805-8474413ab402" name="Property" />
            <source id="c7ae1336-1218-4f28-8634-22a114cbeb1b" name="Attribute" />
            <source id="276b73a8-e17f-4985-a1ba-9b4253489b82" name="Association Target End" />
            <source id="2ac46697-cbc5-4b3d-a64f-edb74a64f761" name="Invoke Domain Operation" />
          </sources>
          <targets>
            <target id="f36d1424-356d-44f1-8518-2a3c5b4887f7" name="Update Attribute" />
            <target id="0601475b-1210-42ae-a51a-f8c714e141a1" name="Update Association Target End" />
            <target id="33263133-596d-44ea-b713-840113c226ba" name="Operation Parameter" />
            <target id="1f8058b9-55bc-4ab4-ab8c-8ebde1a99018" name="Value Object Attribute" />
          </targets>
          <allowAutoMap>true</allowAutoMap>
        </mappingType>
      </mappingTypes>
    </mappingSetting>
  </mappingSettings>
</settings>