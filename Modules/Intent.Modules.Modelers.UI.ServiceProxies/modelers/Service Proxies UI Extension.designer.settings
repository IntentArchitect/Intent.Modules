<?xml version="1.0" encoding="utf-8"?>
<settings version="3.1.1">
  <id>10144809-6397-4c64-bc01-b83b3d270ebe</id>
  <name>Service Proxies UI Extension</name>
  <designerReferences>
    <designerReference id="8cf2b93d-9449-4e40-af62-12daf6f7e0f4" name="Service Proxy Types" module="Intent.Modelers.Types.ServiceProxies" />
  </designerReferences>
  <packageSettings />
  <packageExtensions>
    <packageExtension type="User Interface Package" typeId="68bcd9b7-51db-4d6b-996a-3f0ec6a5f6d6">
      <requiredPackages />
      <creationOptions>
        <option type="element">
          <text>New Service Proxy</text>
          <icon type="UrlImagePath" source="data:image/png;base64,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" />
          <specializationType>Service Proxy</specializationType>
          <specializationTypeId>07d8d1a9-6b9f-4676-b7d3-8db06299e35c</specializationTypeId>
          <defaultName>NewServiceProxy</defaultName>
          <allowMultiple>true</allowMultiple>
        </option>
      </creationOptions>
      <scriptOptions />
      <typeOrder>
        <type>Service Proxy</type>
      </typeOrder>
    </packageExtension>
  </packageExtensions>
  <elementSettings />
  <elementExtensions>
    <elementExtension type="Service Proxy" typeId="07d8d1a9-6b9f-4676-b7d3-8db06299e35c">
      <mappingSettings />
      <macros>
        <macro trigger="on-changed">
          <script>/// &lt;reference path="../../../typings/elementmacro.context.api.d.ts" /&gt;
function GetParameters(targetService) {
    let httpSettings = targetService.getStereotype("Http Settings");
    if (!httpSettings) {
        console.warn(`Could not process '${targetService.getName()}': Http Settings not found`);
        return [];
    }
    var isForCqrs = targetService.specialization == "Query" || targetService.specialization == "Command";
    var verbAllowsBody = ["PUT", "PATCH", "POST"].some(x =&gt; x == httpSettings.getProperty("Verb").getValue());
    var requiresBody = false;
    let result = [];
    targetService.getChildren("Parameter").concat(targetService.getChildren("DTO-Field")).forEach(childElement =&gt; {
        var parameterSettings = childElement.getStereotype("d01df110-1208-4af8-a913-92a49d219552"); // "Paremeter Settings"
        var routeContainsParameter = httpSettings.getProperty("Route").getValue().toString().toLowerCase().indexOf(`{${childElement.getName().toLowerCase()}}`) != -1;
        if (isForCqrs &amp;&amp; !parameterSettings &amp;&amp; !routeContainsParameter &amp;&amp; verbAllowsBody) {
            requiresBody = true;
            return;
        }
        result.push({
            id: childElement.id,
            name: toCamelCase(childElement.getName()),
            typeId: childElement.typeReference.getTypeId(),
            isNullable: childElement.typeReference.getIsNullable(),
            isCollection: childElement.typeReference.getIsCollection(),
        });
    });
    if (isForCqrs &amp;&amp; requiresBody) {
        result.push({
            id: targetService.id,
            name: targetService.specialization.toLowerCase(),
            typeId: targetService.id,
            isNullable: false,
            isCollection: false,
        });
    }
    return result;
}
function execute(proxyElement) {
    proxyElement.getChildren("Operation").forEach(operation =&gt; {
        let targetService = operation.getMapping().getElement();
        let params = GetParameters(targetService);
        params.forEach((param, index) =&gt; {
            let existing = operation.getChildren("Parameter").find(x =&gt; x.getMetadata("endpoint-input-id") == param.id);
            if (!existing) {
                existing = createElement("Parameter", param.name, operation.id);
                operation.collapse();
            }
            existing.setName(param.name);
            existing.setOrder(index);
            existing.typeReference.setType(param.typeId);
            existing.typeReference.setIsCollection(param.isCollection);
            existing.typeReference.setIsNullable(param.isNullable);
            existing.setMetadata("endpoint-input-id", param.id);
        });
        operation.getChildren("Parameter")
            .filter(x =&gt; params.every(p =&gt; p.id != x.getMetadata("endpoint-input-id")))
            .forEach(x =&gt; x.delete());
    });
}
/**
 * Used by Intent.Modules\Modules\Intent.Modelers.Types.ServiceProxies
 *
 * Source code here:
 * https://github.com/IntentArchitect/Intent.Modules/blob/development/DesignerMacros/src/service-proxies/manage-parameters/service-proxies-manage-parameters.ts
 */
if (element.specialization == "Service Proxy") {
    execute(element);
}
else {
    lookupTypesOf("Service Proxy").forEach(x =&gt; execute(x));
}
</script>
        </macro>
      </macros>
    </elementExtension>
  </elementExtensions>
  <associationSettings />
  <associationExtensions>
    <associationExtension type="Call Service Operation Action" typeId="fe5a5cd8-aabd-472f-8d42-f5c233e658dc">
      <sourceEndExtension>
        <typeOrder />
        <typeReferenceExtension>
          <isRequired>true</isRequired>
          <targetTypes />
          <allowIsNavigable>inherit</allowIsNavigable>
          <allowIsNullable>inherit</allowIsNullable>
          <allowIsCollection>inherit</allowIsCollection>
        </typeReferenceExtension>
      </sourceEndExtension>
      <targetEndExtension>
        <typeReferenceExtension>
          <isRequired>true</isRequired>
          <targetTypes>
            <type>Operation</type>
          </targetTypes>
          <allowIsNavigable>inherit</allowIsNavigable>
          <allowIsNullable>inherit</allowIsNullable>
          <allowIsCollection>inherit</allowIsCollection>
        </typeReferenceExtension>
      </targetEndExtension>
      <macros />
    </associationExtension>
  </associationExtensions>
  <mappingSettings />
  <mappableElementPackages />
  <mappableElementPackageExtensions>
    <mappableElementPackageExtension id="cd5df4be-78ba-4262-a5d2-1ca5d53f6f9c" name="Call Service Targets - Proxies" extendPackageId="80e250fa-91d8-4bb9-95b8-e9b355bf6720" extendPackage="Call Service Targets">
      <imports />
      <mappableElementSettings>
        <mappableElement id="f18ae1b5-eeda-48ae-83b0-64b12fd331a2" name="DTO" type="DTO" typeId="fee0edca-4aa0-4f77-a524-6bbd84e78734">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return false;</isMappableFunction>
          <isTraversable>false</isTraversable>
          <traversableTypes />
          <canBeModified>true</canBeModified>
          <createNameFunction>return element.getParent('Command').getName() + element.getName() + 'Dto'</createNameFunction>
          <represents>data</represents>
          <childSettings>
            <childSetting id="bebd723b-8592-4540-9edd-fa54e1be4d78" name="Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return !element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <isTraversable>true</isTraversable>
              <traversableTypes>
                <mappingId>f18ae1b5-eeda-48ae-83b0-64b12fd331a2</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <represents>data</represents>
              <childSettings />
            </childSetting>
            <childSetting id="36c63ac0-fd8a-485e-9798-bbf3a4551060" name="Collection Field" type="DTO-Field" typeId="7baed1fd-469b-4980-8fd9-4cefb8331eb2">
              <filterFunction>return element.typeReference.getIsCollection()</filterFunction>
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <isTraversable>true</isTraversable>
              <traversableTypes>
                <mappingId>f18ae1b5-eeda-48ae-83b0-64b12fd331a2</mappingId>
              </traversableTypes>
              <canBeModified>true</canBeModified>
              <represents>data</represents>
              <childSettings />
            </childSetting>
          </childSettings>
        </mappableElement>
        <mappableElement id="f0078741-2b1a-4103-bbc7-2737aa05b0cc" name="Service Proxy Operation" type="Operation" typeId="aee6811e-b2f6-4562-a8eb-502029f63bc8">
          <allowMultipleMappings>true</allowMultipleMappings>
          <isMappableFunction>return true;</isMappableFunction>
          <isTraversable>false</isTraversable>
          <traversableTypes />
          <canBeModified>false</canBeModified>
          <represents>data</represents>
          <childSettings>
            <childSetting id="3fc9e92a-7af5-4d45-9cb6-581a406476b4" name="Parameter" type="Parameter" typeId="f11273c1-217f-4f42-b690-3d8b488f95a8">
              <allowMultipleMappings>true</allowMultipleMappings>
              <isMappableFunction>return true;</isMappableFunction>
              <isTraversable>true</isTraversable>
              <traversableTypes>
                <mappingId>f18ae1b5-eeda-48ae-83b0-64b12fd331a2</mappingId>
              </traversableTypes>
              <canBeModified>false</canBeModified>
              <represents>data</represents>
              <childSettings />
            </childSetting>
          </childSettings>
        </mappableElement>
      </mappableElementSettings>
    </mappableElementPackageExtension>
  </mappableElementPackageExtensions>
</settings>