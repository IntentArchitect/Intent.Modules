<?xml version="1.0" encoding="utf-8"?>
<stereotypeDefinition id="a9eade71-1d56-4be7-a80c-81046c0c978b" version="3.1.0">
  <comment>Configures security requirements of the endpoint, governing access through role and policy configurations.</comment>
  <name>Secured</name>
  <targetMode>of-type</targetMode>
  <targetTypes>
    <type id="b16578a5-27b1-4047-a8df-f0b783d706bd">Service</type>
    <type id="e030c97a-e066-40a7-8188-808c275df3cb">Operation</type>
    <type id="ccf14eb6-3a55-4d81-b5b9-d27311c70cb9">Command</type>
    <type id="e71b0662-e29d-4db2-868b-8a12464b25d0">Query</type>
    <type id="df45eaf6-9202-4c25-8dd5-677e9ba1e906">Services Package</type>
  </targetTypes>
  <targetReferenceTypes />
  <applyMode>manually</applyMode>
  <icon type="UrlImagePath" source="data:image/png;base64,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" />
  <displayIcon>true</displayIcon>
  <displayIconFunction>return true;</displayIconFunction>
  <displayFunction>if (Policy || Roles){
    return `[Authorize(${Roles ? `Roles = \"${Roles}\"` : ""}${Roles &amp;&amp; Policy ? ", " : ""}${Policy ? `Policy = \"${Policy}\"` : ""})]`;
}else if (SecurityPolicies || SecurityRoles){
    return `[Authorize(${hasElements(SecurityRoles) ? `Roles = \"${getAsText(SecurityRoles)}\"` : ""}${ hasElements(SecurityRoles) &amp;&amp; isSelected(SecurityPolicies) ? ", " : ""}${isSelected(SecurityPolicies) ? `Policy = \"${getTextFromId(SecurityPolicies)}\"` : ""})]`;
}else{
    return `[Authorize]`
}

function hasElements(setting){
    return setting &amp;&amp; setting != '[]';
}

function isSelected(setting){
    console.info("setting: " + setting);
    return setting &amp;&amp; setting != '';
}

function getTextFromId(value) {
    const obj = lookup(value);
    return obj ? obj.getName() : null;
}

function getAsText(values){
     // Parse the string to get the array of GUIDs
    const guids = JSON.parse(values);
    
    if (!guids?.map){
        return "";
    }
    // Look up the objects and extract the values
    const lookupValues = guids.map(guid =&gt; {
        const obj = lookup(guid);
        return obj ? obj.getName() : null;
    }).filter(value =&gt; value !== null); // Filter out any null values
    
    // Join the lookup values into a single string
    return lookupValues.join(',');  
}</displayFunction>
  <displayAsAnnotation>true</displayAsAnnotation>
  <displayAsText>false</displayAsText>
  <autoAdd>false</autoAdd>
  <allowMultipleApplies>true</allowMultipleApplies>
  <parentFolderId>a6fa1088-0064-43e3-a7fc-36c97b2b9285</parentFolderId>
  <order>0</order>
  <packageId>a6fa1088-0064-43e3-a7fc-36c97b2b9285</packageId>
  <packageName>Intent.Metadata.Security</packageName>
  <validateFunction>const securedStereotypeId = "a9eade71-1d56-4be7-a80c-81046c0c978b";
const unsecuredStereotypeId = "8b65c29e-1448-43ac-a92a-0e0f86efd6c6";

if (element.hasStereotype(securedStereotypeId) &amp;&amp; element.hasStereotype(unsecuredStereotypeId)) {
    return "Both the \"Secured\" and \"Unsecured\" stereotypes are applied to the same element";
}

return null;</validateFunction>
  <properties>
    <property id="2b39acef-6079-48c9-b85e-2b0981f9de70">
      <comment />
      <hint>Comma separated list of role names.</hint>
      <name>Roles</name>
      <type>string</type>
      <controlType>text</controlType>
      <optionsSource>n/a</optionsSource>
      <placeholder>(optional)</placeholder>
      <isActiveFunction>let securityElementsDefined = lookupTypesOf("Security Configuration")[0]?.getChildren()?.length &gt; 0;
return !securityElementsDefined || (securityElementsDefined &amp;&amp;  (Roles !== null &amp;&amp; Roles !== undefined &amp;&amp; Roles.trim() !== ''));</isActiveFunction>
    </property>
    <property id="ae5251ff-40a1-4e46-be66-6b176f329f98">
      <hint>The policy name. To apply multiple policies use multiple Secured stereotypes.</hint>
      <name>Policy</name>
      <type>string</type>
      <controlType>text</controlType>
      <optionsSource>n/a</optionsSource>
      <placeholder>(optional)</placeholder>
      <isActiveFunction>let securityElementsDefined = lookupTypesOf("Security Configuration")[0]?.getChildren()?.length &gt; 0;
return !securityElementsDefined || (securityElementsDefined &amp;&amp;  (Policy !== null &amp;&amp; Policy !== undefined &amp;&amp; Policy.trim() !== ''));</isActiveFunction>
    </property>
    <property id="28bbe8bb-8d31-44c7-b642-ff0e279ab85f">
      <name>Security Roles</name>
      <type>string</type>
      <controlType>multi-select</controlType>
      <optionsSource>lookup-element</optionsSource>
      <lookupTypes>
        <type>d6ce4e4c-fdd1-4fa1-82d8-f3405e114ec5</type>
      </lookupTypes>
      <isActiveFunction>return lookupTypesOf("Security Configuration")[0]?.getChildren()?.length &gt; 0;</isActiveFunction>
    </property>
    <property id="68cbcd05-cd5c-49f3-a982-8ee9caf554bb">
      <hint>To apply multiple policies use multiple Secured stereotypes.</hint>
      <name>Security Policies</name>
      <type>string</type>
      <controlType>select</controlType>
      <optionsSource>lookup-element</optionsSource>
      <lookupTypes>
        <type>9f37c60e-ad88-4484-98ca-6c9aa7ca3134</type>
      </lookupTypes>
      <isActiveFunction>return lookupTypesOf("Security Configuration")[0]?.getChildren()?.length &gt; 0;</isActiveFunction>
    </property>
  </properties>
</stereotypeDefinition>